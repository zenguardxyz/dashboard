import{i as $v,f as Fv,h as Dv,j as Lv,k as jv,m as qv,o as Mv,p as Uv,q as zv,r as kv,s as Hv,t as Kv,u as Vv,v as Bv,w as Gv,x as Dc,y as uf,z as ne,A as hf,B as Ro,H as Wv,C as lf,D as Jv,E as Qv,F as Yv,G as Zv,I as sn,J as Qr,K as Xv,L as ff,M as go,N as e1,O as Lc,_ as t1}from"./index-de2ecb01.js";import{s as nn,a as To,i as Zh,c as r1,b as i1,f as jc,p as s1,J as fi,d as qc,e as Mc,g as Uc,h as Si,j as li,k as en,l as n1,m as o1,H as Ai}from"./http-262dacef.js";function zc(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function pf(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?zc(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function Ic(o,t){t||(t=o.reduce((a,h)=>a+h.length,0));const r=pf(t);let s=0;for(const a of o)r.set(a,s),s+=a.length;return zc(r)}const Xh={...$v,...Fv,...Dv,...Lv,...jv,...qv,...Mv,...Uv,...zv,...kv};function df(o,t,r,s){return{name:o,prefix:t,encoder:{name:o,prefix:t,encode:r},decoder:{decode:s}}}const el=df("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),nc=df("ascii","a",o=>{let t="a";for(let r=0;r<o.length;r++)t+=String.fromCharCode(o[r]);return t},o=>{o=o.substring(1);const t=pf(o.length);for(let r=0;r<o.length;r++)t[r]=o.charCodeAt(r);return t}),gf={utf8:el,"utf-8":el,hex:Xh.base16,latin1:nc,ascii:nc,binary:nc,...Xh};function gr(o,t="utf8"){const r=gf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?zc(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}function nr(o,t="utf8"){const r=gf[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("utf8"):r.encoder.encode(o).substring(1)}const a1={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};var tn={};(function(o){const t=Vv,r=Bv,s=Hv,a=Kv,h=C=>C==null,p=Symbol("encodeFragmentIdentifier");function g(C){switch(C.arrayFormat){case"index":return $=>(M,q)=>{const I=M.length;return q===void 0||C.skipNull&&q===null||C.skipEmptyString&&q===""?M:q===null?[...M,[b($,C),"[",I,"]"].join("")]:[...M,[b($,C),"[",b(I,C),"]=",b(q,C)].join("")]};case"bracket":return $=>(M,q)=>q===void 0||C.skipNull&&q===null||C.skipEmptyString&&q===""?M:q===null?[...M,[b($,C),"[]"].join("")]:[...M,[b($,C),"[]=",b(q,C)].join("")];case"colon-list-separator":return $=>(M,q)=>q===void 0||C.skipNull&&q===null||C.skipEmptyString&&q===""?M:q===null?[...M,[b($,C),":list="].join("")]:[...M,[b($,C),":list=",b(q,C)].join("")];case"comma":case"separator":case"bracket-separator":{const $=C.arrayFormat==="bracket-separator"?"[]=":"=";return M=>(q,I)=>I===void 0||C.skipNull&&I===null||C.skipEmptyString&&I===""?q:(I=I===null?"":I,q.length===0?[[b(M,C),$,b(I,C)].join("")]:[[q,b(I,C)].join(C.arrayFormatSeparator)])}default:return $=>(M,q)=>q===void 0||C.skipNull&&q===null||C.skipEmptyString&&q===""?M:q===null?[...M,b($,C)]:[...M,[b($,C),"=",b(q,C)].join("")]}}function w(C){let $;switch(C.arrayFormat){case"index":return(M,q,I)=>{if($=/\[(\d*)\]$/.exec(M),M=M.replace(/\[\d*\]$/,""),!$){I[M]=q;return}I[M]===void 0&&(I[M]={}),I[M][$[1]]=q};case"bracket":return(M,q,I)=>{if($=/(\[\])$/.exec(M),M=M.replace(/\[\]$/,""),!$){I[M]=q;return}if(I[M]===void 0){I[M]=[q];return}I[M]=[].concat(I[M],q)};case"colon-list-separator":return(M,q,I)=>{if($=/(:list)$/.exec(M),M=M.replace(/:list$/,""),!$){I[M]=q;return}if(I[M]===void 0){I[M]=[q];return}I[M]=[].concat(I[M],q)};case"comma":case"separator":return(M,q,I)=>{const D=typeof q=="string"&&q.includes(C.arrayFormatSeparator),H=typeof q=="string"&&!D&&S(q,C).includes(C.arrayFormatSeparator);q=H?S(q,C):q;const ce=D||H?q.split(C.arrayFormatSeparator).map(ae=>S(ae,C)):q===null?q:S(q,C);I[M]=ce};case"bracket-separator":return(M,q,I)=>{const D=/(\[\])$/.test(M);if(M=M.replace(/\[\]$/,""),!D){I[M]=q&&S(q,C);return}const H=q===null?[]:q.split(C.arrayFormatSeparator).map(ce=>S(ce,C));if(I[M]===void 0){I[M]=H;return}I[M]=[].concat(I[M],H)};default:return(M,q,I)=>{if(I[M]===void 0){I[M]=q;return}I[M]=[].concat(I[M],q)}}}function y(C){if(typeof C!="string"||C.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function b(C,$){return $.encode?$.strict?t(C):encodeURIComponent(C):C}function S(C,$){return $.decode?r(C):C}function N(C){return Array.isArray(C)?C.sort():typeof C=="object"?N(Object.keys(C)).sort(($,M)=>Number($)-Number(M)).map($=>C[$]):C}function K(C){const $=C.indexOf("#");return $!==-1&&(C=C.slice(0,$)),C}function j(C){let $="";const M=C.indexOf("#");return M!==-1&&($=C.slice(M)),$}function J(C){C=K(C);const $=C.indexOf("?");return $===-1?"":C.slice($+1)}function oe(C,$){return $.parseNumbers&&!Number.isNaN(Number(C))&&typeof C=="string"&&C.trim()!==""?C=Number(C):$.parseBooleans&&C!==null&&(C.toLowerCase()==="true"||C.toLowerCase()==="false")&&(C=C.toLowerCase()==="true"),C}function fe(C,$){$=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},$),y($.arrayFormatSeparator);const M=w($),q=Object.create(null);if(typeof C!="string"||(C=C.trim().replace(/^[?#&]/,""),!C))return q;for(const I of C.split("&")){if(I==="")continue;let[D,H]=s($.decode?I.replace(/\+/g," "):I,"=");H=H===void 0?null:["comma","separator","bracket-separator"].includes($.arrayFormat)?H:S(H,$),M(S(D,$),H,q)}for(const I of Object.keys(q)){const D=q[I];if(typeof D=="object"&&D!==null)for(const H of Object.keys(D))D[H]=oe(D[H],$);else q[I]=oe(D,$)}return $.sort===!1?q:($.sort===!0?Object.keys(q).sort():Object.keys(q).sort($.sort)).reduce((I,D)=>{const H=q[D];return H&&typeof H=="object"&&!Array.isArray(H)?I[D]=N(H):I[D]=H,I},Object.create(null))}o.extract=J,o.parse=fe,o.stringify=(C,$)=>{if(!C)return"";$=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},$),y($.arrayFormatSeparator);const M=H=>$.skipNull&&h(C[H])||$.skipEmptyString&&C[H]==="",q=g($),I={};for(const H of Object.keys(C))M(H)||(I[H]=C[H]);const D=Object.keys(I);return $.sort!==!1&&D.sort($.sort),D.map(H=>{const ce=C[H];return ce===void 0?"":ce===null?b(H,$):Array.isArray(ce)?ce.length===0&&$.arrayFormat==="bracket-separator"?b(H,$)+"[]":ce.reduce(q(H),[]).join("&"):b(H,$)+"="+b(ce,$)}).filter(H=>H.length>0).join("&")},o.parseUrl=(C,$)=>{$=Object.assign({decode:!0},$);const[M,q]=s(C,"#");return Object.assign({url:M.split("?")[0]||"",query:fe(J(C),$)},$&&$.parseFragmentIdentifier&&q?{fragmentIdentifier:S(q,$)}:{})},o.stringifyUrl=(C,$)=>{$=Object.assign({encode:!0,strict:!0,[p]:!0},$);const M=K(C.url).split("?")[0]||"",q=o.extract(C.url),I=o.parse(q,{sort:!1}),D=Object.assign(I,C.query);let H=o.stringify(D,$);H&&(H=`?${H}`);let ce=j(C.url);return C.fragmentIdentifier&&(ce=`#${$[p]?b(C.fragmentIdentifier,$):C.fragmentIdentifier}`),`${M}${H}${ce}`},o.pick=(C,$,M)=>{M=Object.assign({parseFragmentIdentifier:!0,[p]:!1},M);const{url:q,query:I,fragmentIdentifier:D}=o.parseUrl(C,M);return o.stringifyUrl({url:q,query:a(I,$),fragmentIdentifier:D},M)},o.exclude=(C,$,M)=>{const q=Array.isArray($)?I=>!$.includes(I):(I,D)=>!$(I,D);return o.pick(C,q,M)}})(tn);const c1=":";function u1(o){const[t,r]=o.split(c1);return{namespace:t,reference:r}}function h1(o,t=[]){const r=[];return Object.keys(o).forEach(s=>{if(t.length&&!t.includes(s))return;const a=o[s];r.push(...a.accounts)}),r}function yf(o,t){return o.includes(":")?[o]:t.chains||[]}const mf="base10",sr="base16",xc="base64pad",kc="utf8",vf=0,Gi=1,l1=0,tl=1,Sc=12,Hc=32;function f1(){const o=hf.generateKeyPair();return{privateKey:nr(o.secretKey,sr),publicKey:nr(o.publicKey,sr)}}function Pc(){const o=Ro.randomBytes(Hc);return nr(o,sr)}function p1(o,t){const r=hf.sharedKey(gr(o,sr),gr(t,sr),!0),s=new Wv(Dc.SHA256,r).expand(Hc);return nr(s,sr)}function d1(o){const t=Dc.hash(gr(o,sr));return nr(t,sr)}function ws(o){const t=Dc.hash(gr(o,kc));return nr(t,sr)}function g1(o){return gr(`${o}`,mf)}function on(o){return Number(nr(o,mf))}function y1(o){const t=g1(typeof o.type<"u"?o.type:vf);if(on(t)===Gi&&typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof o.senderPublicKey<"u"?gr(o.senderPublicKey,sr):void 0,s=typeof o.iv<"u"?gr(o.iv,sr):Ro.randomBytes(Sc),a=new lf.ChaCha20Poly1305(gr(o.symKey,sr)).seal(s,gr(o.message,kc));return v1({type:t,sealed:a,iv:s,senderPublicKey:r})}function m1(o){const t=new lf.ChaCha20Poly1305(gr(o.symKey,sr)),{sealed:r,iv:s}=Po(o.encoded),a=t.open(s,r);if(a===null)throw new Error("Failed to decrypt");return nr(a,kc)}function v1(o){if(on(o.type)===Gi){if(typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return nr(Ic([o.type,o.senderPublicKey,o.iv,o.sealed]),xc)}return nr(Ic([o.type,o.iv,o.sealed]),xc)}function Po(o){const t=gr(o,xc),r=t.slice(l1,tl),s=tl;if(on(r)===Gi){const g=s+Hc,w=g+Sc,y=t.slice(s,g),b=t.slice(g,w),S=t.slice(w);return{type:r,sealed:S,iv:b,senderPublicKey:y}}const a=s+Sc,h=t.slice(s,a),p=t.slice(a);return{type:r,sealed:p,iv:h}}function w1(o,t){const r=Po(o);return wf({type:on(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?nr(r.senderPublicKey,sr):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function wf(o){const t=(o==null?void 0:o.type)||vf;if(t===Gi){if(typeof(o==null?void 0:o.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(o==null?void 0:o.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:o==null?void 0:o.senderPublicKey,receiverPublicKey:o==null?void 0:o.receiverPublicKey}}function rl(o){return o.type===Gi&&typeof o.senderPublicKey=="string"&&typeof o.receiverPublicKey=="string"}var b1=Object.defineProperty,il=Object.getOwnPropertySymbols,_1=Object.prototype.hasOwnProperty,E1=Object.prototype.propertyIsEnumerable,sl=(o,t,r)=>t in o?b1(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,nl=(o,t)=>{for(var r in t||(t={}))_1.call(t,r)&&sl(o,r,t[r]);if(il)for(var r of il(t))E1.call(t,r)&&sl(o,r,t[r]);return o};const I1="ReactNative",Er={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},x1="js";function Kc(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function _s(){return!Jv()&&!!uf()&&navigator.product===I1}function Es(){return!Kc()&&!!uf()}function an(){return _s()?Er.reactNative:Kc()?Er.node:Es()?Er.browser:Er.unknown}function S1(){var o;try{return _s()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(o=global.Application)==null?void 0:o.applicationId:void 0}catch{return}}function P1(o,t){let r=tn.parse(o);return r=nl(nl({},r),t),o=tn.stringify(r),o}function O1(){return Gv()||{name:"",description:"",url:"",icons:[""]}}function C1(){if(an()===Er.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:s}=global.Platform;return[r,s].join("-")}const o=Qv();if(o===null)return"unknown";const t=o.os?o.os.replace(" ","").toLowerCase():"unknown";return o.type==="browser"?[t,o.name,o.version].join("-"):[t,o.version].join("-")}function A1(){var o;const t=an();return t===Er.browser?[t,((o=Yv())==null?void 0:o.host)||"unknown"].join(":"):t}function N1(o,t,r){const s=C1(),a=A1();return[[o,t].join("-"),[x1,r].join("-"),s,a].join("/")}function R1({protocol:o,version:t,relayUrl:r,sdkVersion:s,auth:a,projectId:h,useOnCloseEvent:p,bundleId:g}){const w=r.split("?"),y=N1(o,t,s),b={auth:a,ua:y,projectId:h,useOnCloseEvent:p||void 0,origin:g||void 0},S=P1(w[1]||"",b);return w[0]+"?"+S}function Bi(o,t){return o.filter(r=>t.includes(r)).length===o.length}function bf(o){return Object.fromEntries(o.entries())}function _f(o){return new Map(Object.entries(o))}function ms(o=ne.FIVE_MINUTES,t){const r=ne.toMiliseconds(o||ne.FIVE_MINUTES);let s,a,h;return{resolve:p=>{h&&s&&(clearTimeout(h),s(p))},reject:p=>{h&&a&&(clearTimeout(h),a(p))},done:()=>new Promise((p,g)=>{h=setTimeout(()=>{g(new Error(t))},r),s=p,a=g})}}function rn(o,t,r){return new Promise(async(s,a)=>{const h=setTimeout(()=>a(new Error(r)),t);try{const p=await o;s(p)}catch(p){a(p)}clearTimeout(h)})}function Ef(o,t){if(typeof t=="string"&&t.startsWith(`${o}:`))return t;if(o.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(o.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${o}`)}function T1(o){return Ef("topic",o)}function $1(o){return Ef("id",o)}function If(o){const[t,r]=o.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function Ur(o,t){return ne.fromMiliseconds((t||Date.now())+ne.toMiliseconds(o))}function Pi(o){return Date.now()>=ne.toMiliseconds(o)}function Ft(o,t){return`${o}${t?`:${t}`:""}`}function oc(o=[],t=[]){return[...new Set([...o,...t])]}async function F1({id:o,topic:t,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let a=s==null?void 0:s.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const h=`${a}/wc?requestId=${o}&sessionTopic=${t}`,p=an();p===Er.browser?h.startsWith("https://")?window.open(h,"_blank","noreferrer noopener"):window.open(h,"_self","noreferrer noopener"):p===Er.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(h)}catch(s){console.error(s)}}async function D1(o,t){try{return await o.getItem(t)||(Es()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}const L1="irn";function Oc(o){return(o==null?void 0:o.relay)||{protocol:L1}}function Eo(o){const t=a1[o];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${o}`);return t}var j1=Object.defineProperty,ol=Object.getOwnPropertySymbols,q1=Object.prototype.hasOwnProperty,M1=Object.prototype.propertyIsEnumerable,al=(o,t,r)=>t in o?j1(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,U1=(o,t)=>{for(var r in t||(t={}))q1.call(t,r)&&al(o,r,t[r]);if(ol)for(var r of ol(t))M1.call(t,r)&&al(o,r,t[r]);return o};function z1(o,t="-"){const r={},s="relay"+t;return Object.keys(o).forEach(a=>{if(a.startsWith(s)){const h=a.replace(s,""),p=o[a];r[h]=p}}),r}function cl(o){o=o.includes("wc://")?o.replace("wc://",""):o,o=o.includes("wc:")?o.replace("wc:",""):o;const t=o.indexOf(":"),r=o.indexOf("?")!==-1?o.indexOf("?"):void 0,s=o.substring(0,t),a=o.substring(t+1,r).split("@"),h=typeof r<"u"?o.substring(r):"",p=tn.parse(h);return{protocol:s,topic:k1(a[0]),version:parseInt(a[1],10),symKey:p.symKey,relay:z1(p)}}function k1(o){return o.startsWith("//")?o.substring(2):o}function H1(o,t="-"){const r="relay",s={};return Object.keys(o).forEach(a=>{const h=r+t+a;o[a]&&(s[h]=o[a])}),s}function K1(o){return`${o.protocol}:${o.topic}@${o.version}?`+tn.stringify(U1({symKey:o.symKey},H1(o.relay)))}function Is(o){const t=[];return o.forEach(r=>{const[s,a]=r.split(":");t.push(`${s}:${a}`)}),t}function V1(o){const t=[];return Object.values(o).forEach(r=>{t.push(...Is(r.accounts))}),t}function B1(o,t){const r=[];return Object.values(o).forEach(s=>{Is(s.accounts).includes(t)&&r.push(...s.methods)}),r}function G1(o,t){const r=[];return Object.values(o).forEach(s=>{Is(s.accounts).includes(t)&&r.push(...s.events)}),r}function W1(o,t){const r=Io(o,t);if(r)throw new Error(r.message);const s={};for(const[a,h]of Object.entries(o))s[a]={methods:h.methods,events:h.events,chains:h.accounts.map(p=>`${p.split(":")[0]}:${p.split(":")[1]}`)};return s}function Vc(o){return o.includes(":")}function Ys(o){return Vc(o)?o.split(":")[0]:o}const J1={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Q1={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Z(o,t){const{message:r,code:s}=Q1[o];return{message:t?`${r} ${t}`:r,code:s}}function It(o,t){const{message:r,code:s}=J1[o];return{message:t?`${r} ${t}`:r,code:s}}function Jr(o,t){return Array.isArray(o)?typeof t<"u"&&o.length?o.every(t):!0:!1}function bs(o){return Object.getPrototypeOf(o)===Object.prototype&&Object.keys(o).length}function ir(o){return typeof o>"u"}function kt(o,t){return t&&ir(o)?!0:typeof o=="string"&&!!o.trim().length}function Bc(o,t){return t&&ir(o)?!0:typeof o=="number"&&!isNaN(o)}function Y1(o,t){const{requiredNamespaces:r}=t,s=Object.keys(o.namespaces),a=Object.keys(r);let h=!0;return Bi(a,s)?(s.forEach(p=>{const{accounts:g,methods:w,events:y}=o.namespaces[p],b=Is(g),S=r[p];(!Bi(yf(p,S),b)||!Bi(S.methods,w)||!Bi(S.events,y))&&(h=!1)}),h):!1}function Oo(o){return kt(o,!1)&&o.includes(":")?o.split(":").length===2:!1}function Z1(o){if(kt(o,!1)&&o.includes(":")){const t=o.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&Oo(r)}}return!1}function X1(o){if(kt(o,!1))try{return typeof new URL(o)<"u"}catch{return!1}return!1}function ew(o){var t;return(t=o==null?void 0:o.proposer)==null?void 0:t.publicKey}function tw(o){return o==null?void 0:o.topic}function rw(o,t){let r=null;return kt(o==null?void 0:o.publicKey,!1)||(r=Z("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function ul(o){let t=!0;return Jr(o)?o.length&&(t=o.every(r=>kt(r,!1))):t=!1,t}function iw(o,t,r){let s=null;return Jr(t)&&t.length?t.forEach(a=>{s||Oo(a)||(s=It("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Oo(o)||(s=It("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function sw(o,t,r){let s=null;return Object.entries(o).forEach(([a,h])=>{if(s)return;const p=iw(a,yf(a,h),`${t} ${r}`);p&&(s=p)}),s}function nw(o,t){let r=null;return Jr(o)?o.forEach(s=>{r||Z1(s)||(r=It("UNSUPPORTED_ACCOUNTS",`${t}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=It("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function ow(o,t){let r=null;return Object.values(o).forEach(s=>{if(r)return;const a=nw(s==null?void 0:s.accounts,`${t} namespace`);a&&(r=a)}),r}function aw(o,t){let r=null;return ul(o==null?void 0:o.methods)?ul(o==null?void 0:o.events)||(r=It("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=It("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function xf(o,t){let r=null;return Object.values(o).forEach(s=>{if(r)return;const a=aw(s,`${t}, namespace`);a&&(r=a)}),r}function cw(o,t,r){let s=null;if(o&&bs(o)){const a=xf(o,t);a&&(s=a);const h=sw(o,t,r);h&&(s=h)}else s=Z("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return s}function Io(o,t){let r=null;if(o&&bs(o)){const s=xf(o,t);s&&(r=s);const a=ow(o,t);a&&(r=a)}else r=Z("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function Sf(o){return kt(o.protocol,!0)}function uw(o,t){let r=!1;return t&&!o?r=!0:o&&Jr(o)&&o.length&&o.forEach(s=>{r=Sf(s)}),r}function hw(o){return typeof o=="number"}function dr(o){return typeof o<"u"&&typeof o!==null}function lw(o){return!(!o||typeof o!="object"||!o.code||!Bc(o.code,!1)||!o.message||!kt(o.message,!1))}function fw(o){return!(ir(o)||!kt(o.method,!1))}function pw(o){return!(ir(o)||ir(o.result)&&ir(o.error)||!Bc(o.id,!1)||!kt(o.jsonrpc,!1))}function dw(o){return!(ir(o)||!kt(o.name,!1))}function hl(o,t){return!(!Oo(t)||!V1(o).includes(t))}function gw(o,t,r){return kt(r,!1)?B1(o,t).includes(r):!1}function yw(o,t,r){return kt(r,!1)?G1(o,t).includes(r):!1}function ll(o,t,r){let s=null;const a=mw(o),h=vw(t),p=Object.keys(a),g=Object.keys(h),w=fl(Object.keys(o)),y=fl(Object.keys(t)),b=w.filter(S=>!y.includes(S));return b.length&&(s=Z("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${b.toString()}
      Received: ${Object.keys(t).toString()}`)),Bi(p,g)||(s=Z("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${p.toString()}
      Approved: ${g.toString()}`)),Object.keys(t).forEach(S=>{if(!S.includes(":")||s)return;const N=Is(t[S].accounts);N.includes(S)||(s=Z("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${S}
        Required: ${S}
        Approved: ${N.toString()}`))}),p.forEach(S=>{s||(Bi(a[S].methods,h[S].methods)?Bi(a[S].events,h[S].events)||(s=Z("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${S}`)):s=Z("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${S}`))}),s}function mw(o){const t={};return Object.keys(o).forEach(r=>{var s;r.includes(":")?t[r]=o[r]:(s=o[r].chains)==null||s.forEach(a=>{t[a]={methods:o[r].methods,events:o[r].events}})}),t}function fl(o){return[...new Set(o.map(t=>t.includes(":")?t.split(":")[0]:t))]}function vw(o){const t={};return Object.keys(o).forEach(r=>{if(r.includes(":"))t[r]=o[r];else{const s=Is(o[r].accounts);s==null||s.forEach(a=>{t[a]={accounts:o[r].accounts.filter(h=>h.includes(`${a}:`)),methods:o[r].methods,events:o[r].events}})}}),t}function ww(o,t){return Bc(o,!1)&&o<=t.max&&o>=t.min}function pl(){const o=an();return new Promise(t=>{switch(o){case Er.browser:t(bw());break;case Er.reactNative:t(_w());break;case Er.node:t(Ew());break;default:t(!0)}})}function bw(){return Es()&&(navigator==null?void 0:navigator.onLine)}async function _w(){if(_s()&&typeof global<"u"&&global!=null&&global.NetInfo){const o=await(global==null?void 0:global.NetInfo.fetch());return o==null?void 0:o.isConnected}return!0}function Ew(){return!0}function Iw(o){switch(an()){case Er.browser:xw(o);break;case Er.reactNative:Sw(o);break}}function xw(o){!_s()&&Es()&&(window.addEventListener("online",()=>o(!0)),window.addEventListener("offline",()=>o(!1)))}function Sw(o){_s()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(t=>o(t==null?void 0:t.isConnected)))}const ac={};let yo=class{static get(t){return ac[t]}static set(t,r){ac[t]=r}static delete(t){delete ac[t]}};const Pw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Ow=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Cw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Aw(o,t){if(o==="__proto__"||o==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Nw(o);return}return t}function Nw(o){console.warn(`[destr] Dropping "${o}" key to prevent prototype pollution.`)}function mo(o,t={}){if(typeof o!="string")return o;const r=o.trim();if(o[0]==='"'&&o.at(-1)==='"'&&!o.includes("\\"))return r.slice(1,-1);if(r.length<=9){const s=r.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!Cw.test(o)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return o}try{if(Pw.test(o)||Ow.test(o)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(o,Aw)}return JSON.parse(o)}catch(s){if(t.strict)throw s;return o}}function Rw(o){return!o||typeof o.then!="function"?Promise.resolve(o):o}function zt(o,...t){try{return Rw(o(...t))}catch(r){return Promise.reject(r)}}function Tw(o){const t=typeof o;return o===null||t!=="object"&&t!=="function"}function $w(o){const t=Object.getPrototypeOf(o);return!t||t.isPrototypeOf(Object)}function xo(o){if(Tw(o))return String(o);if($w(o)||Array.isArray(o))return JSON.stringify(o);if(typeof o.toJSON=="function")return xo(o.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Pf(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const Cc="base64:";function Fw(o){if(typeof o=="string")return o;Pf();const t=Buffer.from(o).toString("base64");return Cc+t}function Dw(o){return typeof o!="string"||!o.startsWith(Cc)?o:(Pf(),Buffer.from(o.slice(Cc.length),"base64"))}function pr(o){return o?o.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function Lw(...o){return pr(o.join(":"))}function vo(o){return o=pr(o),o?o+":":""}const jw="memory",qw=()=>{const o=new Map;return{name:jw,options:{},hasItem(t){return o.has(t)},getItem(t){return o.get(t)??null},getItemRaw(t){return o.get(t)??null},setItem(t,r){o.set(t,r)},setItemRaw(t,r){o.set(t,r)},removeItem(t){o.delete(t)},getKeys(){return Array.from(o.keys())},clear(){o.clear()},dispose(){o.clear()}}};function Mw(o={}){const t={mounts:{"":o.driver||qw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=y=>{for(const b of t.mountpoints)if(y.startsWith(b))return{base:b,relativeKey:y.slice(b.length),driver:t.mounts[b]};return{base:"",relativeKey:y,driver:t.mounts[""]}},s=(y,b)=>t.mountpoints.filter(S=>S.startsWith(y)||b&&y.startsWith(S)).map(S=>({relativeBase:y.length>S.length?y.slice(S.length):void 0,mountpoint:S,driver:t.mounts[S]})),a=(y,b)=>{if(t.watching){b=pr(b);for(const S of t.watchListeners)S(y,b)}},h=async()=>{if(!t.watching){t.watching=!0;for(const y in t.mounts)t.unwatch[y]=await dl(t.mounts[y],a,y)}},p=async()=>{if(t.watching){for(const y in t.unwatch)await t.unwatch[y]();t.unwatch={},t.watching=!1}},g=(y,b,S)=>{const N=new Map,K=j=>{let J=N.get(j.base);return J||(J={driver:j.driver,base:j.base,items:[]},N.set(j.base,J)),J};for(const j of y){const J=typeof j=="string",oe=pr(J?j:j.key),fe=J?void 0:j.value,C=J||!j.options?b:{...b,...j.options},$=r(oe);K($).items.push({key:oe,value:fe,relativeKey:$.relativeKey,options:C})}return Promise.all([...N.values()].map(j=>S(j))).then(j=>j.flat())},w={hasItem(y,b={}){y=pr(y);const{relativeKey:S,driver:N}=r(y);return zt(N.hasItem,S,b)},getItem(y,b={}){y=pr(y);const{relativeKey:S,driver:N}=r(y);return zt(N.getItem,S,b).then(K=>mo(K))},getItems(y,b){return g(y,b,S=>S.driver.getItems?zt(S.driver.getItems,S.items.map(N=>({key:N.relativeKey,options:N.options})),b).then(N=>N.map(K=>({key:Lw(S.base,K.key),value:mo(K.value)}))):Promise.all(S.items.map(N=>zt(S.driver.getItem,N.relativeKey,N.options).then(K=>({key:N.key,value:mo(K)})))))},getItemRaw(y,b={}){y=pr(y);const{relativeKey:S,driver:N}=r(y);return N.getItemRaw?zt(N.getItemRaw,S,b):zt(N.getItem,S,b).then(K=>Dw(K))},async setItem(y,b,S={}){if(b===void 0)return w.removeItem(y);y=pr(y);const{relativeKey:N,driver:K}=r(y);K.setItem&&(await zt(K.setItem,N,xo(b),S),K.watch||a("update",y))},async setItems(y,b){await g(y,b,async S=>{S.driver.setItems&&await zt(S.driver.setItems,S.items.map(N=>({key:N.relativeKey,value:xo(N.value),options:N.options})),b),S.driver.setItem&&await Promise.all(S.items.map(N=>zt(S.driver.setItem,N.relativeKey,xo(N.value),N.options)))})},async setItemRaw(y,b,S={}){if(b===void 0)return w.removeItem(y,S);y=pr(y);const{relativeKey:N,driver:K}=r(y);if(K.setItemRaw)await zt(K.setItemRaw,N,b,S);else if(K.setItem)await zt(K.setItem,N,Fw(b),S);else return;K.watch||a("update",y)},async removeItem(y,b={}){typeof b=="boolean"&&(b={removeMeta:b}),y=pr(y);const{relativeKey:S,driver:N}=r(y);N.removeItem&&(await zt(N.removeItem,S,b),(b.removeMeta||b.removeMata)&&await zt(N.removeItem,S+"$",b),N.watch||a("remove",y))},async getMeta(y,b={}){typeof b=="boolean"&&(b={nativeOnly:b}),y=pr(y);const{relativeKey:S,driver:N}=r(y),K=Object.create(null);if(N.getMeta&&Object.assign(K,await zt(N.getMeta,S,b)),!b.nativeOnly){const j=await zt(N.getItem,S+"$",b).then(J=>mo(J));j&&typeof j=="object"&&(typeof j.atime=="string"&&(j.atime=new Date(j.atime)),typeof j.mtime=="string"&&(j.mtime=new Date(j.mtime)),Object.assign(K,j))}return K},setMeta(y,b,S={}){return this.setItem(y+"$",b,S)},removeMeta(y,b={}){return this.removeItem(y+"$",b)},async getKeys(y,b={}){y=vo(y);const S=s(y,!0);let N=[];const K=[];for(const j of S){const oe=(await zt(j.driver.getKeys,j.relativeBase,b)).map(fe=>j.mountpoint+pr(fe)).filter(fe=>!N.some(C=>fe.startsWith(C)));K.push(...oe),N=[j.mountpoint,...N.filter(fe=>!fe.startsWith(j.mountpoint))]}return y?K.filter(j=>j.startsWith(y)&&!j.endsWith("$")):K.filter(j=>!j.endsWith("$"))},async clear(y,b={}){y=vo(y),await Promise.all(s(y,!1).map(async S=>{if(S.driver.clear)return zt(S.driver.clear,S.relativeBase,b);if(S.driver.removeItem){const N=await S.driver.getKeys(S.relativeBase||"",b);return Promise.all(N.map(K=>S.driver.removeItem(K,b)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(y=>gl(y)))},async watch(y){return await h(),t.watchListeners.push(y),async()=>{t.watchListeners=t.watchListeners.filter(b=>b!==y),t.watchListeners.length===0&&await p()}},async unwatch(){t.watchListeners=[],await p()},mount(y,b){if(y=vo(y),y&&t.mounts[y])throw new Error(`already mounted at ${y}`);return y&&(t.mountpoints.push(y),t.mountpoints.sort((S,N)=>N.length-S.length)),t.mounts[y]=b,t.watching&&Promise.resolve(dl(b,a,y)).then(S=>{t.unwatch[y]=S}).catch(console.error),w},async unmount(y,b=!0){y=vo(y),!(!y||!t.mounts[y])&&(t.watching&&y in t.unwatch&&(t.unwatch[y](),delete t.unwatch[y]),b&&await gl(t.mounts[y]),t.mountpoints=t.mountpoints.filter(S=>S!==y),delete t.mounts[y])},getMount(y=""){y=pr(y)+":";const b=r(y);return{driver:b.driver,base:b.base}},getMounts(y="",b={}){return y=pr(y),s(y,b.parents).map(N=>({driver:N.driver,base:N.mountpoint}))}};return w}function dl(o,t,r){return o.watch?o.watch((s,a)=>t(s,r+a)):()=>{}}async function gl(o){typeof o.dispose=="function"&&await zt(o.dispose)}function Wi(o){return new Promise((t,r)=>{o.oncomplete=o.onsuccess=()=>t(o.result),o.onabort=o.onerror=()=>r(o.error)})}function Of(o,t){const r=indexedDB.open(o);r.onupgradeneeded=()=>r.result.createObjectStore(t);const s=Wi(r);return(a,h)=>s.then(p=>h(p.transaction(t,a).objectStore(t)))}let cc;function cn(){return cc||(cc=Of("keyval-store","keyval")),cc}function yl(o,t=cn()){return t("readonly",r=>Wi(r.get(o)))}function Uw(o,t,r=cn()){return r("readwrite",s=>(s.put(t,o),Wi(s.transaction)))}function zw(o,t=cn()){return t("readwrite",r=>(r.delete(o),Wi(r.transaction)))}function kw(o=cn()){return o("readwrite",t=>(t.clear(),Wi(t.transaction)))}function Hw(o,t){return o.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Wi(o.transaction)}function Kw(o=cn()){return o("readonly",t=>{if(t.getAllKeys)return Wi(t.getAllKeys());const r=[];return Hw(t,s=>r.push(s.key)).then(()=>r)})}const Vw="idb-keyval";var Bw=(o={})=>{const t=o.base&&o.base.length>0?`${o.base}:`:"",r=a=>t+a;let s;return o.dbName&&o.storeName&&(s=Of(o.dbName,o.storeName)),{name:Vw,options:o,async hasItem(a){return!(typeof await yl(r(a),s)>"u")},async getItem(a){return await yl(r(a),s)??null},setItem(a,h){return Uw(r(a),h,s)},removeItem(a){return zw(r(a),s)},getKeys(){return Kw(s)},clear(){return kw(s)}}};const Gw="WALLET_CONNECT_V2_INDEXED_DB",Ww="keyvaluestorage";let Jw=class{constructor(){this.indexedDb=Mw({driver:Bw({dbName:Gw,storeName:Ww})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,nn(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var uc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},So={exports:{}};(function(){let o;function t(){}o=t,o.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},o.prototype.setItem=function(r,s){this[r]=String(s)},o.prototype.removeItem=function(r){delete this[r]},o.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},o.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof uc<"u"&&uc.localStorage?So.exports=uc.localStorage:typeof window<"u"&&window.localStorage?So.exports=window.localStorage:So.exports=new t})();function Qw(o){var t;return[o[0],To((t=o[1])!=null?t:"")]}class Yw{constructor(){this.localStorage=So.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Qw)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return To(r)}async setItem(t,r){this.localStorage.setItem(t,nn(r))}async removeItem(t){this.localStorage.removeItem(t)}}const Zw="wc_storage_version",ml=1,Xw=async(o,t,r)=>{const s=Zw,a=await t.getItem(s);if(a&&a>=ml){r(t);return}const h=await o.getKeys();if(!h.length){r(t);return}const p=[];for(;h.length;){const g=h.shift();if(!g)continue;const w=g.toLowerCase();if(w.includes("wc@")||w.includes("walletconnect")||w.includes("wc_")||w.includes("wallet_connect")){const y=await o.getItem(g);await t.setItem(g,y),p.push(g)}}await t.setItem(s,ml),r(t),eb(o,p)},eb=async(o,t)=>{t.length&&t.forEach(async r=>{await o.removeItem(r)})};let tb=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new Yw;this.storage=t;try{const r=new Jw;Xw(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var xs={},Ks={},hc={},Vs={};class Ji{}const rb=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Ji},Symbol.toStringTag,{value:"Module"})),ib=Zv(rb);var vl;function sb(){if(vl)return Vs;vl=1,Object.defineProperty(Vs,"__esModule",{value:!0}),Vs.IHeartBeat=void 0;const o=ib;class t extends o.IEvents{constructor(s){super()}}return Vs.IHeartBeat=t,Vs}var wl;function Cf(){return wl||(wl=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),sn.__exportStar(sb(),o)}(hc)),hc}var lc={},Ki={},bl;function nb(){if(bl)return Ki;bl=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.HEARTBEAT_EVENTS=Ki.HEARTBEAT_INTERVAL=void 0;const o=ne;return Ki.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,Ki.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ki}var _l;function Af(){return _l||(_l=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),sn.__exportStar(nb(),o)}(lc)),lc}var El;function ob(){if(El)return Ks;El=1,Object.defineProperty(Ks,"__esModule",{value:!0}),Ks.HeartBeat=void 0;const o=sn,t=Qr,r=ne,s=Cf(),a=Af();class h extends s.IHeartBeat{constructor(g){super(g),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||a.HEARTBEAT_INTERVAL}static init(g){return o.__awaiter(this,void 0,void 0,function*(){const w=new h(g);return yield w.init(),w})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,w){this.events.on(g,w)}once(g,w){this.events.once(g,w)}off(g,w){this.events.off(g,w)}removeListener(g,w){this.events.removeListener(g,w)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Ks.HeartBeat=h,Ks}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const t=sn;t.__exportStar(ob(),o),t.__exportStar(Cf(),o),t.__exportStar(Af(),o)})(xs);var Ce={},fc,Il;function ab(){if(Il)return fc;Il=1;function o(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}fc=t;function t(r,s,a){var h=a&&a.stringify||o,p=1;if(typeof r=="object"&&r!==null){var g=s.length+p;if(g===1)return r;var w=new Array(g);w[0]=h(r);for(var y=1;y<g;y++)w[y]=h(s[y]);return w.join(" ")}if(typeof r!="string")return r;var b=s.length;if(b===0)return r;for(var S="",N=1-p,K=-1,j=r&&r.length||0,J=0;J<j;){if(r.charCodeAt(J)===37&&J+1<j){switch(K=K>-1?K:0,r.charCodeAt(J+1)){case 100:case 102:if(N>=b||s[N]==null)break;K<J&&(S+=r.slice(K,J)),S+=Number(s[N]),K=J+2,J++;break;case 105:if(N>=b||s[N]==null)break;K<J&&(S+=r.slice(K,J)),S+=Math.floor(Number(s[N])),K=J+2,J++;break;case 79:case 111:case 106:if(N>=b||s[N]===void 0)break;K<J&&(S+=r.slice(K,J));var oe=typeof s[N];if(oe==="string"){S+="'"+s[N]+"'",K=J+2,J++;break}if(oe==="function"){S+=s[N].name||"<anonymous>",K=J+2,J++;break}S+=h(s[N]),K=J+2,J++;break;case 115:if(N>=b)break;K<J&&(S+=r.slice(K,J)),S+=String(s[N]),K=J+2,J++;break;case 37:K<J&&(S+=r.slice(K,J)),S+="%",K=J+2,J++,N--;break}++N}++J}return K===-1?r:(K<j&&(S+=r.slice(K)),S)}return fc}var pc,xl;function cb(){if(xl)return pc;xl=1;const o=ab();pc=a;const t=q().console||{},r={mapHttpRequest:j,mapHttpResponse:j,wrapRequestSerializer:J,wrapResponseSerializer:J,wrapErrorSerializer:J,req:j,res:j,err:N};function s(I,D){return Array.isArray(I)?I.filter(function(ce){return ce!=="!stdSerializers.err"}):I===!0?Object.keys(D):!1}function a(I){I=I||{},I.browser=I.browser||{};const D=I.browser.transmit;if(D&&typeof D.send!="function")throw Error("pino: transmit option must have a send function");const H=I.browser.write||t;I.browser.write&&(I.browser.asObject=!0);const ce=I.serializers||{},ae=s(I.browser.serialize,ce);let Ee=I.browser.serialize;Array.isArray(I.browser.serialize)&&I.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Ae=["error","fatal","warn","info","debug","trace"];typeof H=="function"&&(H.error=H.fatal=H.warn=H.info=H.debug=H.trace=H),I.enabled===!1&&(I.level="silent");const et=I.level||"info",T=Object.create(H);T.log||(T.log=oe),Object.defineProperty(T,"levelVal",{get:Me}),Object.defineProperty(T,"level",{get:Ne,set:ee});const V={transmit:D,serialize:ae,asObject:I.browser.asObject,levels:Ae,timestamp:K(I)};T.levels=a.levels,T.level=et,T.setMaxListeners=T.getMaxListeners=T.emit=T.addListener=T.on=T.prependListener=T.once=T.prependOnceListener=T.removeListener=T.removeAllListeners=T.listeners=T.listenerCount=T.eventNames=T.write=T.flush=oe,T.serializers=ce,T._serialize=ae,T._stdErrSerialize=Ee,T.child=Q,D&&(T._logEvent=S());function Me(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Ne(){return this._level}function ee(W){if(W!=="silent"&&!this.levels.values[W])throw Error("unknown level "+W);this._level=W,h(V,T,"error","log"),h(V,T,"fatal","error"),h(V,T,"warn","error"),h(V,T,"info","log"),h(V,T,"debug","log"),h(V,T,"trace","log")}function Q(W,Y){if(!W)throw new Error("missing bindings for child Pino");Y=Y||{},ae&&W.serializers&&(Y.serializers=W.serializers);const ut=Y.serializers;if(ae&&ut){var ke=Object.assign({},ce,ut),zr=I.browser.serialize===!0?Object.keys(ke):ae;delete W.serializers,w([W],zr,ke,this._stdErrSerialize)}function be(xt){this._childLevel=(xt._childLevel|0)+1,this.error=y(xt,W,"error"),this.fatal=y(xt,W,"fatal"),this.warn=y(xt,W,"warn"),this.info=y(xt,W,"info"),this.debug=y(xt,W,"debug"),this.trace=y(xt,W,"trace"),ke&&(this.serializers=ke,this._serialize=zr),D&&(this._logEvent=S([].concat(xt._logEvent.bindings,W)))}return be.prototype=this,new be(this)}return T}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=r,a.stdTimeFunctions=Object.assign({},{nullTime:fe,epochTime:C,unixTime:$,isoTime:M});function h(I,D,H,ce){const ae=Object.getPrototypeOf(D);D[H]=D.levelVal>D.levels.values[H]?oe:ae[H]?ae[H]:t[H]||t[ce]||oe,p(I,D,H)}function p(I,D,H){!I.transmit&&D[H]===oe||(D[H]=function(ce){return function(){const Ee=I.timestamp(),Ae=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var T=0;T<Ae.length;T++)Ae[T]=arguments[T];if(I.serialize&&!I.asObject&&w(Ae,this._serialize,this.serializers,this._stdErrSerialize),I.asObject?ce.call(et,g(this,H,Ae,Ee)):ce.apply(et,Ae),I.transmit){const V=I.transmit.level||D.level,Me=a.levels.values[V],Ne=a.levels.values[H];if(Ne<Me)return;b(this,{ts:Ee,methodLevel:H,methodValue:Ne,transmitLevel:V,transmitValue:a.levels.values[I.transmit.level||D.level],send:I.transmit.send,val:D.levelVal},Ae)}}}(D[H]))}function g(I,D,H,ce){I._serialize&&w(H,I._serialize,I.serializers,I._stdErrSerialize);const ae=H.slice();let Ee=ae[0];const Ae={};ce&&(Ae.time=ce),Ae.level=a.levels.values[D];let et=(I._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof ae[0]=="object";)Object.assign(Ae,ae.shift());Ee=ae.length?o(ae.shift(),ae):void 0}else typeof Ee=="string"&&(Ee=o(ae.shift(),ae));return Ee!==void 0&&(Ae.msg=Ee),Ae}function w(I,D,H,ce){for(const ae in I)if(ce&&I[ae]instanceof Error)I[ae]=a.stdSerializers.err(I[ae]);else if(typeof I[ae]=="object"&&!Array.isArray(I[ae]))for(const Ee in I[ae])D&&D.indexOf(Ee)>-1&&Ee in H&&(I[ae][Ee]=H[Ee](I[ae][Ee]))}function y(I,D,H){return function(){const ce=new Array(1+arguments.length);ce[0]=D;for(var ae=1;ae<ce.length;ae++)ce[ae]=arguments[ae-1];return I[H].apply(this,ce)}}function b(I,D,H){const ce=D.send,ae=D.ts,Ee=D.methodLevel,Ae=D.methodValue,et=D.val,T=I._logEvent.bindings;w(H,I._serialize||Object.keys(I.serializers),I.serializers,I._stdErrSerialize===void 0?!0:I._stdErrSerialize),I._logEvent.ts=ae,I._logEvent.messages=H.filter(function(V){return T.indexOf(V)===-1}),I._logEvent.level.label=Ee,I._logEvent.level.value=Ae,ce(Ee,I._logEvent,et),I._logEvent=S(T)}function S(I){return{ts:0,messages:[],bindings:I||[],level:{label:"",value:0}}}function N(I){const D={type:I.constructor.name,msg:I.message,stack:I.stack};for(const H in I)D[H]===void 0&&(D[H]=I[H]);return D}function K(I){return typeof I.timestamp=="function"?I.timestamp:I.timestamp===!1?fe:C}function j(){return{}}function J(I){return I}function oe(){}function fe(){return!1}function C(){return Date.now()}function $(){return Math.round(Date.now()/1e3)}function M(){return new Date(Date.now()).toISOString()}function q(){function I(D){return typeof D<"u"&&D}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return I(self)||I(window)||I(this)||{}}}return pc}var Vi={},Sl;function Nf(){return Sl||(Sl=1,Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.PINO_CUSTOM_CONTEXT_KEY=Vi.PINO_LOGGER_DEFAULTS=void 0,Vi.PINO_LOGGER_DEFAULTS={level:"info"},Vi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Vi}var rr={},Pl;function ub(){if(Pl)return rr;Pl=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.generateChildLogger=rr.formatChildLoggerContext=rr.getLoggerContext=rr.setBrowserLoggerContext=rr.getBrowserLoggerContext=rr.getDefaultLoggerOptions=void 0;const o=Nf();function t(g){return Object.assign(Object.assign({},g),{level:(g==null?void 0:g.level)||o.PINO_LOGGER_DEFAULTS.level})}rr.getDefaultLoggerOptions=t;function r(g,w=o.PINO_CUSTOM_CONTEXT_KEY){return g[w]||""}rr.getBrowserLoggerContext=r;function s(g,w,y=o.PINO_CUSTOM_CONTEXT_KEY){return g[y]=w,g}rr.setBrowserLoggerContext=s;function a(g,w=o.PINO_CUSTOM_CONTEXT_KEY){let y="";return typeof g.bindings>"u"?y=r(g,w):y=g.bindings().context||"",y}rr.getLoggerContext=a;function h(g,w,y=o.PINO_CUSTOM_CONTEXT_KEY){const b=a(g,y);return b.trim()?`${b}/${w}`:w}rr.formatChildLoggerContext=h;function p(g,w,y=o.PINO_CUSTOM_CONTEXT_KEY){const b=h(g,w,y),S=g.child({context:b});return s(S,b,y)}return rr.generateChildLogger=p,rr}(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.pino=void 0;const t=sn,r=t.__importDefault(cb());Object.defineProperty(o,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(Nf(),o),t.__exportStar(ub(),o)})(Ce);class hb extends Ji{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let lb=class extends Ji{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},fb=class{constructor(t,r){this.logger=t,this.core=r}},pb=class extends Ji{constructor(t,r){super(),this.relayer=t,this.logger=r}},db=class extends Ji{constructor(t){super()}},gb=class{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}};class yb extends Ji{constructor(t,r){super(),this.relayer=t,this.logger=r}}let mb=class extends Ji{constructor(t,r){super(),this.core=t,this.logger=r}},vb=class{constructor(t,r){this.projectId=t,this.logger=r}},wb=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},bb=class{constructor(t){this.client=t}};var Gc={},Rf={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var t=Xv,r=ff;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var s=function(){function g(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},g.prototype.update=function(w,y){if(y===void 0&&(y=w.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var b=0;if(this._bytesHashed+=y,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&y>0;)this._buffer[this._bufferLength++]=w[b++],y--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(y>=this.blockSize&&(b=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,w,b,y),y%=this.blockSize);y>0;)this._buffer[this._bufferLength++]=w[b++],y--;return this},g.prototype.finish=function(w){if(!this._finished){var y=this._bytesHashed,b=this._bufferLength,S=y/536870912|0,N=y<<3,K=y%128<112?128:256;this._buffer[b]=128;for(var j=b+1;j<K-8;j++)this._buffer[j]=0;t.writeUint32BE(S,this._buffer,K-8),t.writeUint32BE(N,this._buffer,K-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,K),this._finished=!0}for(var j=0;j<this.digestLength/8;j++)t.writeUint32BE(this._stateHi[j],w,j*8),t.writeUint32BE(this._stateLo[j],w,j*8+4);return this},g.prototype.digest=function(){var w=new Uint8Array(this.digestLength);return this.finish(w),w},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(w){return this._stateHi.set(w.stateHi),this._stateLo.set(w.stateLo),this._bufferLength=w.bufferLength,w.buffer&&this._buffer.set(w.buffer),this._bytesHashed=w.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(w){r.wipe(w.stateHi),r.wipe(w.stateLo),w.buffer&&r.wipe(w.buffer),w.bufferLength=0,w.bytesHashed=0},g}();o.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(g,w,y,b,S,N,K){for(var j=y[0],J=y[1],oe=y[2],fe=y[3],C=y[4],$=y[5],M=y[6],q=y[7],I=b[0],D=b[1],H=b[2],ce=b[3],ae=b[4],Ee=b[5],Ae=b[6],et=b[7],T,V,Me,Ne,ee,Q,W,Y;K>=128;){for(var ut=0;ut<16;ut++){var ke=8*ut+N;g[ut]=t.readUint32BE(S,ke),w[ut]=t.readUint32BE(S,ke+4)}for(var ut=0;ut<80;ut++){var zr=j,be=J,xt=oe,L=fe,F=C,A=$,u=M,E=q,ie=I,pe=D,ve=H,Re=ce,$e=ae,xe=Ee,St=Ae,vt=et;if(T=q,V=et,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=(C>>>14|ae<<32-14)^(C>>>18|ae<<32-18)^(ae>>>41-32|C<<32-(41-32)),V=(ae>>>14|C<<32-14)^(ae>>>18|C<<32-18)^(C>>>41-32|ae<<32-(41-32)),ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,T=C&$^~C&M,V=ae&Ee^~ae&Ae,ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,T=a[ut*2],V=a[ut*2+1],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,T=g[ut%16],V=w[ut%16],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,Me=W&65535|Y<<16,Ne=ee&65535|Q<<16,T=Me,V=Ne,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=(j>>>28|I<<32-28)^(I>>>34-32|j<<32-(34-32))^(I>>>39-32|j<<32-(39-32)),V=(I>>>28|j<<32-28)^(j>>>34-32|I<<32-(34-32))^(j>>>39-32|I<<32-(39-32)),ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,T=j&J^j&oe^J&oe,V=I&D^I&H^D&H,ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,E=W&65535|Y<<16,vt=ee&65535|Q<<16,T=L,V=Re,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=Me,V=Ne,ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,L=W&65535|Y<<16,Re=ee&65535|Q<<16,J=zr,oe=be,fe=xt,C=L,$=F,M=A,q=u,j=E,D=ie,H=pe,ce=ve,ae=Re,Ee=$e,Ae=xe,et=St,I=vt,ut%16===15)for(var ke=0;ke<16;ke++)T=g[ke],V=w[ke],ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=g[(ke+9)%16],V=w[(ke+9)%16],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Me=g[(ke+1)%16],Ne=w[(ke+1)%16],T=(Me>>>1|Ne<<32-1)^(Me>>>8|Ne<<32-8)^Me>>>7,V=(Ne>>>1|Me<<32-1)^(Ne>>>8|Me<<32-8)^(Ne>>>7|Me<<32-7),ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Me=g[(ke+14)%16],Ne=w[(ke+14)%16],T=(Me>>>19|Ne<<32-19)^(Ne>>>61-32|Me<<32-(61-32))^Me>>>6,V=(Ne>>>19|Me<<32-19)^(Me>>>61-32|Ne<<32-(61-32))^(Ne>>>6|Me<<32-6),ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,g[ke]=W&65535|Y<<16,w[ke]=ee&65535|Q<<16}T=j,V=I,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[0],V=b[0],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[0]=j=W&65535|Y<<16,b[0]=I=ee&65535|Q<<16,T=J,V=D,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[1],V=b[1],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[1]=J=W&65535|Y<<16,b[1]=D=ee&65535|Q<<16,T=oe,V=H,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[2],V=b[2],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[2]=oe=W&65535|Y<<16,b[2]=H=ee&65535|Q<<16,T=fe,V=ce,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[3],V=b[3],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[3]=fe=W&65535|Y<<16,b[3]=ce=ee&65535|Q<<16,T=C,V=ae,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[4],V=b[4],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[4]=C=W&65535|Y<<16,b[4]=ae=ee&65535|Q<<16,T=$,V=Ee,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[5],V=b[5],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[5]=$=W&65535|Y<<16,b[5]=Ee=ee&65535|Q<<16,T=M,V=Ae,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[6],V=b[6],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[6]=M=W&65535|Y<<16,b[6]=Ae=ee&65535|Q<<16,T=q,V=et,ee=V&65535,Q=V>>>16,W=T&65535,Y=T>>>16,T=y[7],V=b[7],ee+=V&65535,Q+=V>>>16,W+=T&65535,Y+=T>>>16,Q+=ee>>>16,W+=Q>>>16,Y+=W>>>16,y[7]=q=W&65535|Y<<16,b[7]=et=ee&65535|Q<<16,N+=128,K-=128}return N}function p(g){var w=new s;w.update(g);var y=w.digest();return w.clean(),y}o.hash=p})(Rf);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const t=Ro,r=Rf,s=ff;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function a(L){const F=new Float64Array(16);if(L)for(let A=0;A<L.length;A++)F[A]=L[A];return F}const h=new Uint8Array(32);h[0]=9;const p=a(),g=a([1]),w=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),y=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),b=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),S=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),N=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function K(L,F){for(let A=0;A<16;A++)L[A]=F[A]|0}function j(L){let F=1;for(let A=0;A<16;A++){let u=L[A]+F+65535;F=Math.floor(u/65536),L[A]=u-F*65536}L[0]+=F-1+37*(F-1)}function J(L,F,A){const u=~(A-1);for(let E=0;E<16;E++){const ie=u&(L[E]^F[E]);L[E]^=ie,F[E]^=ie}}function oe(L,F){const A=a(),u=a();for(let E=0;E<16;E++)u[E]=F[E];j(u),j(u),j(u);for(let E=0;E<2;E++){A[0]=u[0]-65517;for(let pe=1;pe<15;pe++)A[pe]=u[pe]-65535-(A[pe-1]>>16&1),A[pe-1]&=65535;A[15]=u[15]-32767-(A[14]>>16&1);const ie=A[15]>>16&1;A[14]&=65535,J(u,A,1-ie)}for(let E=0;E<16;E++)L[2*E]=u[E]&255,L[2*E+1]=u[E]>>8}function fe(L,F){let A=0;for(let u=0;u<32;u++)A|=L[u]^F[u];return(1&A-1>>>8)-1}function C(L,F){const A=new Uint8Array(32),u=new Uint8Array(32);return oe(A,L),oe(u,F),fe(A,u)}function $(L){const F=new Uint8Array(32);return oe(F,L),F[0]&1}function M(L,F){for(let A=0;A<16;A++)L[A]=F[2*A]+(F[2*A+1]<<8);L[15]&=32767}function q(L,F,A){for(let u=0;u<16;u++)L[u]=F[u]+A[u]}function I(L,F,A){for(let u=0;u<16;u++)L[u]=F[u]-A[u]}function D(L,F,A){let u,E,ie=0,pe=0,ve=0,Re=0,$e=0,xe=0,St=0,vt=0,nt=0,De=0,Je=0,Qe=0,ot=0,Ue=0,Ye=0,Te=0,He=0,ht=0,je=0,Pt=0,Dt=0,Ht=0,Kt=0,qt=0,Qt=0,or=0,kr=0,Yt=0,Yr=0,di=0,Ni=0,lt=A[0],tt=A[1],ft=A[2],pt=A[3],at=A[4],rt=A[5],Ot=A[6],Ct=A[7],dt=A[8],At=A[9],gt=A[10],wt=A[11],yt=A[12],We=A[13],Nt=A[14],Rt=A[15];u=F[0],ie+=u*lt,pe+=u*tt,ve+=u*ft,Re+=u*pt,$e+=u*at,xe+=u*rt,St+=u*Ot,vt+=u*Ct,nt+=u*dt,De+=u*At,Je+=u*gt,Qe+=u*wt,ot+=u*yt,Ue+=u*We,Ye+=u*Nt,Te+=u*Rt,u=F[1],pe+=u*lt,ve+=u*tt,Re+=u*ft,$e+=u*pt,xe+=u*at,St+=u*rt,vt+=u*Ot,nt+=u*Ct,De+=u*dt,Je+=u*At,Qe+=u*gt,ot+=u*wt,Ue+=u*yt,Ye+=u*We,Te+=u*Nt,He+=u*Rt,u=F[2],ve+=u*lt,Re+=u*tt,$e+=u*ft,xe+=u*pt,St+=u*at,vt+=u*rt,nt+=u*Ot,De+=u*Ct,Je+=u*dt,Qe+=u*At,ot+=u*gt,Ue+=u*wt,Ye+=u*yt,Te+=u*We,He+=u*Nt,ht+=u*Rt,u=F[3],Re+=u*lt,$e+=u*tt,xe+=u*ft,St+=u*pt,vt+=u*at,nt+=u*rt,De+=u*Ot,Je+=u*Ct,Qe+=u*dt,ot+=u*At,Ue+=u*gt,Ye+=u*wt,Te+=u*yt,He+=u*We,ht+=u*Nt,je+=u*Rt,u=F[4],$e+=u*lt,xe+=u*tt,St+=u*ft,vt+=u*pt,nt+=u*at,De+=u*rt,Je+=u*Ot,Qe+=u*Ct,ot+=u*dt,Ue+=u*At,Ye+=u*gt,Te+=u*wt,He+=u*yt,ht+=u*We,je+=u*Nt,Pt+=u*Rt,u=F[5],xe+=u*lt,St+=u*tt,vt+=u*ft,nt+=u*pt,De+=u*at,Je+=u*rt,Qe+=u*Ot,ot+=u*Ct,Ue+=u*dt,Ye+=u*At,Te+=u*gt,He+=u*wt,ht+=u*yt,je+=u*We,Pt+=u*Nt,Dt+=u*Rt,u=F[6],St+=u*lt,vt+=u*tt,nt+=u*ft,De+=u*pt,Je+=u*at,Qe+=u*rt,ot+=u*Ot,Ue+=u*Ct,Ye+=u*dt,Te+=u*At,He+=u*gt,ht+=u*wt,je+=u*yt,Pt+=u*We,Dt+=u*Nt,Ht+=u*Rt,u=F[7],vt+=u*lt,nt+=u*tt,De+=u*ft,Je+=u*pt,Qe+=u*at,ot+=u*rt,Ue+=u*Ot,Ye+=u*Ct,Te+=u*dt,He+=u*At,ht+=u*gt,je+=u*wt,Pt+=u*yt,Dt+=u*We,Ht+=u*Nt,Kt+=u*Rt,u=F[8],nt+=u*lt,De+=u*tt,Je+=u*ft,Qe+=u*pt,ot+=u*at,Ue+=u*rt,Ye+=u*Ot,Te+=u*Ct,He+=u*dt,ht+=u*At,je+=u*gt,Pt+=u*wt,Dt+=u*yt,Ht+=u*We,Kt+=u*Nt,qt+=u*Rt,u=F[9],De+=u*lt,Je+=u*tt,Qe+=u*ft,ot+=u*pt,Ue+=u*at,Ye+=u*rt,Te+=u*Ot,He+=u*Ct,ht+=u*dt,je+=u*At,Pt+=u*gt,Dt+=u*wt,Ht+=u*yt,Kt+=u*We,qt+=u*Nt,Qt+=u*Rt,u=F[10],Je+=u*lt,Qe+=u*tt,ot+=u*ft,Ue+=u*pt,Ye+=u*at,Te+=u*rt,He+=u*Ot,ht+=u*Ct,je+=u*dt,Pt+=u*At,Dt+=u*gt,Ht+=u*wt,Kt+=u*yt,qt+=u*We,Qt+=u*Nt,or+=u*Rt,u=F[11],Qe+=u*lt,ot+=u*tt,Ue+=u*ft,Ye+=u*pt,Te+=u*at,He+=u*rt,ht+=u*Ot,je+=u*Ct,Pt+=u*dt,Dt+=u*At,Ht+=u*gt,Kt+=u*wt,qt+=u*yt,Qt+=u*We,or+=u*Nt,kr+=u*Rt,u=F[12],ot+=u*lt,Ue+=u*tt,Ye+=u*ft,Te+=u*pt,He+=u*at,ht+=u*rt,je+=u*Ot,Pt+=u*Ct,Dt+=u*dt,Ht+=u*At,Kt+=u*gt,qt+=u*wt,Qt+=u*yt,or+=u*We,kr+=u*Nt,Yt+=u*Rt,u=F[13],Ue+=u*lt,Ye+=u*tt,Te+=u*ft,He+=u*pt,ht+=u*at,je+=u*rt,Pt+=u*Ot,Dt+=u*Ct,Ht+=u*dt,Kt+=u*At,qt+=u*gt,Qt+=u*wt,or+=u*yt,kr+=u*We,Yt+=u*Nt,Yr+=u*Rt,u=F[14],Ye+=u*lt,Te+=u*tt,He+=u*ft,ht+=u*pt,je+=u*at,Pt+=u*rt,Dt+=u*Ot,Ht+=u*Ct,Kt+=u*dt,qt+=u*At,Qt+=u*gt,or+=u*wt,kr+=u*yt,Yt+=u*We,Yr+=u*Nt,di+=u*Rt,u=F[15],Te+=u*lt,He+=u*tt,ht+=u*ft,je+=u*pt,Pt+=u*at,Dt+=u*rt,Ht+=u*Ot,Kt+=u*Ct,qt+=u*dt,Qt+=u*At,or+=u*gt,kr+=u*wt,Yt+=u*yt,Yr+=u*We,di+=u*Nt,Ni+=u*Rt,ie+=38*He,pe+=38*ht,ve+=38*je,Re+=38*Pt,$e+=38*Dt,xe+=38*Ht,St+=38*Kt,vt+=38*qt,nt+=38*Qt,De+=38*or,Je+=38*kr,Qe+=38*Yt,ot+=38*Yr,Ue+=38*di,Ye+=38*Ni,E=1,u=ie+E+65535,E=Math.floor(u/65536),ie=u-E*65536,u=pe+E+65535,E=Math.floor(u/65536),pe=u-E*65536,u=ve+E+65535,E=Math.floor(u/65536),ve=u-E*65536,u=Re+E+65535,E=Math.floor(u/65536),Re=u-E*65536,u=$e+E+65535,E=Math.floor(u/65536),$e=u-E*65536,u=xe+E+65535,E=Math.floor(u/65536),xe=u-E*65536,u=St+E+65535,E=Math.floor(u/65536),St=u-E*65536,u=vt+E+65535,E=Math.floor(u/65536),vt=u-E*65536,u=nt+E+65535,E=Math.floor(u/65536),nt=u-E*65536,u=De+E+65535,E=Math.floor(u/65536),De=u-E*65536,u=Je+E+65535,E=Math.floor(u/65536),Je=u-E*65536,u=Qe+E+65535,E=Math.floor(u/65536),Qe=u-E*65536,u=ot+E+65535,E=Math.floor(u/65536),ot=u-E*65536,u=Ue+E+65535,E=Math.floor(u/65536),Ue=u-E*65536,u=Ye+E+65535,E=Math.floor(u/65536),Ye=u-E*65536,u=Te+E+65535,E=Math.floor(u/65536),Te=u-E*65536,ie+=E-1+37*(E-1),E=1,u=ie+E+65535,E=Math.floor(u/65536),ie=u-E*65536,u=pe+E+65535,E=Math.floor(u/65536),pe=u-E*65536,u=ve+E+65535,E=Math.floor(u/65536),ve=u-E*65536,u=Re+E+65535,E=Math.floor(u/65536),Re=u-E*65536,u=$e+E+65535,E=Math.floor(u/65536),$e=u-E*65536,u=xe+E+65535,E=Math.floor(u/65536),xe=u-E*65536,u=St+E+65535,E=Math.floor(u/65536),St=u-E*65536,u=vt+E+65535,E=Math.floor(u/65536),vt=u-E*65536,u=nt+E+65535,E=Math.floor(u/65536),nt=u-E*65536,u=De+E+65535,E=Math.floor(u/65536),De=u-E*65536,u=Je+E+65535,E=Math.floor(u/65536),Je=u-E*65536,u=Qe+E+65535,E=Math.floor(u/65536),Qe=u-E*65536,u=ot+E+65535,E=Math.floor(u/65536),ot=u-E*65536,u=Ue+E+65535,E=Math.floor(u/65536),Ue=u-E*65536,u=Ye+E+65535,E=Math.floor(u/65536),Ye=u-E*65536,u=Te+E+65535,E=Math.floor(u/65536),Te=u-E*65536,ie+=E-1+37*(E-1),L[0]=ie,L[1]=pe,L[2]=ve,L[3]=Re,L[4]=$e,L[5]=xe,L[6]=St,L[7]=vt,L[8]=nt,L[9]=De,L[10]=Je,L[11]=Qe,L[12]=ot,L[13]=Ue,L[14]=Ye,L[15]=Te}function H(L,F){D(L,F,F)}function ce(L,F){const A=a();let u;for(u=0;u<16;u++)A[u]=F[u];for(u=253;u>=0;u--)H(A,A),u!==2&&u!==4&&D(A,A,F);for(u=0;u<16;u++)L[u]=A[u]}function ae(L,F){const A=a();let u;for(u=0;u<16;u++)A[u]=F[u];for(u=250;u>=0;u--)H(A,A),u!==1&&D(A,A,F);for(u=0;u<16;u++)L[u]=A[u]}function Ee(L,F){const A=a(),u=a(),E=a(),ie=a(),pe=a(),ve=a(),Re=a(),$e=a(),xe=a();I(A,L[1],L[0]),I(xe,F[1],F[0]),D(A,A,xe),q(u,L[0],L[1]),q(xe,F[0],F[1]),D(u,u,xe),D(E,L[3],F[3]),D(E,E,y),D(ie,L[2],F[2]),q(ie,ie,ie),I(pe,u,A),I(ve,ie,E),q(Re,ie,E),q($e,u,A),D(L[0],pe,ve),D(L[1],$e,Re),D(L[2],Re,ve),D(L[3],pe,$e)}function Ae(L,F,A){for(let u=0;u<4;u++)J(L[u],F[u],A)}function et(L,F){const A=a(),u=a(),E=a();ce(E,F[2]),D(A,F[0],E),D(u,F[1],E),oe(L,u),L[31]^=$(A)<<7}function T(L,F,A){K(L[0],p),K(L[1],g),K(L[2],g),K(L[3],p);for(let u=255;u>=0;--u){const E=A[u/8|0]>>(u&7)&1;Ae(L,F,E),Ee(F,L),Ee(L,L),Ae(L,F,E)}}function V(L,F){const A=[a(),a(),a(),a()];K(A[0],b),K(A[1],S),K(A[2],g),D(A[3],b,S),T(L,A,F)}function Me(L){if(L.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const F=(0,r.hash)(L);F[0]&=248,F[31]&=127,F[31]|=64;const A=new Uint8Array(32),u=[a(),a(),a(),a()];V(u,F),et(A,u);const E=new Uint8Array(64);return E.set(L),E.set(A,32),{publicKey:A,secretKey:E}}o.generateKeyPairFromSeed=Me;function Ne(L){const F=(0,t.randomBytes)(32,L),A=Me(F);return(0,s.wipe)(F),A}o.generateKeyPair=Ne;function ee(L){if(L.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(L.subarray(32))}o.extractPublicKeyFromSecretKey=ee;const Q=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function W(L,F){let A,u,E,ie;for(u=63;u>=32;--u){for(A=0,E=u-32,ie=u-12;E<ie;++E)F[E]+=A-16*F[u]*Q[E-(u-32)],A=Math.floor((F[E]+128)/256),F[E]-=A*256;F[E]+=A,F[u]=0}for(A=0,E=0;E<32;E++)F[E]+=A-(F[31]>>4)*Q[E],A=F[E]>>8,F[E]&=255;for(E=0;E<32;E++)F[E]-=A*Q[E];for(u=0;u<32;u++)F[u+1]+=F[u]>>8,L[u]=F[u]&255}function Y(L){const F=new Float64Array(64);for(let A=0;A<64;A++)F[A]=L[A];for(let A=0;A<64;A++)L[A]=0;W(L,F)}function ut(L,F){const A=new Float64Array(64),u=[a(),a(),a(),a()],E=(0,r.hash)(L.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const ie=new Uint8Array(64);ie.set(E.subarray(32),32);const pe=new r.SHA512;pe.update(ie.subarray(32)),pe.update(F);const ve=pe.digest();pe.clean(),Y(ve),V(u,ve),et(ie,u),pe.reset(),pe.update(ie.subarray(0,32)),pe.update(L.subarray(32)),pe.update(F);const Re=pe.digest();Y(Re);for(let $e=0;$e<32;$e++)A[$e]=ve[$e];for(let $e=0;$e<32;$e++)for(let xe=0;xe<32;xe++)A[$e+xe]+=Re[$e]*E[xe];return W(ie.subarray(32),A),ie}o.sign=ut;function ke(L,F){const A=a(),u=a(),E=a(),ie=a(),pe=a(),ve=a(),Re=a();return K(L[2],g),M(L[1],F),H(E,L[1]),D(ie,E,w),I(E,E,L[2]),q(ie,L[2],ie),H(pe,ie),H(ve,pe),D(Re,ve,pe),D(A,Re,E),D(A,A,ie),ae(A,A),D(A,A,E),D(A,A,ie),D(A,A,ie),D(L[0],A,ie),H(u,L[0]),D(u,u,ie),C(u,E)&&D(L[0],L[0],N),H(u,L[0]),D(u,u,ie),C(u,E)?-1:($(L[0])===F[31]>>7&&I(L[0],p,L[0]),D(L[3],L[0],L[1]),0)}function zr(L,F,A){const u=new Uint8Array(32),E=[a(),a(),a(),a()],ie=[a(),a(),a(),a()];if(A.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(ke(ie,L))return!1;const pe=new r.SHA512;pe.update(A.subarray(0,32)),pe.update(L),pe.update(F);const ve=pe.digest();return Y(ve),T(E,ie,ve),V(ie,A.subarray(32)),Ee(E,ie),et(u,E),!fe(A,u)}o.verify=zr;function be(L){let F=[a(),a(),a(),a()];if(ke(F,L))throw new Error("Ed25519: invalid public key");let A=a(),u=a(),E=F[1];q(A,g,E),I(u,g,E),ce(u,u),D(A,A,u);let ie=new Uint8Array(32);return oe(ie,A),ie}o.convertPublicKeyToX25519=be;function xt(L){const F=(0,r.hash)(L.subarray(0,32));F[0]&=248,F[31]&=127,F[31]|=64;const A=new Uint8Array(F.subarray(0,32));return(0,s.wipe)(F),A}o.convertSecretKeyToX25519=xt})(Gc);const _b="EdDSA",Eb="JWT",Tf=".",$f="base64url",Ib="utf8",xb="utf8",Sb=":",Pb="did",Ob="key",Ol="base58btc",Cb="z",Ab="K36",Nb=32;function Co(o){return nr(gr(nn(o),Ib),$f)}function Ff(o){const t=gr(Ab,Ol),r=Cb+nr(Ic([t,o]),Ol);return[Pb,Ob,r].join(Sb)}function Rb(o){return nr(o,$f)}function Tb(o){return gr([Co(o.header),Co(o.payload)].join(Tf),xb)}function $b(o){return[Co(o.header),Co(o.payload),Rb(o.signature)].join(Tf)}function Cl(o=Ro.randomBytes(Nb)){return Gc.generateKeyPairFromSeed(o)}async function Fb(o,t,r,s,a=ne.fromMiliseconds(Date.now())){const h={alg:_b,typ:Eb},p=Ff(s.publicKey),g=a+r,w={iss:p,sub:o,aud:t,iat:a,exp:g},y=Tb({header:h,payload:w}),b=Gc.sign(s.secretKey,y);return $b({header:h,payload:w,signature:b})}const Db=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Lb=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Al=o=>o.split("?")[0],Nl=10,jb=Db();let qb=class{constructor(t){if(this.url=t,this.events=new Qr.EventEmitter,this.registering=!1,!Zh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(nn(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!Zh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),a(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const a=new URLSearchParams(t).get("origin"),h=r1.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!i1(t)},p=new jb(t,[],h);Lb()?p.onerror=g=>{const w=g;s(this.emitError(w.error))}:p.on("error",g=>{s(this.emitError(g))}),p.onopen=()=>{this.onOpen(p),r(p)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?To(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),h=jc(t,a);this.events.emit("payload",h)}parseError(t,r=this.url){return s1(t,Al(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Nl&&this.events.setMaxListeners(Nl)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${Al(this.url)}`));return this.events.emit("register_error",r),r}};var Ao={exports:{}};Ao.exports;(function(o,t){var r=200,s="__lodash_hash_undefined__",a=1,h=2,p=9007199254740991,g="[object Arguments]",w="[object Array]",y="[object AsyncFunction]",b="[object Boolean]",S="[object Date]",N="[object Error]",K="[object Function]",j="[object GeneratorFunction]",J="[object Map]",oe="[object Number]",fe="[object Null]",C="[object Object]",$="[object Promise]",M="[object Proxy]",q="[object RegExp]",I="[object Set]",D="[object String]",H="[object Symbol]",ce="[object Undefined]",ae="[object WeakMap]",Ee="[object ArrayBuffer]",Ae="[object DataView]",et="[object Float32Array]",T="[object Float64Array]",V="[object Int8Array]",Me="[object Int16Array]",Ne="[object Int32Array]",ee="[object Uint8Array]",Q="[object Uint8ClampedArray]",W="[object Uint16Array]",Y="[object Uint32Array]",ut=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,zr=/^(?:0|[1-9]\d*)$/,be={};be[et]=be[T]=be[V]=be[Me]=be[Ne]=be[ee]=be[Q]=be[W]=be[Y]=!0,be[g]=be[w]=be[Ee]=be[b]=be[Ae]=be[S]=be[N]=be[K]=be[J]=be[oe]=be[C]=be[q]=be[I]=be[D]=be[ae]=!1;var xt=typeof go=="object"&&go&&go.Object===Object&&go,L=typeof self=="object"&&self&&self.Object===Object&&self,F=xt||L||Function("return this")(),A=t&&!t.nodeType&&t,u=A&&!0&&o&&!o.nodeType&&o,E=u&&u.exports===A,ie=E&&xt.process,pe=function(){try{return ie&&ie.binding&&ie.binding("util")}catch{}}(),ve=pe&&pe.isTypedArray;function Re(m,x){for(var B=-1,te=m==null?0:m.length,Ve=0,ge=[];++B<te;){var Ze=m[B];x(Ze,B,m)&&(ge[Ve++]=Ze)}return ge}function $e(m,x){for(var B=-1,te=x.length,Ve=m.length;++B<te;)m[Ve+B]=x[B];return m}function xe(m,x){for(var B=-1,te=m==null?0:m.length;++B<te;)if(x(m[B],B,m))return!0;return!1}function St(m,x){for(var B=-1,te=Array(m);++B<m;)te[B]=x(B);return te}function vt(m){return function(x){return m(x)}}function nt(m,x){return m.has(x)}function De(m,x){return m==null?void 0:m[x]}function Je(m){var x=-1,B=Array(m.size);return m.forEach(function(te,Ve){B[++x]=[Ve,te]}),B}function Qe(m,x){return function(B){return m(x(B))}}function ot(m){var x=-1,B=Array(m.size);return m.forEach(function(te){B[++x]=te}),B}var Ue=Array.prototype,Ye=Function.prototype,Te=Object.prototype,He=F["__core-js_shared__"],ht=Ye.toString,je=Te.hasOwnProperty,Pt=function(){var m=/[^.]+$/.exec(He&&He.keys&&He.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),Dt=Te.toString,Ht=RegExp("^"+ht.call(je).replace(ut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Kt=E?F.Buffer:void 0,qt=F.Symbol,Qt=F.Uint8Array,or=Te.propertyIsEnumerable,kr=Ue.splice,Yt=qt?qt.toStringTag:void 0,Yr=Object.getOwnPropertySymbols,di=Kt?Kt.isBuffer:void 0,Ni=Qe(Object.keys,Object),lt=yr(F,"DataView"),tt=yr(F,"Map"),ft=yr(F,"Promise"),pt=yr(F,"Set"),at=yr(F,"WeakMap"),rt=yr(Object,"create"),Ot=Xr(lt),Ct=Xr(tt),dt=Xr(ft),At=Xr(pt),gt=Xr(at),wt=qt?qt.prototype:void 0,yt=wt?wt.valueOf:void 0;function We(m){var x=-1,B=m==null?0:m.length;for(this.clear();++x<B;){var te=m[x];this.set(te[0],te[1])}}function Nt(){this.__data__=rt?rt(null):{},this.size=0}function Rt(m){var x=this.has(m)&&delete this.__data__[m];return this.size-=x?1:0,x}function Do(m){var x=this.__data__;if(rt){var B=x[m];return B===s?void 0:B}return je.call(x,m)?x[m]:void 0}function Lo(m){var x=this.__data__;return rt?x[m]!==void 0:je.call(x,m)}function jo(m,x){var B=this.__data__;return this.size+=this.has(m)?0:1,B[m]=rt&&x===void 0?s:x,this}We.prototype.clear=Nt,We.prototype.delete=Rt,We.prototype.get=Do,We.prototype.has=Lo,We.prototype.set=jo;function Ir(m){var x=-1,B=m==null?0:m.length;for(this.clear();++x<B;){var te=m[x];this.set(te[0],te[1])}}function qo(){this.__data__=[],this.size=0}function Mo(m){var x=this.__data__,B=Ri(x,m);if(B<0)return!1;var te=x.length-1;return B==te?x.pop():kr.call(x,B,1),--this.size,!0}function Uo(m){var x=this.__data__,B=Ri(x,m);return B<0?void 0:x[B][1]}function zo(m){return Ri(this.__data__,m)>-1}function ko(m,x){var B=this.__data__,te=Ri(B,m);return te<0?(++this.size,B.push([m,x])):B[te][1]=x,this}Ir.prototype.clear=qo,Ir.prototype.delete=Mo,Ir.prototype.get=Uo,Ir.prototype.has=zo,Ir.prototype.set=ko;function Zr(m){var x=-1,B=m==null?0:m.length;for(this.clear();++x<B;){var te=m[x];this.set(te[0],te[1])}}function Yi(){this.size=0,this.__data__={hash:new We,map:new(tt||Ir),string:new We}}function Ho(m){var x=gi(this,m).delete(m);return this.size-=x?1:0,x}function Zi(m){return gi(this,m).get(m)}function Ko(m){return gi(this,m).has(m)}function Vo(m,x){var B=gi(this,m),te=B.size;return B.set(m,x),this.size+=B.size==te?0:1,this}Zr.prototype.clear=Yi,Zr.prototype.delete=Ho,Zr.prototype.get=Zi,Zr.prototype.has=Ko,Zr.prototype.set=Vo;function Xi(m){var x=-1,B=m==null?0:m.length;for(this.__data__=new Zr;++x<B;)this.add(m[x])}function hn(m){return this.__data__.set(m,s),this}function ln(m){return this.__data__.has(m)}Xi.prototype.add=Xi.prototype.push=hn,Xi.prototype.has=ln;function $r(m){var x=this.__data__=new Ir(m);this.size=x.size}function Bo(){this.__data__=new Ir,this.size=0}function Go(m){var x=this.__data__,B=x.delete(m);return this.size=x.size,B}function Wo(m){return this.__data__.get(m)}function Jo(m){return this.__data__.has(m)}function fn(m,x){var B=this.__data__;if(B instanceof Ir){var te=B.__data__;if(!tt||te.length<r-1)return te.push([m,x]),this.size=++B.size,this;B=this.__data__=new Zr(te)}return B.set(m,x),this.size=B.size,this}$r.prototype.clear=Bo,$r.prototype.delete=Go,$r.prototype.get=Wo,$r.prototype.has=Jo,$r.prototype.set=fn;function pn(m,x){var B=rs(m),te=!B&&Sn(m),Ve=!B&&!te&&Os(m),ge=!B&&!te&&!Ve&&Cn(m),Ze=B||te||Ve||ge,Tt=Ze?St(m.length,String):[],Pe=Tt.length;for(var Be in m)(x||je.call(m,Be))&&!(Ze&&(Be=="length"||Ve&&(Be=="offset"||Be=="parent")||ge&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||bn(Be,Pe)))&&Tt.push(Be);return Tt}function Ri(m,x){for(var B=m.length;B--;)if(xn(m[B][0],x))return B;return-1}function Ss(m,x,B){var te=x(m);return rs(m)?te:$e(te,B(m))}function Ti(m){return m==null?m===void 0?ce:fe:Yt&&Yt in Object(m)?vn(m):Zo(m)}function Ps(m){return Fi(m)&&Ti(m)==g}function $i(m,x,B,te,Ve){return m===x?!0:m==null||x==null||!Fi(m)&&!Fi(x)?m!==m&&x!==x:dn(m,x,B,te,$i,Ve)}function dn(m,x,B,te,Ve,ge){var Ze=rs(m),Tt=rs(x),Pe=Ze?w:Hr(m),Be=Tt?w:Hr(x);Pe=Pe==g?C:Pe,Be=Be==g?C:Be;var bt=Pe==C,ar=Be==C,$t=Pe==Be;if($t&&Os(m)){if(!Os(x))return!1;Ze=!0,bt=!1}if($t&&!bt)return ge||(ge=new $r),Ze||Cn(m)?es(m,x,B,te,Ve,ge):Yo(m,x,Pe,B,te,Ve,ge);if(!(B&a)){var Xe=bt&&je.call(m,"__wrapped__"),Zt=ar&&je.call(x,"__wrapped__");if(Xe||Zt){var Fr=Xe?m.value():m,xr=Zt?x.value():x;return ge||(ge=new $r),Ve(Fr,xr,B,te,ge)}}return $t?(ge||(ge=new $r),mn(m,x,B,te,Ve,ge)):!1}function Qo(m){if(!On(m)||En(m))return!1;var x=is(m)?Ht:ke;return x.test(Xr(m))}function gn(m){return Fi(m)&&Pn(m.length)&&!!be[Ti(m)]}function yn(m){if(!In(m))return Ni(m);var x=[];for(var B in Object(m))je.call(m,B)&&B!="constructor"&&x.push(B);return x}function es(m,x,B,te,Ve,ge){var Ze=B&a,Tt=m.length,Pe=x.length;if(Tt!=Pe&&!(Ze&&Pe>Tt))return!1;var Be=ge.get(m);if(Be&&ge.get(x))return Be==x;var bt=-1,ar=!0,$t=B&h?new Xi:void 0;for(ge.set(m,x),ge.set(x,m);++bt<Tt;){var Xe=m[bt],Zt=x[bt];if(te)var Fr=Ze?te(Zt,Xe,bt,x,m,ge):te(Xe,Zt,bt,m,x,ge);if(Fr!==void 0){if(Fr)continue;ar=!1;break}if($t){if(!xe(x,function(xr,Kr){if(!nt($t,Kr)&&(Xe===xr||Ve(Xe,xr,B,te,ge)))return $t.push(Kr)})){ar=!1;break}}else if(!(Xe===Zt||Ve(Xe,Zt,B,te,ge))){ar=!1;break}}return ge.delete(m),ge.delete(x),ar}function Yo(m,x,B,te,Ve,ge,Ze){switch(B){case Ae:if(m.byteLength!=x.byteLength||m.byteOffset!=x.byteOffset)return!1;m=m.buffer,x=x.buffer;case Ee:return!(m.byteLength!=x.byteLength||!ge(new Qt(m),new Qt(x)));case b:case S:case oe:return xn(+m,+x);case N:return m.name==x.name&&m.message==x.message;case q:case D:return m==x+"";case J:var Tt=Je;case I:var Pe=te&a;if(Tt||(Tt=ot),m.size!=x.size&&!Pe)return!1;var Be=Ze.get(m);if(Be)return Be==x;te|=h,Ze.set(m,x);var bt=es(Tt(m),Tt(x),te,Ve,ge,Ze);return Ze.delete(m),bt;case H:if(yt)return yt.call(m)==yt.call(x)}return!1}function mn(m,x,B,te,Ve,ge){var Ze=B&a,Tt=ts(m),Pe=Tt.length,Be=ts(x),bt=Be.length;if(Pe!=bt&&!Ze)return!1;for(var ar=Pe;ar--;){var $t=Tt[ar];if(!(Ze?$t in x:je.call(x,$t)))return!1}var Xe=ge.get(m);if(Xe&&ge.get(x))return Xe==x;var Zt=!0;ge.set(m,x),ge.set(x,m);for(var Fr=Ze;++ar<Pe;){$t=Tt[ar];var xr=m[$t],Kr=x[$t];if(te)var Cs=Ze?te(Kr,xr,$t,x,m,ge):te(xr,Kr,$t,m,x,ge);if(!(Cs===void 0?xr===Kr||Ve(xr,Kr,B,te,ge):Cs)){Zt=!1;break}Fr||(Fr=$t=="constructor")}if(Zt&&!Fr){var Di=m.constructor,Mt=x.constructor;Di!=Mt&&"constructor"in m&&"constructor"in x&&!(typeof Di=="function"&&Di instanceof Di&&typeof Mt=="function"&&Mt instanceof Mt)&&(Zt=!1)}return ge.delete(m),ge.delete(x),Zt}function ts(m){return Ss(m,ta,wn)}function gi(m,x){var B=m.__data__;return _n(x)?B[typeof x=="string"?"string":"hash"]:B.map}function yr(m,x){var B=De(m,x);return Qo(B)?B:void 0}function vn(m){var x=je.call(m,Yt),B=m[Yt];try{m[Yt]=void 0;var te=!0}catch{}var Ve=Dt.call(m);return te&&(x?m[Yt]=B:delete m[Yt]),Ve}var wn=Yr?function(m){return m==null?[]:(m=Object(m),Re(Yr(m),function(x){return or.call(m,x)}))}:Ke,Hr=Ti;(lt&&Hr(new lt(new ArrayBuffer(1)))!=Ae||tt&&Hr(new tt)!=J||ft&&Hr(ft.resolve())!=$||pt&&Hr(new pt)!=I||at&&Hr(new at)!=ae)&&(Hr=function(m){var x=Ti(m),B=x==C?m.constructor:void 0,te=B?Xr(B):"";if(te)switch(te){case Ot:return Ae;case Ct:return J;case dt:return $;case At:return I;case gt:return ae}return x});function bn(m,x){return x=x??p,!!x&&(typeof m=="number"||zr.test(m))&&m>-1&&m%1==0&&m<x}function _n(m){var x=typeof m;return x=="string"||x=="number"||x=="symbol"||x=="boolean"?m!=="__proto__":m===null}function En(m){return!!Pt&&Pt in m}function In(m){var x=m&&m.constructor,B=typeof x=="function"&&x.prototype||Te;return m===B}function Zo(m){return Dt.call(m)}function Xr(m){if(m!=null){try{return ht.call(m)}catch{}try{return m+""}catch{}}return""}function xn(m,x){return m===x||m!==m&&x!==x}var Sn=Ps(function(){return arguments}())?Ps:function(m){return Fi(m)&&je.call(m,"callee")&&!or.call(m,"callee")},rs=Array.isArray;function Xo(m){return m!=null&&Pn(m.length)&&!is(m)}var Os=di||ze;function ea(m,x){return $i(m,x)}function is(m){if(!On(m))return!1;var x=Ti(m);return x==K||x==j||x==y||x==M}function Pn(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=p}function On(m){var x=typeof m;return m!=null&&(x=="object"||x=="function")}function Fi(m){return m!=null&&typeof m=="object"}var Cn=ve?vt(ve):gn;function ta(m){return Xo(m)?pn(m):yn(m)}function Ke(){return[]}function ze(){return!1}o.exports=ea})(Ao,Ao.exports);var Mb=Ao.exports;const Ub=e1(Mb);function zb(o,t){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<o.length;a++){var h=o.charAt(a),p=h.charCodeAt(0);if(r[p]!==255)throw new TypeError(h+" is ambiguous");r[p]=a}var g=o.length,w=o.charAt(0),y=Math.log(g)/Math.log(256),b=Math.log(256)/Math.log(g);function S(j){if(j instanceof Uint8Array||(ArrayBuffer.isView(j)?j=new Uint8Array(j.buffer,j.byteOffset,j.byteLength):Array.isArray(j)&&(j=Uint8Array.from(j))),!(j instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(j.length===0)return"";for(var J=0,oe=0,fe=0,C=j.length;fe!==C&&j[fe]===0;)fe++,J++;for(var $=(C-fe)*b+1>>>0,M=new Uint8Array($);fe!==C;){for(var q=j[fe],I=0,D=$-1;(q!==0||I<oe)&&D!==-1;D--,I++)q+=256*M[D]>>>0,M[D]=q%g>>>0,q=q/g>>>0;if(q!==0)throw new Error("Non-zero carry");oe=I,fe++}for(var H=$-oe;H!==$&&M[H]===0;)H++;for(var ce=w.repeat(J);H<$;++H)ce+=o.charAt(M[H]);return ce}function N(j){if(typeof j!="string")throw new TypeError("Expected String");if(j.length===0)return new Uint8Array;var J=0;if(j[J]!==" "){for(var oe=0,fe=0;j[J]===w;)oe++,J++;for(var C=(j.length-J)*y+1>>>0,$=new Uint8Array(C);j[J];){var M=r[j.charCodeAt(J)];if(M===255)return;for(var q=0,I=C-1;(M!==0||q<fe)&&I!==-1;I--,q++)M+=g*$[I]>>>0,$[I]=M%256>>>0,M=M/256>>>0;if(M!==0)throw new Error("Non-zero carry");fe=q,J++}if(j[J]!==" "){for(var D=C-fe;D!==C&&$[D]===0;)D++;for(var H=new Uint8Array(oe+(C-D)),ce=oe;D!==C;)H[ce++]=$[D++];return H}}}function K(j){var J=N(j);if(J)return J;throw new Error(`Non-${t} character`)}return{encode:S,decodeUnsafe:N,decode:K}}var kb=zb,Hb=kb;const Df=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},Kb=o=>new TextEncoder().encode(o),Vb=o=>new TextDecoder().decode(o);class Bb{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Gb{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Lf(this,t)}}let Wb=class{constructor(t){this.decoders=t}or(t){return Lf(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Lf=(o,t)=>new Wb({...o.decoders||{[o.prefix]:o},...t.decoders||{[t.prefix]:t}});class Jb{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new Bb(t,r,s),this.decoder=new Gb(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const $o=({name:o,prefix:t,encode:r,decode:s})=>new Jb(o,t,r,s),un=({prefix:o,name:t,alphabet:r})=>{const{encode:s,decode:a}=Hb(r,t);return $o({prefix:o,name:t,encode:s,decode:h=>Df(a(h))})},Qb=(o,t,r,s)=>{const a={};for(let b=0;b<t.length;++b)a[t[b]]=b;let h=o.length;for(;o[h-1]==="=";)--h;const p=new Uint8Array(h*r/8|0);let g=0,w=0,y=0;for(let b=0;b<h;++b){const S=a[o[b]];if(S===void 0)throw new SyntaxError(`Non-${s} character`);w=w<<r|S,g+=r,g>=8&&(g-=8,p[y++]=255&w>>g)}if(g>=r||255&w<<8-g)throw new SyntaxError("Unexpected end of data");return p},Yb=(o,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let h="",p=0,g=0;for(let w=0;w<o.length;++w)for(g=g<<8|o[w],p+=8;p>r;)p-=r,h+=t[a&g>>p];if(p&&(h+=t[a&g<<r-p]),s)for(;h.length*r&7;)h+="=";return h},Bt=({name:o,prefix:t,bitsPerChar:r,alphabet:s})=>$o({prefix:t,name:o,encode(a){return Yb(a,s,r)},decode(a){return Qb(a,s,r,o)}}),Zb=$o({prefix:"\0",name:"identity",encode:o=>Vb(o),decode:o=>Kb(o)});var Xb=Object.freeze({__proto__:null,identity:Zb});const e_=Bt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var t_=Object.freeze({__proto__:null,base2:e_});const r_=Bt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var i_=Object.freeze({__proto__:null,base8:r_});const s_=un({prefix:"9",name:"base10",alphabet:"0123456789"});var n_=Object.freeze({__proto__:null,base10:s_});const o_=Bt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),a_=Bt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var c_=Object.freeze({__proto__:null,base16:o_,base16upper:a_});const u_=Bt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),h_=Bt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),l_=Bt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),f_=Bt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),p_=Bt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),d_=Bt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),g_=Bt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),y_=Bt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),m_=Bt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var v_=Object.freeze({__proto__:null,base32:u_,base32upper:h_,base32pad:l_,base32padupper:f_,base32hex:p_,base32hexupper:d_,base32hexpad:g_,base32hexpadupper:y_,base32z:m_});const w_=un({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),b_=un({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var __=Object.freeze({__proto__:null,base36:w_,base36upper:b_});const E_=un({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),I_=un({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var x_=Object.freeze({__proto__:null,base58btc:E_,base58flickr:I_});const S_=Bt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),P_=Bt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),O_=Bt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),C_=Bt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var A_=Object.freeze({__proto__:null,base64:S_,base64pad:P_,base64url:O_,base64urlpad:C_});const jf=Array.from(""),N_=jf.reduce((o,t,r)=>(o[r]=t,o),[]),R_=jf.reduce((o,t,r)=>(o[t.codePointAt(0)]=r,o),[]);function T_(o){return o.reduce((t,r)=>(t+=N_[r],t),"")}function $_(o){const t=[];for(const r of o){const s=R_[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const F_=$o({prefix:"",name:"base256emoji",encode:T_,decode:$_});var D_=Object.freeze({__proto__:null,base256emoji:F_}),L_=qf,Rl=128,j_=127,q_=~j_,M_=Math.pow(2,31);function qf(o,t,r){t=t||[],r=r||0;for(var s=r;o>=M_;)t[r++]=o&255|Rl,o/=128;for(;o&q_;)t[r++]=o&255|Rl,o>>>=7;return t[r]=o|0,qf.bytes=r-s+1,t}var U_=Ac,z_=128,Tl=127;function Ac(o,s){var r=0,s=s||0,a=0,h=s,p,g=o.length;do{if(h>=g)throw Ac.bytes=0,new RangeError("Could not decode varint");p=o[h++],r+=a<28?(p&Tl)<<a:(p&Tl)*Math.pow(2,a),a+=7}while(p>=z_);return Ac.bytes=h-s,r}var k_=Math.pow(2,7),H_=Math.pow(2,14),K_=Math.pow(2,21),V_=Math.pow(2,28),B_=Math.pow(2,35),G_=Math.pow(2,42),W_=Math.pow(2,49),J_=Math.pow(2,56),Q_=Math.pow(2,63),Y_=function(o){return o<k_?1:o<H_?2:o<K_?3:o<V_?4:o<B_?5:o<G_?6:o<W_?7:o<J_?8:o<Q_?9:10},Z_={encode:L_,decode:U_,encodingLength:Y_},Mf=Z_;const $l=(o,t,r=0)=>(Mf.encode(o,t,r),t),Fl=o=>Mf.encodingLength(o),Nc=(o,t)=>{const r=t.byteLength,s=Fl(o),a=s+Fl(r),h=new Uint8Array(a+r);return $l(o,h,0),$l(r,h,s),h.set(t,a),new X_(o,r,t,h)};class X_{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}}const Uf=({name:o,code:t,encode:r})=>new eE(o,t,r);class eE{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Nc(this.code,r):r.then(s=>Nc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const zf=o=>async t=>new Uint8Array(await crypto.subtle.digest(o,t)),tE=Uf({name:"sha2-256",code:18,encode:zf("SHA-256")}),rE=Uf({name:"sha2-512",code:19,encode:zf("SHA-512")});var iE=Object.freeze({__proto__:null,sha256:tE,sha512:rE});const kf=0,sE="identity",Hf=Df,nE=o=>Nc(kf,Hf(o)),oE={code:kf,name:sE,encode:Hf,digest:nE};var aE=Object.freeze({__proto__:null,identity:oE});new TextEncoder,new TextDecoder;const Dl={...Xb,...t_,...i_,...n_,...c_,...v_,...__,...x_,...A_,...D_};({...iE,...aE});function Kf(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function cE(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Kf(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function Vf(o,t,r,s){return{name:o,prefix:t,encoder:{name:o,prefix:t,encode:r},decoder:{decode:s}}}const Ll=Vf("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),dc=Vf("ascii","a",o=>{let t="a";for(let r=0;r<o.length;r++)t+=String.fromCharCode(o[r]);return t},o=>{o=o.substring(1);const t=cE(o.length);for(let r=0;r<o.length;r++)t[r]=o.charCodeAt(r);return t}),uE={utf8:Ll,"utf-8":Ll,hex:Dl.base16,latin1:dc,ascii:dc,binary:dc,...Dl};function hE(o,t="utf8"){const r=uE[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Kf(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const Bf="wc",lE=2,Wc="core",Oi=`${Bf}@2:${Wc}:`,fE={name:Wc,logger:"error"},pE={database:":memory:"},dE="crypto",jl="client_ed25519_seed",gE=ne.ONE_DAY,yE="keychain",mE="0.3",vE="messages",wE="0.3",bE=ne.SIX_HOURS,_E="publisher",Gf="irn",EE="error",Wf="wss://relay.walletconnect.com",ql="wss://relay.walletconnect.org",IE="relayer",Jt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},xE="_subscription",ui={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},SE=ne.ONE_SECOND,PE="2.10.6",OE=1e4,CE="0.3",AE="WALLETCONNECT_CLIENT_ID",Mr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},NE="subscription",RE="0.3",TE=ne.FIVE_SECONDS*1e3,$E="pairing",FE="0.3",Bs={wc_pairingDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:0},res:{ttl:ne.ONE_DAY,prompt:!1,tag:0}}},Zs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Wr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},DE="history",LE="0.3",jE="expirer",Tr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},qE="0.3",gc="verify-api",vs="https://verify.walletconnect.com",Rc="https://verify.walletconnect.org",ME=[vs,Rc];class UE{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=yE,this.version=mE,this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:h}=Z("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(h)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,bf(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?_f(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class zE{constructor(t,r,s){this.core=t,this.logger=r,this.name=dE,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),h=Cl(a);return Ff(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=f1();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const h=await this.getClientSeed(),p=Cl(h),g=Pc();return await Fb(g,a,gE,p)},this.generateSharedKey=(a,h,p)=>{this.isInitialized();const g=this.getPrivateKey(a),w=p1(g,h);return this.setSymKey(w,p)},this.setSymKey=async(a,h)=>{this.isInitialized();const p=h||d1(a);return await this.keychain.set(p,a),p},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,h,p)=>{this.isInitialized();const g=wf(p),w=nn(h);if(rl(g)){const N=g.senderPublicKey,K=g.receiverPublicKey;a=await this.generateSharedKey(N,K)}const y=this.getSymKey(a),{type:b,senderPublicKey:S}=g;return y1({type:b,symKey:y,message:w,senderPublicKey:S})},this.decode=async(a,h,p)=>{this.isInitialized();const g=w1(h,p);if(rl(g)){const w=g.receiverPublicKey,y=g.senderPublicKey;a=await this.generateSharedKey(w,y)}try{const w=this.getSymKey(a),y=m1({symKey:w,encoded:h});return To(y)}catch(w){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=a=>{const h=Po(a);return on(h.type)},this.getPayloadSenderPublicKey=a=>{const h=Po(a);return h.senderPublicKey?nr(h.senderPublicKey,sr):void 0},this.core=t,this.logger=Ce.generateChildLogger(r,this.name),this.keychain=s||new UE(this.core,this.logger)}get context(){return Ce.getLoggerContext(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(jl)}catch{t=Pc(),await this.keychain.set(jl,t)}return hE(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class kE extends fb{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=vE,this.version=wE,this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const h=ws(a);let p=this.messages.get(s);return typeof p>"u"&&(p={}),typeof p[h]<"u"||(p[h]=a,this.messages.set(s,p),await this.persist()),h},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const h=this.get(s),p=ws(a);return typeof h[p]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Ce.generateChildLogger(t,this.name),this.core=r}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,bf(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?_f(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class HE extends pb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Qr.EventEmitter,this.name=_E,this.queue=new Map,this.publishTimeout=ne.toMiliseconds(ne.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,h)=>{var p;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:h}});try{const g=(h==null?void 0:h.ttl)||bE,w=Oc(h),y=(h==null?void 0:h.prompt)||!1,b=(h==null?void 0:h.tag)||0,S=(h==null?void 0:h.id)||n1().toString(),N={topic:s,message:a,opts:{ttl:g,relay:w,prompt:y,tag:b,id:S}},K=setTimeout(()=>this.queue.set(S,N),this.publishTimeout);try{await await rn(this.rpcPublish(s,a,g,w,y,b,S),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(S),this.relayer.events.emit(Jt.publish,N)}catch(j){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(p=h==null?void 0:h.internal)!=null&&p.throwOnFailedPublish)throw this.removeRequestFromQueue(S),j;return}finally{clearTimeout(K)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:h}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=Ce.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ce.getLoggerContext(this.logger)}rpcPublish(t,r,s,a,h,p,g){var w,y,b,S;const N={method:Eo(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:h,tag:p},id:g};return ir((w=N.params)==null?void 0:w.prompt)&&((y=N.params)==null||delete y.prompt),ir((b=N.params)==null?void 0:b.tag)&&((S=N.params)==null||delete S.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.request(N)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(xs.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Jt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Jt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class KE{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(h=>h!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var VE=Object.defineProperty,BE=Object.defineProperties,GE=Object.getOwnPropertyDescriptors,Ml=Object.getOwnPropertySymbols,WE=Object.prototype.hasOwnProperty,JE=Object.prototype.propertyIsEnumerable,Ul=(o,t,r)=>t in o?VE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Gs=(o,t)=>{for(var r in t||(t={}))WE.call(t,r)&&Ul(o,r,t[r]);if(Ml)for(var r of Ml(t))JE.call(t,r)&&Ul(o,r,t[r]);return o},yc=(o,t)=>BE(o,GE(t));class QE extends yb{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new KE,this.events=new Qr.EventEmitter,this.name=NE,this.version=RE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Oi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const h=Oc(a),p={topic:s,relay:h};this.pending.set(s,p);const g=await this.rpcSubscribe(s,h);return this.onSubscribe(g,p),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),g}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,h)=>{const p=new ne.Watch;p.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(g),p.stop(this.pendingSubscriptionWatchLabel),a(!0)),p.elapsed(this.pendingSubscriptionWatchLabel)>=TE&&(clearInterval(g),p.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Ce.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=Oc(s);await this.rpcUnsubscribe(t,r,a);const h=It("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:Eo(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await rn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Jt.connection_stalled)}return ws(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:Eo(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await rn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Jt.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:Eo(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,yc(Gs({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Gs({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Gs({},r)),this.topicMap.set(r.topic,t),this.events.emit(Mr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(Mr.deleted,yc(Gs({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Mr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Mr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);Jr(r)&&this.onBatchSubscribe(r.map((s,a)=>yc(Gs({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(xs.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Jt.connect,async()=>{await this.onConnect()}),this.relayer.on(Jt.disconnect,()=>{this.onDisconnect()}),this.events.on(Mr.created,async t=>{const r=Mr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Mr.deleted,async t=>{const r=Mr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var YE=Object.defineProperty,zl=Object.getOwnPropertySymbols,ZE=Object.prototype.hasOwnProperty,XE=Object.prototype.propertyIsEnumerable,kl=(o,t,r)=>t in o?YE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,eI=(o,t)=>{for(var r in t||(t={}))ZE.call(t,r)&&kl(o,r,t[r]);if(zl)for(var r of zl(t))XE.call(t,r)&&kl(o,r,t[r]);return o};class tI extends db{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Qr.EventEmitter,this.name=IE,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Jt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Jt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ui.payload,this.onPayloadHandler),this.provider.on(ui.connect,this.onConnectHandler),this.provider.on(ui.disconnect,this.onDisconnectHandler),this.provider.on(ui.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ce.generateChildLogger(t.logger,this.name):Ce.pino(Ce.getDefaultLoggerOptions({level:t.logger||EE})),this.messages=new kE(this.logger,t.core),this.subscriber=new QE(this,this.logger),this.publisher=new HE(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||Wf,this.projectId=t.projectId,this.bundleId=S1(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ql}...`),await this.restartTransport(ql)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},OE)}get context(){return Ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(a)return a;let h;const p=g=>{g.topic===t&&(this.subscriber.off(Mr.created,p),h())};return await Promise.all([new Promise(g=>{h=g,this.subscriber.on(Mr.created,p)}),new Promise(async g=>{a=await this.subscriber.subscribe(t,r),g()})]),a}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await rn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Mr.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await rn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(ui.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await pl())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new fi(new qb(R1({sdkVersion:PE,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),qc(t)){if(!t.method.endsWith(xE))return;const r=t.params,{topic:s,message:a,publishedAt:h}=r.data,p={topic:s,message:a,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(eI({type:"event",event:r.id},p)),this.events.emit(r.id,p),await this.acknowledgePayload(t),await this.onMessageEvent(p)}else Mc(t)&&this.events.emit(Jt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Jt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=Uc(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ui.payload,this.onPayloadHandler),this.provider.off(ui.connect,this.onConnectHandler),this.provider.off(ui.disconnect,this.onDisconnectHandler),this.provider.off(ui.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Jt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await pl();Iw(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Jt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},ne.toMiliseconds(SE)))}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var rI=Object.defineProperty,Hl=Object.getOwnPropertySymbols,iI=Object.prototype.hasOwnProperty,sI=Object.prototype.propertyIsEnumerable,Kl=(o,t,r)=>t in o?rI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Vl=(o,t)=>{for(var r in t||(t={}))iI.call(t,r)&&Kl(o,r,t[r]);if(Hl)for(var r of Hl(t))sI.call(t,r)&&Kl(o,r,t[r]);return o};class Fo extends gb{constructor(t,r,s,a=Oi,h=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=CE,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(p=>{this.getKey&&p!==null&&!ir(p)?this.map.set(this.getKey(p),p):ew(p)?this.map.set(p.id,p):tw(p)&&this.map.set(p.topic,p)}),this.cached=[],this.initialized=!0)},this.set=async(p,g)=>{this.isInitialized(),this.map.has(p)?await this.update(p,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:p,value:g}),this.map.set(p,g),await this.persist())},this.get=p=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:p}),this.getData(p)),this.getAll=p=>(this.isInitialized(),p?this.values.filter(g=>Object.keys(p).every(w=>Ub(g[w],p[w]))):this.values),this.update=async(p,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:p,update:g});const w=Vl(Vl({},this.getData(p)),g);this.map.set(p,w),await this.persist()},this.delete=async(p,g)=>{this.isInitialized(),this.map.has(p)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:p,reason:g}),this.map.delete(p),await this.persist())},this.logger=Ce.generateChildLogger(r,this.name),this.storagePrefix=a,this.getKey=h}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class nI{constructor(t,r){this.core=t,this.logger=r,this.name=$E,this.version=FE,this.events=new Lc,this.initialized=!1,this.storagePrefix=Oi,this.ignoredPayloadTypes=[Gi],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=Pc(),a=await this.core.crypto.setSymKey(s),h=Ur(ne.FIVE_MINUTES),p={protocol:Gf},g={topic:a,expiry:h,relay:p,active:!1},w=K1({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:p});return await this.pairings.set(a,g),await this.core.relayer.subscribe(a),this.core.expirer.set(a,h),{topic:a,uri:w}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:h,relay:p}=cl(s.uri);let g;if(this.pairings.keys.includes(a)&&(g=this.pairings.get(a),g.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const w=Ur(ne.FIVE_MINUTES),y={topic:a,relay:p,expiry:w,active:!1};return await this.pairings.set(a,y),this.core.expirer.set(a,w),s.activatePairing&&await this.activate({topic:a}),this.events.emit(Zs.create,y),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(h,a),await this.core.relayer.subscribe(a,{relay:p})),y},this.activate=async({topic:s})=>{this.isInitialized();const a=Ur(ne.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const h=await this.sendRequest(a,"wc_pairingPing",{}),{done:p,resolve:g,reject:w}=ms();this.events.once(Ft("pairing_ping",h),({error:y})=>{y?w(y):g()}),await p()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",It("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,h)=>{const p=en(a,h),g=await this.core.crypto.encode(s,p),w=Bs[a].req;return this.core.history.set(s,p),this.core.relayer.publish(s,g,w),p.id},this.sendResult=async(s,a,h)=>{const p=Uc(s,h),g=await this.core.crypto.encode(a,p),w=await this.core.history.get(a,s),y=Bs[w.request.method].res;await this.core.relayer.publish(a,g,y),await this.core.history.resolve(p)},this.sendError=async(s,a,h)=>{const p=jc(s,h),g=await this.core.crypto.encode(a,p),w=await this.core.history.get(a,s),y=Bs[w.request.method]?Bs[w.request.method].res:Bs.unregistered_method.res;await this.core.relayer.publish(a,g,y),await this.core.history.resolve(p)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,It("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>Pi(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:h}=s;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(a,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,h);default:return this.onUnknownRpcMethodRequest(a,h)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:h}=s,p=(await this.core.history.get(a,h.id)).request.method;switch(p){case"wc_pairingPing":return this.onPairingPingResponse(a,h);default:return this.onUnknownRpcMethodResponse(p)}},this.onPairingPingRequest=async(s,a)=>{const{id:h}=a;try{this.isValidPing({topic:s}),await this.sendResult(h,s,!0),this.events.emit(Zs.ping,{id:h,topic:s})}catch(p){await this.sendError(h,s,p),this.logger.error(p)}},this.onPairingPingResponse=(s,a)=>{const{id:h}=a;setTimeout(()=>{Si(a)?this.events.emit(Ft("pairing_ping",h),{}):li(a)&&this.events.emit(Ft("pairing_ping",h),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:h}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Zs.delete,{id:h,topic:s})}catch(p){await this.sendError(h,s,p),this.logger.error(p)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:h,method:p}=a;try{if(this.registeredMethods.includes(p))return;const g=It("WC_METHOD_UNSUPPORTED",p);await this.sendError(h,s,g),this.logger.error(g)}catch(g){await this.sendError(h,s,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(It("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!dr(s)){const{message:p}=Z("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(p)}if(!X1(s.uri)){const{message:p}=Z("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(p)}const h=cl(s.uri);if(!((a=h==null?void 0:h.relay)!=null&&a.protocol)){const{message:p}=Z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(p)}if(!(h!=null&&h.symKey)){const{message:p}=Z("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(p)}},this.isValidPing=async s=>{if(!dr(s)){const{message:h}=Z("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(h)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!dr(s)){const{message:h}=Z("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(h)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!kt(s,!1)){const{message:a}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(Pi(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=Z("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=Ce.generateChildLogger(r,this.name),this.pairings=new Fo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Jt.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{qc(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Mc(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Tr.expired,async t=>{const{topic:r}=If(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Zs.expire,{topic:r}))})}}class oI extends lb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Qr.EventEmitter,this.name=DE,this.version=LE,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:h}),this.records.has(a.id))return;const p={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:h,expiry:Ur(ne.THIRTY_DAYS)};this.records.set(p.id,p),this.events.emit(Wr.created,p)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=li(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(Wr.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(h=>{if(h.topic===s){if(typeof a<"u"&&h.id!==a)return;this.records.delete(h.id),this.events.emit(Wr.deleted,h)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:en(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Wr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Wr.created,t=>{const r=Wr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Wr.updated,t=>{const r=Wr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Wr.deleted,t=>{const r=Wr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(xs.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{ne.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class aI extends mb{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Qr.EventEmitter,this.name=jE,this.version=qE,this.cached=[],this.initialized=!1,this.storagePrefix=Oi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const h=this.formatTarget(s),p={target:h,expiry:a};this.expirations.set(h,p),this.checkExpiry(h,p),this.events.emit(Tr.created,{target:h,expiration:p})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),h=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Tr.deleted,{target:a,expiration:h})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return T1(t);if(typeof t=="number")return $1(t);const{message:r}=Z("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Tr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=Z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;ne.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Tr.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(xs.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Tr.created,t=>{const r=Tr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Tr.expired,t=>{const r=Tr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Tr.deleted,t=>{const r=Tr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class cI extends vb{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=gc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||_s()||!Es())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Rc;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let h;try{h=await this.fetchAttestation(s.attestationId,a)}catch(p){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(p),h=await this.fetchAttestation(s.attestationId,Rc)}return h},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const h=this.startAbortTimer(ne.ONE_SECOND*2),p=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(h),p.status===200?await p.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(h=>{if(document.getElementById(gc))return h();window.addEventListener("message",a);const p=document.createElement("iframe");p.id=gc,p.src=`${this.verifyUrl}/${this.projectId}`,p.style.display="none",document.body.append(p),this.iframe=p,s=h}),new Promise((h,p)=>setTimeout(()=>{window.removeEventListener("message",a),p("verify iframe load timeout")},ne.toMiliseconds(ne.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||vs;return ME.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${vs}`),a=vs),a},this.logger=Ce.generateChildLogger(r,this.name),this.verifyUrl=vs,this.abortController=new AbortController,this.isDevEnv=Kc()&&{}.IS_VITEST}get context(){return Ce.getLoggerContext(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ne.toMiliseconds(t))}}var uI=Object.defineProperty,Bl=Object.getOwnPropertySymbols,hI=Object.prototype.hasOwnProperty,lI=Object.prototype.propertyIsEnumerable,Gl=(o,t,r)=>t in o?uI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Wl=(o,t)=>{for(var r in t||(t={}))hI.call(t,r)&&Gl(o,r,t[r]);if(Bl)for(var r of Bl(t))lI.call(t,r)&&Gl(o,r,t[r]);return o};class Jc extends hb{constructor(t){super(t),this.protocol=Bf,this.version=lE,this.name=Wc,this.events=new Qr.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Wf,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||fE.logger}));this.logger=Ce.generateChildLogger(r,this.name),this.heartbeat=new xs.HeartBeat,this.crypto=new zE(this,this.logger,t==null?void 0:t.keychain),this.history=new oI(this,this.logger),this.expirer=new aI(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new tb(Wl(Wl({},pE),t==null?void 0:t.storageOptions)),this.relayer=new tI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new nI(this,this.logger),this.verify=new cI(this.projectId||"",this.logger)}static async init(t){const r=new Jc(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(AE,s),r}get context(){return Ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const fI=Jc,Jf="wc",Qf=2,Yf="client",Qc=`${Jf}@${Qf}:${Yf}:`,mc={name:Yf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Jl="WALLETCONNECT_DEEPLINK_CHOICE",pI="proposal",Zf="Proposal expired",dI="session",wo=ne.SEVEN_DAYS,gI="engine",Ws={wc_sessionPropose:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1115}}},vc={min:ne.FIVE_MINUTES,max:ne.SEVEN_DAYS},hi={idle:"IDLE",active:"ACTIVE"},yI="request",mI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var vI=Object.defineProperty,wI=Object.defineProperties,bI=Object.getOwnPropertyDescriptors,Ql=Object.getOwnPropertySymbols,_I=Object.prototype.hasOwnProperty,EI=Object.prototype.propertyIsEnumerable,Yl=(o,t,r)=>t in o?vI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,fr=(o,t)=>{for(var r in t||(t={}))_I.call(t,r)&&Yl(o,r,t[r]);if(Ql)for(var r of Ql(t))EI.call(t,r)&&Yl(o,r,t[r]);return o},Js=(o,t)=>wI(o,bI(t));class II extends bb{constructor(t){super(t),this.name=gI,this.events=new Lc,this.initialized=!1,this.ignoredPayloadTypes=[Gi],this.requestQueue={state:hi.idle,queue:[]},this.sessionRequestQueue={state:hi.idle,queue:[]},this.requestQueueDelay=ne.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ws)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=Js(fr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:h,optionalNamespaces:p,sessionProperties:g,relays:w}=s;let y=a,b,S=!1;if(y&&(S=this.client.core.pairing.pairings.get(y).active),!y||!S){const{topic:$,uri:M}=await this.client.core.pairing.create();y=$,b=M}const N=await this.client.core.crypto.generateKeyPair(),K=fr({requiredNamespaces:h,optionalNamespaces:p,relays:w??[{protocol:Gf}],proposer:{publicKey:N,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:j,resolve:J,done:oe}=ms(ne.FIVE_MINUTES,Zf);if(this.events.once(Ft("session_connect"),async({error:$,session:M})=>{if($)j($);else if(M){M.self.publicKey=N;const q=Js(fr({},M),{requiredNamespaces:M.requiredNamespaces,optionalNamespaces:M.optionalNamespaces});await this.client.session.set(M.topic,q),await this.setExpiry(M.topic,M.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:M.peer.metadata}),J(q)}}),!y){const{message:$}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error($)}const fe=await this.sendRequest({topic:y,method:"wc_sessionPropose",params:K}),C=Ur(ne.FIVE_MINUTES);return await this.setProposal(fe,fr({id:fe,expiry:C},K)),{uri:b,approval:oe}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:h,sessionProperties:p}=r,g=this.client.proposal.get(s);let{pairingTopic:w,proposer:y,requiredNamespaces:b,optionalNamespaces:S}=g;w=w||"",bs(b)||(b=W1(h,"approve()"));const N=await this.client.core.crypto.generateKeyPair(),K=y.publicKey,j=await this.client.core.crypto.generateSharedKey(N,K);w&&s&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:y.metadata}),await this.sendResult({id:s,topic:w,result:{relay:{protocol:a??"irn"},responderPublicKey:N}}),await this.client.proposal.delete(s,It("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const J=fr({relay:{protocol:a??"irn"},namespaces:h,requiredNamespaces:b,optionalNamespaces:S,pairingTopic:w,controller:{publicKey:N,metadata:this.client.metadata},expiry:Ur(wo)},p&&{sessionProperties:p});await this.client.core.relayer.subscribe(j),await this.sendRequest({topic:j,method:"wc_sessionSettle",params:J,throwOnFailedPublish:!0});const oe=Js(fr({},J),{topic:j,pairingTopic:w,acknowledged:!1,self:J.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:N});return await this.client.session.set(j,oe),await this.setExpiry(j,Ur(wo)),{topic:j,acknowledged:()=>new Promise(fe=>setTimeout(()=>fe(this.client.session.get(j)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:h}=this.client.proposal.get(s);h&&(await this.sendError(s,h,a),await this.client.proposal.delete(s,It("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,h=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:p,resolve:g,reject:w}=ms();return this.events.once(Ft("session_update",h),({error:y})=>{y?w(y):g()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:p}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:h,resolve:p,reject:g}=ms();return this.events.once(Ft("session_extend",a),({error:w})=>{w?g(w):p()}),await this.setExpiry(s,Ur(wo)),{acknowledged:h}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:h,expiry:p}=r,g=o1(),{done:w,resolve:y,reject:b}=ms(p,"Request expired. Please try again.");return this.events.once(Ft("session_request",g),({error:S,result:N})=>{S?b(S):y(N)}),await Promise.all([new Promise(async S=>{await this.sendRequest({clientRpcId:g,topic:h,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:p,throwOnFailedPublish:!0}).catch(N=>b(N)),this.client.events.emit("session_request_sent",{topic:h,request:a,chainId:s,id:g}),S()}),new Promise(async S=>{const N=await D1(this.client.core.storage,Jl);F1({id:g,topic:h,wcDeepLink:N}),S()}),w()]).then(S=>S[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:h}=a;Si(a)?await this.sendResult({id:h,topic:s,result:a.result,throwOnFailedPublish:!0}):li(a)&&await this.sendError(h,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:h,resolve:p,reject:g}=ms();this.events.once(Ft("session_ping",a),({error:w})=>{w?g(w):p()}),await h()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:h}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:h}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:It("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>Y1(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(h=>{var p,g;return((p=h.peerMetadata)==null?void 0:p.url)&&((g=h.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&h.topic&&h.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,It("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Jl).catch(h=>this.client.logger.warn(h))},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,It("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==r),a&&(this.sessionRequestQueue.state=hi.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=Ws.wc_sessionRequest.req.ttl,{id:a,topic:h,params:p,verifyContext:g}=r;await this.client.pendingRequest.set(a,{id:a,topic:h,params:p,verifyContext:g}),s&&this.client.core.expirer.set(a,Ur(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:h,expiry:p,relayRpcId:g,clientRpcId:w,throwOnFailedPublish:y}=r,b=en(a,h,w);if(Es()&&mI.includes(a)){const K=ws(JSON.stringify(b));this.client.core.verify.register({attestationId:K})}const S=await this.client.core.crypto.encode(s,b),N=Ws[a].req;return p&&(N.ttl=p),g&&(N.id=g),this.client.core.history.set(s,b),y?(N.internal=Js(fr({},N.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,S,N)):this.client.core.relayer.publish(s,S,N).catch(K=>this.client.logger.error(K)),b.id},this.sendResult=async r=>{const{id:s,topic:a,result:h,throwOnFailedPublish:p}=r,g=Uc(s,h),w=await this.client.core.crypto.encode(a,g),y=await this.client.core.history.get(a,s),b=Ws[y.request.method].res;p?(b.internal=Js(fr({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,w,b)):this.client.core.relayer.publish(a,w,b).catch(S=>this.client.logger.error(S)),await this.client.core.history.resolve(g)},this.sendError=async(r,s,a)=>{const h=jc(r,a),p=await this.client.core.crypto.encode(s,h),g=await this.client.core.history.get(s,r),w=Ws[g.request.method].res;this.client.core.relayer.publish(s,p,w),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{Pi(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Pi(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===hi.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=hi.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=hi.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,h=a.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,h=(await this.client.core.history.get(s,a.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:h}=s;try{this.isValidConnect(fr({},s.params));const p=Ur(ne.FIVE_MINUTES),g=fr({id:h,pairingTopic:r,expiry:p},a);await this.setProposal(h,g);const w=ws(JSON.stringify(s)),y=await this.getVerifyContext(w,g.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:g,verifyContext:y})}catch(p){await this.sendError(h,r,p),this.client.logger.error(p)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(Si(s)){const{result:h}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const p=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:p});const g=p.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const w=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const y=await this.client.core.crypto.generateSharedKey(g,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:y});const b=await this.client.core.relayer.subscribe(y);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:b}),await this.client.core.pairing.activate({topic:r})}else li(s)&&(await this.client.proposal.delete(a,It("USER_DISCONNECTED")),this.events.emit(Ft("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:h}=s;try{this.isValidSessionSettleRequest(h);const{relay:p,controller:g,expiry:w,namespaces:y,requiredNamespaces:b,optionalNamespaces:S,sessionProperties:N,pairingTopic:K}=s.params,j=fr({topic:r,relay:p,expiry:w,namespaces:y,acknowledged:!0,pairingTopic:K,requiredNamespaces:b,optionalNamespaces:S,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},N&&{sessionProperties:N});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(Ft("session_connect"),{session:j}),this.cleanupDuplicatePairings(j)}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;Si(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ft("session_approve",a),{})):li(s)&&(await this.client.session.delete(r,It("USER_DISCONNECTED")),this.events.emit(Ft("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:h}=s;try{const p=`${r}_session_update`,g=yo.get(p);if(g&&this.isRequestOutOfSync(g,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(fr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:h,topic:r,result:!0}),this.client.events.emit("session_update",{id:h,topic:r,params:a}),yo.set(p,h)}catch(p){await this.sendError(h,r,p),this.client.logger.error(p)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;Si(s)?this.events.emit(Ft("session_update",a),{}):li(s)&&this.events.emit(Ft("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ur(wo)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;Si(s)?this.events.emit(Ft("session_extend",a),{}):li(s)&&this.events.emit(Ft("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{Si(s)?this.events.emit(Ft("session_ping",a),{}):li(s)&&this.events.emit(Ft("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Jt.publish,async()=>{h(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:h}=s;try{this.isValidRequest(fr({topic:r},h));const p=ws(JSON.stringify(en("wc_sessionRequest",h,a))),g=this.client.session.get(r),w=await this.getVerifyContext(p,g.peer.metadata),y={id:a,topic:r,params:h,verifyContext:w};await this.setPendingSessionRequest(y),this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue()}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;Si(s)?this.events.emit(Ft("session_request",a),{result:s.result}):li(s)&&this.events.emit(Ft("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:h}=s;try{const p=`${r}_session_event_${h.event.name}`,g=yo.get(p);if(g&&this.isRequestOutOfSync(g,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(fr({topic:r},h)),this.client.events.emit("session_event",{id:a,topic:r,params:h}),yo.set(p,a)}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=hi.idle,this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===hi.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=hi.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,en("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!dr(r)){const{message:w}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(w)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:h,sessionProperties:p,relays:g}=r;if(ir(s)||await this.isValidPairingTopic(s),!uw(g,!0)){const{message:w}=Z("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(w)}!ir(a)&&bs(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!ir(h)&&bs(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),ir(p)||this.validateSessionProps(p,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=cw(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!dr(r))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:h,sessionProperties:p}=r;await this.isValidProposalId(s);const g=this.client.proposal.get(s),w=Io(a,"approve()");if(w)throw new Error(w.message);const y=ll(g.requiredNamespaces,a,"approve()");if(y)throw new Error(y.message);if(!kt(h,!0)){const{message:b}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(b)}ir(p)||this.validateSessionProps(p,"sessionProperties")},this.isValidReject=async r=>{if(!dr(r)){const{message:h}=Z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(h)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!lw(a)){const{message:h}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidSessionSettleRequest=r=>{if(!dr(r)){const{message:y}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(y)}const{relay:s,controller:a,namespaces:h,expiry:p}=r;if(!Sf(s)){const{message:y}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(y)}const g=rw(a,"onSessionSettleRequest()");if(g)throw new Error(g.message);const w=Io(h,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Pi(p)){const{message:y}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(y)}},this.isValidUpdate=async r=>{if(!dr(r)){const{message:w}=Z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(w)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const h=this.client.session.get(s),p=Io(a,"update()");if(p)throw new Error(p.message);const g=ll(h.requiredNamespaces,a,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!dr(r)){const{message:a}=Z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!dr(r)){const{message:w}=Z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(w)}const{topic:s,request:a,chainId:h,expiry:p}=r;await this.isValidSessionTopic(s);const{namespaces:g}=this.client.session.get(s);if(!hl(g,h)){const{message:w}=Z("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(w)}if(!fw(a)){const{message:w}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(w)}if(!gw(g,h,a.method)){const{message:w}=Z("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(w)}if(p&&!ww(p,vc)){const{message:w}=Z("MISSING_OR_INVALID",`request() expiry: ${p}. Expiry must be a number (in seconds) between ${vc.min} and ${vc.max}`);throw new Error(w)}},this.isValidRespond=async r=>{if(!dr(r)){const{message:h}=Z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:s,response:a}=r;if(await this.isValidSessionTopic(s),!pw(a)){const{message:h}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!dr(r)){const{message:a}=Z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!dr(r)){const{message:g}=Z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:s,event:a,chainId:h}=r;await this.isValidSessionTopic(s);const{namespaces:p}=this.client.session.get(s);if(!hl(p,h)){const{message:g}=Z("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(g)}if(!dw(a)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}if(!yw(p,h,a.name)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!dr(r)){const{message:a}=Z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||vs,validation:"UNKNOWN",origin:s.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});h&&(a.verified.origin=h.origin,a.verified.isScam=h.isScam,a.verified.validation=h.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!kt(a,!1)){const{message:h}=Z("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:t}=Z("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Jt.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{qc(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Mc(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(Tr.expired,async t=>{const{topic:r,id:s}=If(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,Z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Zs.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!kt(t,!1)){const{message:r}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Pi(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=Z("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!kt(t,!1)){const{message:r}=Z("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Pi(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=Z("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(kt(t,!1)){const{message:r}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!hw(t)){const{message:r}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Pi(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=Z("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class xI extends Fo{constructor(t,r){super(t,r,pI,Qc),this.core=t,this.logger=r}}class SI extends Fo{constructor(t,r){super(t,r,dI,Qc),this.core=t,this.logger=r}}class PI extends Fo{constructor(t,r){super(t,r,yI,Qc,s=>s.id),this.core=t,this.logger=r}}let OI=class Xf extends wb{constructor(t){super(t),this.protocol=Jf,this.version=Qf,this.name=mc.name,this.events=new Qr.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||mc.name,this.metadata=(t==null?void 0:t.metadata)||O1();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||mc.logger}));this.core=(t==null?void 0:t.core)||new fI(t),this.logger=Ce.generateChildLogger(r,this.name),this.session=new SI(this.core,this.logger),this.proposal=new xI(this.core,this.logger),this.pendingRequest=new PI(this.core,this.logger),this.engine=new II(this)}static async init(t){const r=new Xf(t);return await r.initialize(),r}get context(){return Ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};const Zl="error",CI="wss://relay.walletconnect.com",AI="wc",NI="universal_provider",Xl=`${AI}@2:${NI}:`,RI="https://rpc.walletconnect.com/v1/",pi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Qs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Tc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,t){(function(){var r,s="4.17.21",a=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",g="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",y=500,b="__lodash_placeholder__",S=1,N=2,K=4,j=1,J=2,oe=1,fe=2,C=4,$=8,M=16,q=32,I=64,D=128,H=256,ce=512,ae=30,Ee="...",Ae=800,et=16,T=1,V=2,Me=3,Ne=1/0,ee=9007199254740991,Q=17976931348623157e292,W=0/0,Y=4294967295,ut=Y-1,ke=Y>>>1,zr=[["ary",D],["bind",oe],["bindKey",fe],["curry",$],["curryRight",M],["flip",ce],["partial",q],["partialRight",I],["rearg",H]],be="[object Arguments]",xt="[object Array]",L="[object AsyncFunction]",F="[object Boolean]",A="[object Date]",u="[object DOMException]",E="[object Error]",ie="[object Function]",pe="[object GeneratorFunction]",ve="[object Map]",Re="[object Number]",$e="[object Null]",xe="[object Object]",St="[object Promise]",vt="[object Proxy]",nt="[object RegExp]",De="[object Set]",Je="[object String]",Qe="[object Symbol]",ot="[object Undefined]",Ue="[object WeakMap]",Ye="[object WeakSet]",Te="[object ArrayBuffer]",He="[object DataView]",ht="[object Float32Array]",je="[object Float64Array]",Pt="[object Int8Array]",Dt="[object Int16Array]",Ht="[object Int32Array]",Kt="[object Uint8Array]",qt="[object Uint8ClampedArray]",Qt="[object Uint16Array]",or="[object Uint32Array]",kr=/\b__p \+= '';/g,Yt=/\b(__p \+=) '' \+/g,Yr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,di=/&(?:amp|lt|gt|quot|#39);/g,Ni=/[&<>"']/g,lt=RegExp(di.source),tt=RegExp(Ni.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(dt.source),gt=/^\s+/,wt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Nt=/,? & /,Rt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Do=/[()=,{}\[\]\/\s]/,Lo=/\\(\\)?/g,jo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ir=/\w*$/,qo=/^[-+]0x[0-9a-f]+$/i,Mo=/^0b[01]+$/i,Uo=/^\[object .+?Constructor\]$/,zo=/^0o[0-7]+$/i,ko=/^(?:0|[1-9]\d*)$/,Zr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Yi=/($^)/,Ho=/['\n\r\u2028\u2029\\]/g,Zi="\\ud800-\\udfff",Ko="\\u0300-\\u036f",Vo="\\ufe20-\\ufe2f",Xi="\\u20d0-\\u20ff",hn=Ko+Vo+Xi,ln="\\u2700-\\u27bf",$r="a-z\\xdf-\\xf6\\xf8-\\xff",Bo="\\xac\\xb1\\xd7\\xf7",Go="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Wo="\\u2000-\\u206f",Jo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",fn="A-Z\\xc0-\\xd6\\xd8-\\xde",pn="\\ufe0e\\ufe0f",Ri=Bo+Go+Wo+Jo,Ss="[']",Ti="["+Zi+"]",Ps="["+Ri+"]",$i="["+hn+"]",dn="\\d+",Qo="["+ln+"]",gn="["+$r+"]",yn="[^"+Zi+Ri+dn+ln+$r+fn+"]",es="\\ud83c[\\udffb-\\udfff]",Yo="(?:"+$i+"|"+es+")",mn="[^"+Zi+"]",ts="(?:\\ud83c[\\udde6-\\uddff]){2}",gi="[\\ud800-\\udbff][\\udc00-\\udfff]",yr="["+fn+"]",vn="\\u200d",wn="(?:"+gn+"|"+yn+")",Hr="(?:"+yr+"|"+yn+")",bn="(?:"+Ss+"(?:d|ll|m|re|s|t|ve))?",_n="(?:"+Ss+"(?:D|LL|M|RE|S|T|VE))?",En=Yo+"?",In="["+pn+"]?",Zo="(?:"+vn+"(?:"+[mn,ts,gi].join("|")+")"+In+En+")*",Xr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",xn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Sn=In+En+Zo,rs="(?:"+[Qo,ts,gi].join("|")+")"+Sn,Xo="(?:"+[mn+$i+"?",$i,ts,gi,Ti].join("|")+")",Os=RegExp(Ss,"g"),ea=RegExp($i,"g"),is=RegExp(es+"(?="+es+")|"+Xo+Sn,"g"),Pn=RegExp([yr+"?"+gn+"+"+bn+"(?="+[Ps,yr,"$"].join("|")+")",Hr+"+"+_n+"(?="+[Ps,yr+wn,"$"].join("|")+")",yr+"?"+wn+"+"+bn,yr+"+"+_n,xn,Xr,dn,rs].join("|"),"g"),On=RegExp("["+vn+Zi+hn+pn+"]"),Fi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Cn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ta=-1,Ke={};Ke[ht]=Ke[je]=Ke[Pt]=Ke[Dt]=Ke[Ht]=Ke[Kt]=Ke[qt]=Ke[Qt]=Ke[or]=!0,Ke[be]=Ke[xt]=Ke[Te]=Ke[F]=Ke[He]=Ke[A]=Ke[E]=Ke[ie]=Ke[ve]=Ke[Re]=Ke[xe]=Ke[nt]=Ke[De]=Ke[Je]=Ke[Ue]=!1;var ze={};ze[be]=ze[xt]=ze[Te]=ze[He]=ze[F]=ze[A]=ze[ht]=ze[je]=ze[Pt]=ze[Dt]=ze[Ht]=ze[ve]=ze[Re]=ze[xe]=ze[nt]=ze[De]=ze[Je]=ze[Qe]=ze[Kt]=ze[qt]=ze[Qt]=ze[or]=!0,ze[E]=ze[ie]=ze[Ue]=!1;var m={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},B={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},te={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,ge=parseInt,Ze=typeof Qs=="object"&&Qs&&Qs.Object===Object&&Qs,Tt=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Ze||Tt||Function("return this")(),Be=t&&!t.nodeType&&t,bt=Be&&!0&&o&&!o.nodeType&&o,ar=bt&&bt.exports===Be,$t=ar&&Ze.process,Xe=function(){try{var P=bt&&bt.require&&bt.require("util").types;return P||$t&&$t.binding&&$t.binding("util")}catch{}}(),Zt=Xe&&Xe.isArrayBuffer,Fr=Xe&&Xe.isDate,xr=Xe&&Xe.isMap,Kr=Xe&&Xe.isRegExp,Cs=Xe&&Xe.isSet,Di=Xe&&Xe.isTypedArray;function Mt(P,U,R){switch(R.length){case 0:return P.call(U);case 1:return P.call(U,R[0]);case 2:return P.call(U,R[0],R[1]);case 3:return P.call(U,R[0],R[1],R[2])}return P.apply(U,R)}function rp(P,U,R,re){for(var de=-1,Fe=P==null?0:P.length;++de<Fe;){var Lt=P[de];U(re,Lt,R(Lt),P)}return re}function Sr(P,U){for(var R=-1,re=P==null?0:P.length;++R<re&&U(P[R],R,P)!==!1;);return P}function ip(P,U){for(var R=P==null?0:P.length;R--&&U(P[R],R,P)!==!1;);return P}function Xc(P,U){for(var R=-1,re=P==null?0:P.length;++R<re;)if(!U(P[R],R,P))return!1;return!0}function yi(P,U){for(var R=-1,re=P==null?0:P.length,de=0,Fe=[];++R<re;){var Lt=P[R];U(Lt,R,P)&&(Fe[de++]=Lt)}return Fe}function An(P,U){var R=P==null?0:P.length;return!!R&&ss(P,U,0)>-1}function ra(P,U,R){for(var re=-1,de=P==null?0:P.length;++re<de;)if(R(U,P[re]))return!0;return!1}function it(P,U){for(var R=-1,re=P==null?0:P.length,de=Array(re);++R<re;)de[R]=U(P[R],R,P);return de}function mi(P,U){for(var R=-1,re=U.length,de=P.length;++R<re;)P[de+R]=U[R];return P}function ia(P,U,R,re){var de=-1,Fe=P==null?0:P.length;for(re&&Fe&&(R=P[++de]);++de<Fe;)R=U(R,P[de],de,P);return R}function sp(P,U,R,re){var de=P==null?0:P.length;for(re&&de&&(R=P[--de]);de--;)R=U(R,P[de],de,P);return R}function sa(P,U){for(var R=-1,re=P==null?0:P.length;++R<re;)if(U(P[R],R,P))return!0;return!1}var np=na("length");function op(P){return P.split("")}function ap(P){return P.match(Rt)||[]}function eu(P,U,R){var re;return R(P,function(de,Fe,Lt){if(U(de,Fe,Lt))return re=Fe,!1}),re}function Nn(P,U,R,re){for(var de=P.length,Fe=R+(re?1:-1);re?Fe--:++Fe<de;)if(U(P[Fe],Fe,P))return Fe;return-1}function ss(P,U,R){return U===U?wp(P,U,R):Nn(P,tu,R)}function cp(P,U,R,re){for(var de=R-1,Fe=P.length;++de<Fe;)if(re(P[de],U))return de;return-1}function tu(P){return P!==P}function ru(P,U){var R=P==null?0:P.length;return R?aa(P,U)/R:W}function na(P){return function(U){return U==null?r:U[P]}}function oa(P){return function(U){return P==null?r:P[U]}}function iu(P,U,R,re,de){return de(P,function(Fe,Lt,Ge){R=re?(re=!1,Fe):U(R,Fe,Lt,Ge)}),R}function up(P,U){var R=P.length;for(P.sort(U);R--;)P[R]=P[R].value;return P}function aa(P,U){for(var R,re=-1,de=P.length;++re<de;){var Fe=U(P[re]);Fe!==r&&(R=R===r?Fe:R+Fe)}return R}function ca(P,U){for(var R=-1,re=Array(P);++R<P;)re[R]=U(R);return re}function hp(P,U){return it(U,function(R){return[R,P[R]]})}function su(P){return P&&P.slice(0,cu(P)+1).replace(gt,"")}function mr(P){return function(U){return P(U)}}function ua(P,U){return it(U,function(R){return P[R]})}function As(P,U){return P.has(U)}function nu(P,U){for(var R=-1,re=P.length;++R<re&&ss(U,P[R],0)>-1;);return R}function ou(P,U){for(var R=P.length;R--&&ss(U,P[R],0)>-1;);return R}function lp(P,U){for(var R=P.length,re=0;R--;)P[R]===U&&++re;return re}var fp=oa(m),pp=oa(x);function dp(P){return"\\"+te[P]}function gp(P,U){return P==null?r:P[U]}function ns(P){return On.test(P)}function yp(P){return Fi.test(P)}function mp(P){for(var U,R=[];!(U=P.next()).done;)R.push(U.value);return R}function ha(P){var U=-1,R=Array(P.size);return P.forEach(function(re,de){R[++U]=[de,re]}),R}function au(P,U){return function(R){return P(U(R))}}function vi(P,U){for(var R=-1,re=P.length,de=0,Fe=[];++R<re;){var Lt=P[R];(Lt===U||Lt===b)&&(P[R]=b,Fe[de++]=R)}return Fe}function Rn(P){var U=-1,R=Array(P.size);return P.forEach(function(re){R[++U]=re}),R}function vp(P){var U=-1,R=Array(P.size);return P.forEach(function(re){R[++U]=[re,re]}),R}function wp(P,U,R){for(var re=R-1,de=P.length;++re<de;)if(P[re]===U)return re;return-1}function bp(P,U,R){for(var re=R+1;re--;)if(P[re]===U)return re;return re}function os(P){return ns(P)?Ep(P):np(P)}function Dr(P){return ns(P)?Ip(P):op(P)}function cu(P){for(var U=P.length;U--&&wt.test(P.charAt(U)););return U}var _p=oa(B);function Ep(P){for(var U=is.lastIndex=0;is.test(P);)++U;return U}function Ip(P){return P.match(is)||[]}function xp(P){return P.match(Pn)||[]}var Sp=function P(U){U=U==null?Pe:as.defaults(Pe.Object(),U,as.pick(Pe,Cn));var R=U.Array,re=U.Date,de=U.Error,Fe=U.Function,Lt=U.Math,Ge=U.Object,la=U.RegExp,Pp=U.String,Pr=U.TypeError,Tn=R.prototype,Op=Fe.prototype,cs=Ge.prototype,$n=U["__core-js_shared__"],Fn=Op.toString,qe=cs.hasOwnProperty,Cp=0,uu=function(){var e=/[^.]+$/.exec($n&&$n.keys&&$n.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Dn=cs.toString,Ap=Fn.call(Ge),Np=Pe._,Rp=la("^"+Fn.call(qe).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ln=ar?U.Buffer:r,wi=U.Symbol,jn=U.Uint8Array,hu=Ln?Ln.allocUnsafe:r,qn=au(Ge.getPrototypeOf,Ge),lu=Ge.create,fu=cs.propertyIsEnumerable,Mn=Tn.splice,pu=wi?wi.isConcatSpreadable:r,Ns=wi?wi.iterator:r,Li=wi?wi.toStringTag:r,Un=function(){try{var e=zi(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),Tp=U.clearTimeout!==Pe.clearTimeout&&U.clearTimeout,$p=re&&re.now!==Pe.Date.now&&re.now,Fp=U.setTimeout!==Pe.setTimeout&&U.setTimeout,zn=Lt.ceil,kn=Lt.floor,fa=Ge.getOwnPropertySymbols,Dp=Ln?Ln.isBuffer:r,du=U.isFinite,Lp=Tn.join,jp=au(Ge.keys,Ge),jt=Lt.max,Gt=Lt.min,qp=re.now,Mp=U.parseInt,gu=Lt.random,Up=Tn.reverse,pa=zi(U,"DataView"),Rs=zi(U,"Map"),da=zi(U,"Promise"),us=zi(U,"Set"),Ts=zi(U,"WeakMap"),$s=zi(Ge,"create"),Hn=Ts&&new Ts,hs={},zp=ki(pa),kp=ki(Rs),Hp=ki(da),Kp=ki(us),Vp=ki(Ts),Kn=wi?wi.prototype:r,Fs=Kn?Kn.valueOf:r,yu=Kn?Kn.toString:r;function f(e){if(mt(e)&&!ye(e)&&!(e instanceof Se)){if(e instanceof Or)return e;if(qe.call(e,"__wrapped__"))return mh(e)}return new Or(e)}var ls=function(){function e(){}return function(i){if(!ct(i))return{};if(lu)return lu(i);e.prototype=i;var n=new e;return e.prototype=r,n}}();function Vn(){}function Or(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}f.templateSettings={escape:ft,evaluate:pt,interpolate:at,variable:"",imports:{_:f}},f.prototype=Vn.prototype,f.prototype.constructor=f,Or.prototype=ls(Vn.prototype),Or.prototype.constructor=Or;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Y,this.__views__=[]}function Bp(){var e=new Se(this.__wrapped__);return e.__actions__=cr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=cr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=cr(this.__views__),e}function Gp(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Wp(){var e=this.__wrapped__.value(),i=this.__dir__,n=ye(e),c=i<0,l=n?e.length:0,d=og(0,l,this.__views__),v=d.start,_=d.end,O=_-v,z=c?_:v-1,k=this.__iteratees__,G=k.length,X=0,se=Gt(O,this.__takeCount__);if(!n||!c&&l==O&&se==O)return Uu(e,this.__actions__);var he=[];e:for(;O--&&X<se;){z+=i;for(var we=-1,le=e[z];++we<G;){var Ie=k[we],Oe=Ie.iteratee,br=Ie.type,tr=Oe(le);if(br==V)le=tr;else if(!tr){if(br==T)continue e;break e}}he[X++]=le}return he}Se.prototype=ls(Vn.prototype),Se.prototype.constructor=Se;function ji(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Jp(){this.__data__=$s?$s(null):{},this.size=0}function Qp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Yp(e){var i=this.__data__;if($s){var n=i[e];return n===w?r:n}return qe.call(i,e)?i[e]:r}function Zp(e){var i=this.__data__;return $s?i[e]!==r:qe.call(i,e)}function Xp(e,i){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=$s&&i===r?w:i,this}ji.prototype.clear=Jp,ji.prototype.delete=Qp,ji.prototype.get=Yp,ji.prototype.has=Zp,ji.prototype.set=Xp;function ei(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function ed(){this.__data__=[],this.size=0}function td(e){var i=this.__data__,n=Bn(i,e);if(n<0)return!1;var c=i.length-1;return n==c?i.pop():Mn.call(i,n,1),--this.size,!0}function rd(e){var i=this.__data__,n=Bn(i,e);return n<0?r:i[n][1]}function id(e){return Bn(this.__data__,e)>-1}function sd(e,i){var n=this.__data__,c=Bn(n,e);return c<0?(++this.size,n.push([e,i])):n[c][1]=i,this}ei.prototype.clear=ed,ei.prototype.delete=td,ei.prototype.get=rd,ei.prototype.has=id,ei.prototype.set=sd;function ti(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function nd(){this.size=0,this.__data__={hash:new ji,map:new(Rs||ei),string:new ji}}function od(e){var i=so(this,e).delete(e);return this.size-=i?1:0,i}function ad(e){return so(this,e).get(e)}function cd(e){return so(this,e).has(e)}function ud(e,i){var n=so(this,e),c=n.size;return n.set(e,i),this.size+=n.size==c?0:1,this}ti.prototype.clear=nd,ti.prototype.delete=od,ti.prototype.get=ad,ti.prototype.has=cd,ti.prototype.set=ud;function qi(e){var i=-1,n=e==null?0:e.length;for(this.__data__=new ti;++i<n;)this.add(e[i])}function hd(e){return this.__data__.set(e,w),this}function ld(e){return this.__data__.has(e)}qi.prototype.add=qi.prototype.push=hd,qi.prototype.has=ld;function Lr(e){var i=this.__data__=new ei(e);this.size=i.size}function fd(){this.__data__=new ei,this.size=0}function pd(e){var i=this.__data__,n=i.delete(e);return this.size=i.size,n}function dd(e){return this.__data__.get(e)}function gd(e){return this.__data__.has(e)}function yd(e,i){var n=this.__data__;if(n instanceof ei){var c=n.__data__;if(!Rs||c.length<a-1)return c.push([e,i]),this.size=++n.size,this;n=this.__data__=new ti(c)}return n.set(e,i),this.size=n.size,this}Lr.prototype.clear=fd,Lr.prototype.delete=pd,Lr.prototype.get=dd,Lr.prototype.has=gd,Lr.prototype.set=yd;function mu(e,i){var n=ye(e),c=!n&&Hi(e),l=!n&&!c&&xi(e),d=!n&&!c&&!l&&gs(e),v=n||c||l||d,_=v?ca(e.length,Pp):[],O=_.length;for(var z in e)(i||qe.call(e,z))&&!(v&&(z=="length"||l&&(z=="offset"||z=="parent")||d&&(z=="buffer"||z=="byteLength"||z=="byteOffset")||ni(z,O)))&&_.push(z);return _}function vu(e){var i=e.length;return i?e[Sa(0,i-1)]:r}function md(e,i){return no(cr(e),Mi(i,0,e.length))}function vd(e){return no(cr(e))}function ga(e,i,n){(n!==r&&!jr(e[i],n)||n===r&&!(i in e))&&ri(e,i,n)}function Ds(e,i,n){var c=e[i];(!(qe.call(e,i)&&jr(c,n))||n===r&&!(i in e))&&ri(e,i,n)}function Bn(e,i){for(var n=e.length;n--;)if(jr(e[n][0],i))return n;return-1}function wd(e,i,n,c){return bi(e,function(l,d,v){i(c,l,n(l),v)}),c}function wu(e,i){return e&&Br(i,Ut(i),e)}function bd(e,i){return e&&Br(i,hr(i),e)}function ri(e,i,n){i=="__proto__"&&Un?Un(e,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[i]=n}function ya(e,i){for(var n=-1,c=i.length,l=R(c),d=e==null;++n<c;)l[n]=d?r:Qa(e,i[n]);return l}function Mi(e,i,n){return e===e&&(n!==r&&(e=e<=n?e:n),i!==r&&(e=e>=i?e:i)),e}function Cr(e,i,n,c,l,d){var v,_=i&S,O=i&N,z=i&K;if(n&&(v=l?n(e,c,l,d):n(e)),v!==r)return v;if(!ct(e))return e;var k=ye(e);if(k){if(v=cg(e),!_)return cr(e,v)}else{var G=Wt(e),X=G==ie||G==pe;if(xi(e))return Hu(e,_);if(G==xe||G==be||X&&!l){if(v=O||X?{}:ch(e),!_)return O?Yd(e,bd(v,e)):Qd(e,wu(v,e))}else{if(!ze[G])return l?e:{};v=ug(e,G,_)}}d||(d=new Lr);var se=d.get(e);if(se)return se;d.set(e,v),jh(e)?e.forEach(function(le){v.add(Cr(le,i,n,le,e,d))}):Dh(e)&&e.forEach(function(le,Ie){v.set(Ie,Cr(le,i,n,Ie,e,d))});var he=z?O?La:Da:O?hr:Ut,we=k?r:he(e);return Sr(we||e,function(le,Ie){we&&(Ie=le,le=e[Ie]),Ds(v,Ie,Cr(le,i,n,Ie,e,d))}),v}function _d(e){var i=Ut(e);return function(n){return bu(n,e,i)}}function bu(e,i,n){var c=n.length;if(e==null)return!c;for(e=Ge(e);c--;){var l=n[c],d=i[l],v=e[l];if(v===r&&!(l in e)||!d(v))return!1}return!0}function _u(e,i,n){if(typeof e!="function")throw new Pr(p);return ks(function(){e.apply(r,n)},i)}function Ls(e,i,n,c){var l=-1,d=An,v=!0,_=e.length,O=[],z=i.length;if(!_)return O;n&&(i=it(i,mr(n))),c?(d=ra,v=!1):i.length>=a&&(d=As,v=!1,i=new qi(i));e:for(;++l<_;){var k=e[l],G=n==null?k:n(k);if(k=c||k!==0?k:0,v&&G===G){for(var X=z;X--;)if(i[X]===G)continue e;O.push(k)}else d(i,G,c)||O.push(k)}return O}var bi=Wu(Vr),Eu=Wu(va,!0);function Ed(e,i){var n=!0;return bi(e,function(c,l,d){return n=!!i(c,l,d),n}),n}function Gn(e,i,n){for(var c=-1,l=e.length;++c<l;){var d=e[c],v=i(d);if(v!=null&&(_===r?v===v&&!wr(v):n(v,_)))var _=v,O=d}return O}function Id(e,i,n,c){var l=e.length;for(n=me(n),n<0&&(n=-n>l?0:l+n),c=c===r||c>l?l:me(c),c<0&&(c+=l),c=n>c?0:Mh(c);n<c;)e[n++]=i;return e}function Iu(e,i){var n=[];return bi(e,function(c,l,d){i(c,l,d)&&n.push(c)}),n}function Vt(e,i,n,c,l){var d=-1,v=e.length;for(n||(n=lg),l||(l=[]);++d<v;){var _=e[d];i>0&&n(_)?i>1?Vt(_,i-1,n,c,l):mi(l,_):c||(l[l.length]=_)}return l}var ma=Ju(),xu=Ju(!0);function Vr(e,i){return e&&ma(e,i,Ut)}function va(e,i){return e&&xu(e,i,Ut)}function Wn(e,i){return yi(i,function(n){return oi(e[n])})}function Ui(e,i){i=Ei(i,e);for(var n=0,c=i.length;e!=null&&n<c;)e=e[Gr(i[n++])];return n&&n==c?e:r}function Su(e,i,n){var c=i(e);return ye(e)?c:mi(c,n(e))}function Xt(e){return e==null?e===r?ot:$e:Li&&Li in Ge(e)?ng(e):vg(e)}function wa(e,i){return e>i}function xd(e,i){return e!=null&&qe.call(e,i)}function Sd(e,i){return e!=null&&i in Ge(e)}function Pd(e,i,n){return e>=Gt(i,n)&&e<jt(i,n)}function ba(e,i,n){for(var c=n?ra:An,l=e[0].length,d=e.length,v=d,_=R(d),O=1/0,z=[];v--;){var k=e[v];v&&i&&(k=it(k,mr(i))),O=Gt(k.length,O),_[v]=!n&&(i||l>=120&&k.length>=120)?new qi(v&&k):r}k=e[0];var G=-1,X=_[0];e:for(;++G<l&&z.length<O;){var se=k[G],he=i?i(se):se;if(se=n||se!==0?se:0,!(X?As(X,he):c(z,he,n))){for(v=d;--v;){var we=_[v];if(!(we?As(we,he):c(e[v],he,n)))continue e}X&&X.push(he),z.push(se)}}return z}function Od(e,i,n,c){return Vr(e,function(l,d,v){i(c,n(l),d,v)}),c}function js(e,i,n){i=Ei(i,e),e=fh(e,i);var c=e==null?e:e[Gr(Nr(i))];return c==null?r:Mt(c,e,n)}function Pu(e){return mt(e)&&Xt(e)==be}function Cd(e){return mt(e)&&Xt(e)==Te}function Ad(e){return mt(e)&&Xt(e)==A}function qs(e,i,n,c,l){return e===i?!0:e==null||i==null||!mt(e)&&!mt(i)?e!==e&&i!==i:Nd(e,i,n,c,qs,l)}function Nd(e,i,n,c,l,d){var v=ye(e),_=ye(i),O=v?xt:Wt(e),z=_?xt:Wt(i);O=O==be?xe:O,z=z==be?xe:z;var k=O==xe,G=z==xe,X=O==z;if(X&&xi(e)){if(!xi(i))return!1;v=!0,k=!1}if(X&&!k)return d||(d=new Lr),v||gs(e)?nh(e,i,n,c,l,d):ig(e,i,O,n,c,l,d);if(!(n&j)){var se=k&&qe.call(e,"__wrapped__"),he=G&&qe.call(i,"__wrapped__");if(se||he){var we=se?e.value():e,le=he?i.value():i;return d||(d=new Lr),l(we,le,n,c,d)}}return X?(d||(d=new Lr),sg(e,i,n,c,l,d)):!1}function Rd(e){return mt(e)&&Wt(e)==ve}function _a(e,i,n,c){var l=n.length,d=l,v=!c;if(e==null)return!d;for(e=Ge(e);l--;){var _=n[l];if(v&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++l<d;){_=n[l];var O=_[0],z=e[O],k=_[1];if(v&&_[2]){if(z===r&&!(O in e))return!1}else{var G=new Lr;if(c)var X=c(z,k,O,e,i,G);if(!(X===r?qs(k,z,j|J,c,G):X))return!1}}return!0}function Ou(e){if(!ct(e)||pg(e))return!1;var i=oi(e)?Rp:Uo;return i.test(ki(e))}function Td(e){return mt(e)&&Xt(e)==nt}function $d(e){return mt(e)&&Wt(e)==De}function Fd(e){return mt(e)&&lo(e.length)&&!!Ke[Xt(e)]}function Cu(e){return typeof e=="function"?e:e==null?lr:typeof e=="object"?ye(e)?Ru(e[0],e[1]):Nu(e):Qh(e)}function Ea(e){if(!zs(e))return jp(e);var i=[];for(var n in Ge(e))qe.call(e,n)&&n!="constructor"&&i.push(n);return i}function Dd(e){if(!ct(e))return mg(e);var i=zs(e),n=[];for(var c in e)c=="constructor"&&(i||!qe.call(e,c))||n.push(c);return n}function Ia(e,i){return e<i}function Au(e,i){var n=-1,c=ur(e)?R(e.length):[];return bi(e,function(l,d,v){c[++n]=i(l,d,v)}),c}function Nu(e){var i=qa(e);return i.length==1&&i[0][2]?hh(i[0][0],i[0][1]):function(n){return n===e||_a(n,e,i)}}function Ru(e,i){return Ua(e)&&uh(i)?hh(Gr(e),i):function(n){var c=Qa(n,e);return c===r&&c===i?Ya(n,e):qs(i,c,j|J)}}function Jn(e,i,n,c,l){e!==i&&ma(i,function(d,v){if(l||(l=new Lr),ct(d))Ld(e,i,v,n,Jn,c,l);else{var _=c?c(ka(e,v),d,v+"",e,i,l):r;_===r&&(_=d),ga(e,v,_)}},hr)}function Ld(e,i,n,c,l,d,v){var _=ka(e,n),O=ka(i,n),z=v.get(O);if(z){ga(e,n,z);return}var k=d?d(_,O,n+"",e,i,v):r,G=k===r;if(G){var X=ye(O),se=!X&&xi(O),he=!X&&!se&&gs(O);k=O,X||se||he?ye(_)?k=_:_t(_)?k=cr(_):se?(G=!1,k=Hu(O,!0)):he?(G=!1,k=Ku(O,!0)):k=[]:Hs(O)||Hi(O)?(k=_,Hi(_)?k=Uh(_):(!ct(_)||oi(_))&&(k=ch(O))):G=!1}G&&(v.set(O,k),l(k,O,c,d,v),v.delete(O)),ga(e,n,k)}function Tu(e,i){var n=e.length;if(n)return i+=i<0?n:0,ni(i,n)?e[i]:r}function $u(e,i,n){i.length?i=it(i,function(d){return ye(d)?function(v){return Ui(v,d.length===1?d[0]:d)}:d}):i=[lr];var c=-1;i=it(i,mr(ue()));var l=Au(e,function(d,v,_){var O=it(i,function(z){return z(d)});return{criteria:O,index:++c,value:d}});return up(l,function(d,v){return Jd(d,v,n)})}function jd(e,i){return Fu(e,i,function(n,c){return Ya(e,c)})}function Fu(e,i,n){for(var c=-1,l=i.length,d={};++c<l;){var v=i[c],_=Ui(e,v);n(_,v)&&Ms(d,Ei(v,e),_)}return d}function qd(e){return function(i){return Ui(i,e)}}function xa(e,i,n,c){var l=c?cp:ss,d=-1,v=i.length,_=e;for(e===i&&(i=cr(i)),n&&(_=it(e,mr(n)));++d<v;)for(var O=0,z=i[d],k=n?n(z):z;(O=l(_,k,O,c))>-1;)_!==e&&Mn.call(_,O,1),Mn.call(e,O,1);return e}function Du(e,i){for(var n=e?i.length:0,c=n-1;n--;){var l=i[n];if(n==c||l!==d){var d=l;ni(l)?Mn.call(e,l,1):Ca(e,l)}}return e}function Sa(e,i){return e+kn(gu()*(i-e+1))}function Md(e,i,n,c){for(var l=-1,d=jt(zn((i-e)/(n||1)),0),v=R(d);d--;)v[c?d:++l]=e,e+=n;return v}function Pa(e,i){var n="";if(!e||i<1||i>ee)return n;do i%2&&(n+=e),i=kn(i/2),i&&(e+=e);while(i);return n}function _e(e,i){return Ha(lh(e,i,lr),e+"")}function Ud(e){return vu(ys(e))}function zd(e,i){var n=ys(e);return no(n,Mi(i,0,n.length))}function Ms(e,i,n,c){if(!ct(e))return e;i=Ei(i,e);for(var l=-1,d=i.length,v=d-1,_=e;_!=null&&++l<d;){var O=Gr(i[l]),z=n;if(O==="__proto__"||O==="constructor"||O==="prototype")return e;if(l!=v){var k=_[O];z=c?c(k,O,_):r,z===r&&(z=ct(k)?k:ni(i[l+1])?[]:{})}Ds(_,O,z),_=_[O]}return e}var Lu=Hn?function(e,i){return Hn.set(e,i),e}:lr,kd=Un?function(e,i){return Un(e,"toString",{configurable:!0,enumerable:!1,value:Xa(i),writable:!0})}:lr;function Hd(e){return no(ys(e))}function Ar(e,i,n){var c=-1,l=e.length;i<0&&(i=-i>l?0:l+i),n=n>l?l:n,n<0&&(n+=l),l=i>n?0:n-i>>>0,i>>>=0;for(var d=R(l);++c<l;)d[c]=e[c+i];return d}function Kd(e,i){var n;return bi(e,function(c,l,d){return n=i(c,l,d),!n}),!!n}function Qn(e,i,n){var c=0,l=e==null?c:e.length;if(typeof i=="number"&&i===i&&l<=ke){for(;c<l;){var d=c+l>>>1,v=e[d];v!==null&&!wr(v)&&(n?v<=i:v<i)?c=d+1:l=d}return l}return Oa(e,i,lr,n)}function Oa(e,i,n,c){var l=0,d=e==null?0:e.length;if(d===0)return 0;i=n(i);for(var v=i!==i,_=i===null,O=wr(i),z=i===r;l<d;){var k=kn((l+d)/2),G=n(e[k]),X=G!==r,se=G===null,he=G===G,we=wr(G);if(v)var le=c||he;else z?le=he&&(c||X):_?le=he&&X&&(c||!se):O?le=he&&X&&!se&&(c||!we):se||we?le=!1:le=c?G<=i:G<i;le?l=k+1:d=k}return Gt(d,ut)}function ju(e,i){for(var n=-1,c=e.length,l=0,d=[];++n<c;){var v=e[n],_=i?i(v):v;if(!n||!jr(_,O)){var O=_;d[l++]=v===0?0:v}}return d}function qu(e){return typeof e=="number"?e:wr(e)?W:+e}function vr(e){if(typeof e=="string")return e;if(ye(e))return it(e,vr)+"";if(wr(e))return yu?yu.call(e):"";var i=e+"";return i=="0"&&1/e==-Ne?"-0":i}function _i(e,i,n){var c=-1,l=An,d=e.length,v=!0,_=[],O=_;if(n)v=!1,l=ra;else if(d>=a){var z=i?null:tg(e);if(z)return Rn(z);v=!1,l=As,O=new qi}else O=i?[]:_;e:for(;++c<d;){var k=e[c],G=i?i(k):k;if(k=n||k!==0?k:0,v&&G===G){for(var X=O.length;X--;)if(O[X]===G)continue e;i&&O.push(G),_.push(k)}else l(O,G,n)||(O!==_&&O.push(G),_.push(k))}return _}function Ca(e,i){return i=Ei(i,e),e=fh(e,i),e==null||delete e[Gr(Nr(i))]}function Mu(e,i,n,c){return Ms(e,i,n(Ui(e,i)),c)}function Yn(e,i,n,c){for(var l=e.length,d=c?l:-1;(c?d--:++d<l)&&i(e[d],d,e););return n?Ar(e,c?0:d,c?d+1:l):Ar(e,c?d+1:0,c?l:d)}function Uu(e,i){var n=e;return n instanceof Se&&(n=n.value()),ia(i,function(c,l){return l.func.apply(l.thisArg,mi([c],l.args))},n)}function Aa(e,i,n){var c=e.length;if(c<2)return c?_i(e[0]):[];for(var l=-1,d=R(c);++l<c;)for(var v=e[l],_=-1;++_<c;)_!=l&&(d[l]=Ls(d[l]||v,e[_],i,n));return _i(Vt(d,1),i,n)}function zu(e,i,n){for(var c=-1,l=e.length,d=i.length,v={};++c<l;){var _=c<d?i[c]:r;n(v,e[c],_)}return v}function Na(e){return _t(e)?e:[]}function Ra(e){return typeof e=="function"?e:lr}function Ei(e,i){return ye(e)?e:Ua(e,i)?[e]:yh(Le(e))}var Vd=_e;function Ii(e,i,n){var c=e.length;return n=n===r?c:n,!i&&n>=c?e:Ar(e,i,n)}var ku=Tp||function(e){return Pe.clearTimeout(e)};function Hu(e,i){if(i)return e.slice();var n=e.length,c=hu?hu(n):new e.constructor(n);return e.copy(c),c}function Ta(e){var i=new e.constructor(e.byteLength);return new jn(i).set(new jn(e)),i}function Bd(e,i){var n=i?Ta(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Gd(e){var i=new e.constructor(e.source,Ir.exec(e));return i.lastIndex=e.lastIndex,i}function Wd(e){return Fs?Ge(Fs.call(e)):{}}function Ku(e,i){var n=i?Ta(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Vu(e,i){if(e!==i){var n=e!==r,c=e===null,l=e===e,d=wr(e),v=i!==r,_=i===null,O=i===i,z=wr(i);if(!_&&!z&&!d&&e>i||d&&v&&O&&!_&&!z||c&&v&&O||!n&&O||!l)return 1;if(!c&&!d&&!z&&e<i||z&&n&&l&&!c&&!d||_&&n&&l||!v&&l||!O)return-1}return 0}function Jd(e,i,n){for(var c=-1,l=e.criteria,d=i.criteria,v=l.length,_=n.length;++c<v;){var O=Vu(l[c],d[c]);if(O){if(c>=_)return O;var z=n[c];return O*(z=="desc"?-1:1)}}return e.index-i.index}function Bu(e,i,n,c){for(var l=-1,d=e.length,v=n.length,_=-1,O=i.length,z=jt(d-v,0),k=R(O+z),G=!c;++_<O;)k[_]=i[_];for(;++l<v;)(G||l<d)&&(k[n[l]]=e[l]);for(;z--;)k[_++]=e[l++];return k}function Gu(e,i,n,c){for(var l=-1,d=e.length,v=-1,_=n.length,O=-1,z=i.length,k=jt(d-_,0),G=R(k+z),X=!c;++l<k;)G[l]=e[l];for(var se=l;++O<z;)G[se+O]=i[O];for(;++v<_;)(X||l<d)&&(G[se+n[v]]=e[l++]);return G}function cr(e,i){var n=-1,c=e.length;for(i||(i=R(c));++n<c;)i[n]=e[n];return i}function Br(e,i,n,c){var l=!n;n||(n={});for(var d=-1,v=i.length;++d<v;){var _=i[d],O=c?c(n[_],e[_],_,n,e):r;O===r&&(O=e[_]),l?ri(n,_,O):Ds(n,_,O)}return n}function Qd(e,i){return Br(e,Ma(e),i)}function Yd(e,i){return Br(e,oh(e),i)}function Zn(e,i){return function(n,c){var l=ye(n)?rp:wd,d=i?i():{};return l(n,e,ue(c,2),d)}}function fs(e){return _e(function(i,n){var c=-1,l=n.length,d=l>1?n[l-1]:r,v=l>2?n[2]:r;for(d=e.length>3&&typeof d=="function"?(l--,d):r,v&&er(n[0],n[1],v)&&(d=l<3?r:d,l=1),i=Ge(i);++c<l;){var _=n[c];_&&e(i,_,c,d)}return i})}function Wu(e,i){return function(n,c){if(n==null)return n;if(!ur(n))return e(n,c);for(var l=n.length,d=i?l:-1,v=Ge(n);(i?d--:++d<l)&&c(v[d],d,v)!==!1;);return n}}function Ju(e){return function(i,n,c){for(var l=-1,d=Ge(i),v=c(i),_=v.length;_--;){var O=v[e?_:++l];if(n(d[O],O,d)===!1)break}return i}}function Zd(e,i,n){var c=i&oe,l=Us(e);function d(){var v=this&&this!==Pe&&this instanceof d?l:e;return v.apply(c?n:this,arguments)}return d}function Qu(e){return function(i){i=Le(i);var n=ns(i)?Dr(i):r,c=n?n[0]:i.charAt(0),l=n?Ii(n,1).join(""):i.slice(1);return c[e]()+l}}function ps(e){return function(i){return ia(Wh(Gh(i).replace(Os,"")),e,"")}}function Us(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=ls(e.prototype),c=e.apply(n,i);return ct(c)?c:n}}function Xd(e,i,n){var c=Us(e);function l(){for(var d=arguments.length,v=R(d),_=d,O=ds(l);_--;)v[_]=arguments[_];var z=d<3&&v[0]!==O&&v[d-1]!==O?[]:vi(v,O);if(d-=z.length,d<n)return th(e,i,Xn,l.placeholder,r,v,z,r,r,n-d);var k=this&&this!==Pe&&this instanceof l?c:e;return Mt(k,this,v)}return l}function Yu(e){return function(i,n,c){var l=Ge(i);if(!ur(i)){var d=ue(n,3);i=Ut(i),n=function(_){return d(l[_],_,l)}}var v=e(i,n,c);return v>-1?l[d?i[v]:v]:r}}function Zu(e){return si(function(i){var n=i.length,c=n,l=Or.prototype.thru;for(e&&i.reverse();c--;){var d=i[c];if(typeof d!="function")throw new Pr(p);if(l&&!v&&io(d)=="wrapper")var v=new Or([],!0)}for(c=v?c:n;++c<n;){d=i[c];var _=io(d),O=_=="wrapper"?ja(d):r;O&&za(O[0])&&O[1]==(D|$|q|H)&&!O[4].length&&O[9]==1?v=v[io(O[0])].apply(v,O[3]):v=d.length==1&&za(d)?v[_]():v.thru(d)}return function(){var z=arguments,k=z[0];if(v&&z.length==1&&ye(k))return v.plant(k).value();for(var G=0,X=n?i[G].apply(this,z):k;++G<n;)X=i[G].call(this,X);return X}})}function Xn(e,i,n,c,l,d,v,_,O,z){var k=i&D,G=i&oe,X=i&fe,se=i&($|M),he=i&ce,we=X?r:Us(e);function le(){for(var Ie=arguments.length,Oe=R(Ie),br=Ie;br--;)Oe[br]=arguments[br];if(se)var tr=ds(le),_r=lp(Oe,tr);if(c&&(Oe=Bu(Oe,c,l,se)),d&&(Oe=Gu(Oe,d,v,se)),Ie-=_r,se&&Ie<z){var Et=vi(Oe,tr);return th(e,i,Xn,le.placeholder,n,Oe,Et,_,O,z-Ie)}var qr=G?n:this,ci=X?qr[e]:e;return Ie=Oe.length,_?Oe=wg(Oe,_):he&&Ie>1&&Oe.reverse(),k&&O<Ie&&(Oe.length=O),this&&this!==Pe&&this instanceof le&&(ci=we||Us(ci)),ci.apply(qr,Oe)}return le}function Xu(e,i){return function(n,c){return Od(n,e,i(c),{})}}function eo(e,i){return function(n,c){var l;if(n===r&&c===r)return i;if(n!==r&&(l=n),c!==r){if(l===r)return c;typeof n=="string"||typeof c=="string"?(n=vr(n),c=vr(c)):(n=qu(n),c=qu(c)),l=e(n,c)}return l}}function $a(e){return si(function(i){return i=it(i,mr(ue())),_e(function(n){var c=this;return e(i,function(l){return Mt(l,c,n)})})})}function to(e,i){i=i===r?" ":vr(i);var n=i.length;if(n<2)return n?Pa(i,e):i;var c=Pa(i,zn(e/os(i)));return ns(i)?Ii(Dr(c),0,e).join(""):c.slice(0,e)}function eg(e,i,n,c){var l=i&oe,d=Us(e);function v(){for(var _=-1,O=arguments.length,z=-1,k=c.length,G=R(k+O),X=this&&this!==Pe&&this instanceof v?d:e;++z<k;)G[z]=c[z];for(;O--;)G[z++]=arguments[++_];return Mt(X,l?n:this,G)}return v}function eh(e){return function(i,n,c){return c&&typeof c!="number"&&er(i,n,c)&&(n=c=r),i=ai(i),n===r?(n=i,i=0):n=ai(n),c=c===r?i<n?1:-1:ai(c),Md(i,n,c,e)}}function ro(e){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=Rr(i),n=Rr(n)),e(i,n)}}function th(e,i,n,c,l,d,v,_,O,z){var k=i&$,G=k?v:r,X=k?r:v,se=k?d:r,he=k?r:d;i|=k?q:I,i&=~(k?I:q),i&C||(i&=~(oe|fe));var we=[e,i,l,se,G,he,X,_,O,z],le=n.apply(r,we);return za(e)&&ph(le,we),le.placeholder=c,dh(le,e,i)}function Fa(e){var i=Lt[e];return function(n,c){if(n=Rr(n),c=c==null?0:Gt(me(c),292),c&&du(n)){var l=(Le(n)+"e").split("e"),d=i(l[0]+"e"+(+l[1]+c));return l=(Le(d)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return i(n)}}var tg=us&&1/Rn(new us([,-0]))[1]==Ne?function(e){return new us(e)}:rc;function rh(e){return function(i){var n=Wt(i);return n==ve?ha(i):n==De?vp(i):hp(i,e(i))}}function ii(e,i,n,c,l,d,v,_){var O=i&fe;if(!O&&typeof e!="function")throw new Pr(p);var z=c?c.length:0;if(z||(i&=~(q|I),c=l=r),v=v===r?v:jt(me(v),0),_=_===r?_:me(_),z-=l?l.length:0,i&I){var k=c,G=l;c=l=r}var X=O?r:ja(e),se=[e,i,n,c,l,k,G,d,v,_];if(X&&yg(se,X),e=se[0],i=se[1],n=se[2],c=se[3],l=se[4],_=se[9]=se[9]===r?O?0:e.length:jt(se[9]-z,0),!_&&i&($|M)&&(i&=~($|M)),!i||i==oe)var he=Zd(e,i,n);else i==$||i==M?he=Xd(e,i,_):(i==q||i==(oe|q))&&!l.length?he=eg(e,i,n,c):he=Xn.apply(r,se);var we=X?Lu:ph;return dh(we(he,se),e,i)}function ih(e,i,n,c){return e===r||jr(e,cs[n])&&!qe.call(c,n)?i:e}function sh(e,i,n,c,l,d){return ct(e)&&ct(i)&&(d.set(i,e),Jn(e,i,r,sh,d),d.delete(i)),e}function rg(e){return Hs(e)?r:e}function nh(e,i,n,c,l,d){var v=n&j,_=e.length,O=i.length;if(_!=O&&!(v&&O>_))return!1;var z=d.get(e),k=d.get(i);if(z&&k)return z==i&&k==e;var G=-1,X=!0,se=n&J?new qi:r;for(d.set(e,i),d.set(i,e);++G<_;){var he=e[G],we=i[G];if(c)var le=v?c(we,he,G,i,e,d):c(he,we,G,e,i,d);if(le!==r){if(le)continue;X=!1;break}if(se){if(!sa(i,function(Ie,Oe){if(!As(se,Oe)&&(he===Ie||l(he,Ie,n,c,d)))return se.push(Oe)})){X=!1;break}}else if(!(he===we||l(he,we,n,c,d))){X=!1;break}}return d.delete(e),d.delete(i),X}function ig(e,i,n,c,l,d,v){switch(n){case He:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Te:return!(e.byteLength!=i.byteLength||!d(new jn(e),new jn(i)));case F:case A:case Re:return jr(+e,+i);case E:return e.name==i.name&&e.message==i.message;case nt:case Je:return e==i+"";case ve:var _=ha;case De:var O=c&j;if(_||(_=Rn),e.size!=i.size&&!O)return!1;var z=v.get(e);if(z)return z==i;c|=J,v.set(e,i);var k=nh(_(e),_(i),c,l,d,v);return v.delete(e),k;case Qe:if(Fs)return Fs.call(e)==Fs.call(i)}return!1}function sg(e,i,n,c,l,d){var v=n&j,_=Da(e),O=_.length,z=Da(i),k=z.length;if(O!=k&&!v)return!1;for(var G=O;G--;){var X=_[G];if(!(v?X in i:qe.call(i,X)))return!1}var se=d.get(e),he=d.get(i);if(se&&he)return se==i&&he==e;var we=!0;d.set(e,i),d.set(i,e);for(var le=v;++G<O;){X=_[G];var Ie=e[X],Oe=i[X];if(c)var br=v?c(Oe,Ie,X,i,e,d):c(Ie,Oe,X,e,i,d);if(!(br===r?Ie===Oe||l(Ie,Oe,n,c,d):br)){we=!1;break}le||(le=X=="constructor")}if(we&&!le){var tr=e.constructor,_r=i.constructor;tr!=_r&&"constructor"in e&&"constructor"in i&&!(typeof tr=="function"&&tr instanceof tr&&typeof _r=="function"&&_r instanceof _r)&&(we=!1)}return d.delete(e),d.delete(i),we}function si(e){return Ha(lh(e,r,bh),e+"")}function Da(e){return Su(e,Ut,Ma)}function La(e){return Su(e,hr,oh)}var ja=Hn?function(e){return Hn.get(e)}:rc;function io(e){for(var i=e.name+"",n=hs[i],c=qe.call(hs,i)?n.length:0;c--;){var l=n[c],d=l.func;if(d==null||d==e)return l.name}return i}function ds(e){var i=qe.call(f,"placeholder")?f:e;return i.placeholder}function ue(){var e=f.iteratee||ec;return e=e===ec?Cu:e,arguments.length?e(arguments[0],arguments[1]):e}function so(e,i){var n=e.__data__;return fg(i)?n[typeof i=="string"?"string":"hash"]:n.map}function qa(e){for(var i=Ut(e),n=i.length;n--;){var c=i[n],l=e[c];i[n]=[c,l,uh(l)]}return i}function zi(e,i){var n=gp(e,i);return Ou(n)?n:r}function ng(e){var i=qe.call(e,Li),n=e[Li];try{e[Li]=r;var c=!0}catch{}var l=Dn.call(e);return c&&(i?e[Li]=n:delete e[Li]),l}var Ma=fa?function(e){return e==null?[]:(e=Ge(e),yi(fa(e),function(i){return fu.call(e,i)}))}:ic,oh=fa?function(e){for(var i=[];e;)mi(i,Ma(e)),e=qn(e);return i}:ic,Wt=Xt;(pa&&Wt(new pa(new ArrayBuffer(1)))!=He||Rs&&Wt(new Rs)!=ve||da&&Wt(da.resolve())!=St||us&&Wt(new us)!=De||Ts&&Wt(new Ts)!=Ue)&&(Wt=function(e){var i=Xt(e),n=i==xe?e.constructor:r,c=n?ki(n):"";if(c)switch(c){case zp:return He;case kp:return ve;case Hp:return St;case Kp:return De;case Vp:return Ue}return i});function og(e,i,n){for(var c=-1,l=n.length;++c<l;){var d=n[c],v=d.size;switch(d.type){case"drop":e+=v;break;case"dropRight":i-=v;break;case"take":i=Gt(i,e+v);break;case"takeRight":e=jt(e,i-v);break}}return{start:e,end:i}}function ag(e){var i=e.match(We);return i?i[1].split(Nt):[]}function ah(e,i,n){i=Ei(i,e);for(var c=-1,l=i.length,d=!1;++c<l;){var v=Gr(i[c]);if(!(d=e!=null&&n(e,v)))break;e=e[v]}return d||++c!=l?d:(l=e==null?0:e.length,!!l&&lo(l)&&ni(v,l)&&(ye(e)||Hi(e)))}function cg(e){var i=e.length,n=new e.constructor(i);return i&&typeof e[0]=="string"&&qe.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function ch(e){return typeof e.constructor=="function"&&!zs(e)?ls(qn(e)):{}}function ug(e,i,n){var c=e.constructor;switch(i){case Te:return Ta(e);case F:case A:return new c(+e);case He:return Bd(e,n);case ht:case je:case Pt:case Dt:case Ht:case Kt:case qt:case Qt:case or:return Ku(e,n);case ve:return new c;case Re:case Je:return new c(e);case nt:return Gd(e);case De:return new c;case Qe:return Wd(e)}}function hg(e,i){var n=i.length;if(!n)return e;var c=n-1;return i[c]=(n>1?"& ":"")+i[c],i=i.join(n>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+i+`] */
`)}function lg(e){return ye(e)||Hi(e)||!!(pu&&e&&e[pu])}function ni(e,i){var n=typeof e;return i=i??ee,!!i&&(n=="number"||n!="symbol"&&ko.test(e))&&e>-1&&e%1==0&&e<i}function er(e,i,n){if(!ct(n))return!1;var c=typeof i;return(c=="number"?ur(n)&&ni(i,n.length):c=="string"&&i in n)?jr(n[i],e):!1}function Ua(e,i){if(ye(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||wr(e)?!0:Ot.test(e)||!rt.test(e)||i!=null&&e in Ge(i)}function fg(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function za(e){var i=io(e),n=f[i];if(typeof n!="function"||!(i in Se.prototype))return!1;if(e===n)return!0;var c=ja(n);return!!c&&e===c[0]}function pg(e){return!!uu&&uu in e}var dg=$n?oi:sc;function zs(e){var i=e&&e.constructor,n=typeof i=="function"&&i.prototype||cs;return e===n}function uh(e){return e===e&&!ct(e)}function hh(e,i){return function(n){return n==null?!1:n[e]===i&&(i!==r||e in Ge(n))}}function gg(e){var i=uo(e,function(c){return n.size===y&&n.clear(),c}),n=i.cache;return i}function yg(e,i){var n=e[1],c=i[1],l=n|c,d=l<(oe|fe|D),v=c==D&&n==$||c==D&&n==H&&e[7].length<=i[8]||c==(D|H)&&i[7].length<=i[8]&&n==$;if(!(d||v))return e;c&oe&&(e[2]=i[2],l|=n&oe?0:C);var _=i[3];if(_){var O=e[3];e[3]=O?Bu(O,_,i[4]):_,e[4]=O?vi(e[3],b):i[4]}return _=i[5],_&&(O=e[5],e[5]=O?Gu(O,_,i[6]):_,e[6]=O?vi(e[5],b):i[6]),_=i[7],_&&(e[7]=_),c&D&&(e[8]=e[8]==null?i[8]:Gt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function mg(e){var i=[];if(e!=null)for(var n in Ge(e))i.push(n);return i}function vg(e){return Dn.call(e)}function lh(e,i,n){return i=jt(i===r?e.length-1:i,0),function(){for(var c=arguments,l=-1,d=jt(c.length-i,0),v=R(d);++l<d;)v[l]=c[i+l];l=-1;for(var _=R(i+1);++l<i;)_[l]=c[l];return _[i]=n(v),Mt(e,this,_)}}function fh(e,i){return i.length<2?e:Ui(e,Ar(i,0,-1))}function wg(e,i){for(var n=e.length,c=Gt(i.length,n),l=cr(e);c--;){var d=i[c];e[c]=ni(d,n)?l[d]:r}return e}function ka(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var ph=gh(Lu),ks=Fp||function(e,i){return Pe.setTimeout(e,i)},Ha=gh(kd);function dh(e,i,n){var c=i+"";return Ha(e,hg(c,bg(ag(c),n)))}function gh(e){var i=0,n=0;return function(){var c=qp(),l=et-(c-n);if(n=c,l>0){if(++i>=Ae)return arguments[0]}else i=0;return e.apply(r,arguments)}}function no(e,i){var n=-1,c=e.length,l=c-1;for(i=i===r?c:i;++n<i;){var d=Sa(n,l),v=e[d];e[d]=e[n],e[n]=v}return e.length=i,e}var yh=gg(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Ct,function(n,c,l,d){i.push(l?d.replace(Lo,"$1"):c||n)}),i});function Gr(e){if(typeof e=="string"||wr(e))return e;var i=e+"";return i=="0"&&1/e==-Ne?"-0":i}function ki(e){if(e!=null){try{return Fn.call(e)}catch{}try{return e+""}catch{}}return""}function bg(e,i){return Sr(zr,function(n){var c="_."+n[0];i&n[1]&&!An(e,c)&&e.push(c)}),e.sort()}function mh(e){if(e instanceof Se)return e.clone();var i=new Or(e.__wrapped__,e.__chain__);return i.__actions__=cr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function _g(e,i,n){(n?er(e,i,n):i===r)?i=1:i=jt(me(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var l=0,d=0,v=R(zn(c/i));l<c;)v[d++]=Ar(e,l,l+=i);return v}function Eg(e){for(var i=-1,n=e==null?0:e.length,c=0,l=[];++i<n;){var d=e[i];d&&(l[c++]=d)}return l}function Ig(){var e=arguments.length;if(!e)return[];for(var i=R(e-1),n=arguments[0],c=e;c--;)i[c-1]=arguments[c];return mi(ye(n)?cr(n):[n],Vt(i,1))}var xg=_e(function(e,i){return _t(e)?Ls(e,Vt(i,1,_t,!0)):[]}),Sg=_e(function(e,i){var n=Nr(i);return _t(n)&&(n=r),_t(e)?Ls(e,Vt(i,1,_t,!0),ue(n,2)):[]}),Pg=_e(function(e,i){var n=Nr(i);return _t(n)&&(n=r),_t(e)?Ls(e,Vt(i,1,_t,!0),r,n):[]});function Og(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:me(i),Ar(e,i<0?0:i,c)):[]}function Cg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:me(i),i=c-i,Ar(e,0,i<0?0:i)):[]}function Ag(e,i){return e&&e.length?Yn(e,ue(i,3),!0,!0):[]}function Ng(e,i){return e&&e.length?Yn(e,ue(i,3),!0):[]}function Rg(e,i,n,c){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&er(e,i,n)&&(n=0,c=l),Id(e,i,n,c)):[]}function vh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:me(n);return l<0&&(l=jt(c+l,0)),Nn(e,ue(i,3),l)}function wh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return n!==r&&(l=me(n),l=n<0?jt(c+l,0):Gt(l,c-1)),Nn(e,ue(i,3),l,!0)}function bh(e){var i=e==null?0:e.length;return i?Vt(e,1):[]}function Tg(e){var i=e==null?0:e.length;return i?Vt(e,Ne):[]}function $g(e,i){var n=e==null?0:e.length;return n?(i=i===r?1:me(i),Vt(e,i)):[]}function Fg(e){for(var i=-1,n=e==null?0:e.length,c={};++i<n;){var l=e[i];c[l[0]]=l[1]}return c}function _h(e){return e&&e.length?e[0]:r}function Dg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:me(n);return l<0&&(l=jt(c+l,0)),ss(e,i,l)}function Lg(e){var i=e==null?0:e.length;return i?Ar(e,0,-1):[]}var jg=_e(function(e){var i=it(e,Na);return i.length&&i[0]===e[0]?ba(i):[]}),qg=_e(function(e){var i=Nr(e),n=it(e,Na);return i===Nr(n)?i=r:n.pop(),n.length&&n[0]===e[0]?ba(n,ue(i,2)):[]}),Mg=_e(function(e){var i=Nr(e),n=it(e,Na);return i=typeof i=="function"?i:r,i&&n.pop(),n.length&&n[0]===e[0]?ba(n,r,i):[]});function Ug(e,i){return e==null?"":Lp.call(e,i)}function Nr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function zg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c;return n!==r&&(l=me(n),l=l<0?jt(c+l,0):Gt(l,c-1)),i===i?bp(e,i,l):Nn(e,tu,l,!0)}function kg(e,i){return e&&e.length?Tu(e,me(i)):r}var Hg=_e(Eh);function Eh(e,i){return e&&e.length&&i&&i.length?xa(e,i):e}function Kg(e,i,n){return e&&e.length&&i&&i.length?xa(e,i,ue(n,2)):e}function Vg(e,i,n){return e&&e.length&&i&&i.length?xa(e,i,r,n):e}var Bg=si(function(e,i){var n=e==null?0:e.length,c=ya(e,i);return Du(e,it(i,function(l){return ni(l,n)?+l:l}).sort(Vu)),c});function Gg(e,i){var n=[];if(!(e&&e.length))return n;var c=-1,l=[],d=e.length;for(i=ue(i,3);++c<d;){var v=e[c];i(v,c,e)&&(n.push(v),l.push(c))}return Du(e,l),n}function Ka(e){return e==null?e:Up.call(e)}function Wg(e,i,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&er(e,i,n)?(i=0,n=c):(i=i==null?0:me(i),n=n===r?c:me(n)),Ar(e,i,n)):[]}function Jg(e,i){return Qn(e,i)}function Qg(e,i,n){return Oa(e,i,ue(n,2))}function Yg(e,i){var n=e==null?0:e.length;if(n){var c=Qn(e,i);if(c<n&&jr(e[c],i))return c}return-1}function Zg(e,i){return Qn(e,i,!0)}function Xg(e,i,n){return Oa(e,i,ue(n,2),!0)}function ey(e,i){var n=e==null?0:e.length;if(n){var c=Qn(e,i,!0)-1;if(jr(e[c],i))return c}return-1}function ty(e){return e&&e.length?ju(e):[]}function ry(e,i){return e&&e.length?ju(e,ue(i,2)):[]}function iy(e){var i=e==null?0:e.length;return i?Ar(e,1,i):[]}function sy(e,i,n){return e&&e.length?(i=n||i===r?1:me(i),Ar(e,0,i<0?0:i)):[]}function ny(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:me(i),i=c-i,Ar(e,i<0?0:i,c)):[]}function oy(e,i){return e&&e.length?Yn(e,ue(i,3),!1,!0):[]}function ay(e,i){return e&&e.length?Yn(e,ue(i,3)):[]}var cy=_e(function(e){return _i(Vt(e,1,_t,!0))}),uy=_e(function(e){var i=Nr(e);return _t(i)&&(i=r),_i(Vt(e,1,_t,!0),ue(i,2))}),hy=_e(function(e){var i=Nr(e);return i=typeof i=="function"?i:r,_i(Vt(e,1,_t,!0),r,i)});function ly(e){return e&&e.length?_i(e):[]}function fy(e,i){return e&&e.length?_i(e,ue(i,2)):[]}function py(e,i){return i=typeof i=="function"?i:r,e&&e.length?_i(e,r,i):[]}function Va(e){if(!(e&&e.length))return[];var i=0;return e=yi(e,function(n){if(_t(n))return i=jt(n.length,i),!0}),ca(i,function(n){return it(e,na(n))})}function Ih(e,i){if(!(e&&e.length))return[];var n=Va(e);return i==null?n:it(n,function(c){return Mt(i,r,c)})}var dy=_e(function(e,i){return _t(e)?Ls(e,i):[]}),gy=_e(function(e){return Aa(yi(e,_t))}),yy=_e(function(e){var i=Nr(e);return _t(i)&&(i=r),Aa(yi(e,_t),ue(i,2))}),my=_e(function(e){var i=Nr(e);return i=typeof i=="function"?i:r,Aa(yi(e,_t),r,i)}),vy=_e(Va);function wy(e,i){return zu(e||[],i||[],Ds)}function by(e,i){return zu(e||[],i||[],Ms)}var _y=_e(function(e){var i=e.length,n=i>1?e[i-1]:r;return n=typeof n=="function"?(e.pop(),n):r,Ih(e,n)});function xh(e){var i=f(e);return i.__chain__=!0,i}function Ey(e,i){return i(e),e}function oo(e,i){return i(e)}var Iy=si(function(e){var i=e.length,n=i?e[0]:0,c=this.__wrapped__,l=function(d){return ya(d,e)};return i>1||this.__actions__.length||!(c instanceof Se)||!ni(n)?this.thru(l):(c=c.slice(n,+n+(i?1:0)),c.__actions__.push({func:oo,args:[l],thisArg:r}),new Or(c,this.__chain__).thru(function(d){return i&&!d.length&&d.push(r),d}))});function xy(){return xh(this)}function Sy(){return new Or(this.value(),this.__chain__)}function Py(){this.__values__===r&&(this.__values__=qh(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Oy(){return this}function Cy(e){for(var i,n=this;n instanceof Vn;){var c=mh(n);c.__index__=0,c.__values__=r,i?l.__wrapped__=c:i=c;var l=c;n=n.__wrapped__}return l.__wrapped__=e,i}function Ay(){var e=this.__wrapped__;if(e instanceof Se){var i=e;return this.__actions__.length&&(i=new Se(this)),i=i.reverse(),i.__actions__.push({func:oo,args:[Ka],thisArg:r}),new Or(i,this.__chain__)}return this.thru(Ka)}function Ny(){return Uu(this.__wrapped__,this.__actions__)}var Ry=Zn(function(e,i,n){qe.call(e,n)?++e[n]:ri(e,n,1)});function Ty(e,i,n){var c=ye(e)?Xc:Ed;return n&&er(e,i,n)&&(i=r),c(e,ue(i,3))}function $y(e,i){var n=ye(e)?yi:Iu;return n(e,ue(i,3))}var Fy=Yu(vh),Dy=Yu(wh);function Ly(e,i){return Vt(ao(e,i),1)}function jy(e,i){return Vt(ao(e,i),Ne)}function qy(e,i,n){return n=n===r?1:me(n),Vt(ao(e,i),n)}function Sh(e,i){var n=ye(e)?Sr:bi;return n(e,ue(i,3))}function Ph(e,i){var n=ye(e)?ip:Eu;return n(e,ue(i,3))}var My=Zn(function(e,i,n){qe.call(e,n)?e[n].push(i):ri(e,n,[i])});function Uy(e,i,n,c){e=ur(e)?e:ys(e),n=n&&!c?me(n):0;var l=e.length;return n<0&&(n=jt(l+n,0)),fo(e)?n<=l&&e.indexOf(i,n)>-1:!!l&&ss(e,i,n)>-1}var zy=_e(function(e,i,n){var c=-1,l=typeof i=="function",d=ur(e)?R(e.length):[];return bi(e,function(v){d[++c]=l?Mt(i,v,n):js(v,i,n)}),d}),ky=Zn(function(e,i,n){ri(e,n,i)});function ao(e,i){var n=ye(e)?it:Au;return n(e,ue(i,3))}function Hy(e,i,n,c){return e==null?[]:(ye(i)||(i=i==null?[]:[i]),n=c?r:n,ye(n)||(n=n==null?[]:[n]),$u(e,i,n))}var Ky=Zn(function(e,i,n){e[n?0:1].push(i)},function(){return[[],[]]});function Vy(e,i,n){var c=ye(e)?ia:iu,l=arguments.length<3;return c(e,ue(i,4),n,l,bi)}function By(e,i,n){var c=ye(e)?sp:iu,l=arguments.length<3;return c(e,ue(i,4),n,l,Eu)}function Gy(e,i){var n=ye(e)?yi:Iu;return n(e,ho(ue(i,3)))}function Wy(e){var i=ye(e)?vu:Ud;return i(e)}function Jy(e,i,n){(n?er(e,i,n):i===r)?i=1:i=me(i);var c=ye(e)?md:zd;return c(e,i)}function Qy(e){var i=ye(e)?vd:Hd;return i(e)}function Yy(e){if(e==null)return 0;if(ur(e))return fo(e)?os(e):e.length;var i=Wt(e);return i==ve||i==De?e.size:Ea(e).length}function Zy(e,i,n){var c=ye(e)?sa:Kd;return n&&er(e,i,n)&&(i=r),c(e,ue(i,3))}var Xy=_e(function(e,i){if(e==null)return[];var n=i.length;return n>1&&er(e,i[0],i[1])?i=[]:n>2&&er(i[0],i[1],i[2])&&(i=[i[0]]),$u(e,Vt(i,1),[])}),co=$p||function(){return Pe.Date.now()};function em(e,i){if(typeof i!="function")throw new Pr(p);return e=me(e),function(){if(--e<1)return i.apply(this,arguments)}}function Oh(e,i,n){return i=n?r:i,i=e&&i==null?e.length:i,ii(e,D,r,r,r,r,i)}function Ch(e,i){var n;if(typeof i!="function")throw new Pr(p);return e=me(e),function(){return--e>0&&(n=i.apply(this,arguments)),e<=1&&(i=r),n}}var Ba=_e(function(e,i,n){var c=oe;if(n.length){var l=vi(n,ds(Ba));c|=q}return ii(e,c,i,n,l)}),Ah=_e(function(e,i,n){var c=oe|fe;if(n.length){var l=vi(n,ds(Ah));c|=q}return ii(i,c,e,n,l)});function Nh(e,i,n){i=n?r:i;var c=ii(e,$,r,r,r,r,r,i);return c.placeholder=Nh.placeholder,c}function Rh(e,i,n){i=n?r:i;var c=ii(e,M,r,r,r,r,r,i);return c.placeholder=Rh.placeholder,c}function Th(e,i,n){var c,l,d,v,_,O,z=0,k=!1,G=!1,X=!0;if(typeof e!="function")throw new Pr(p);i=Rr(i)||0,ct(n)&&(k=!!n.leading,G="maxWait"in n,d=G?jt(Rr(n.maxWait)||0,i):d,X="trailing"in n?!!n.trailing:X);function se(Et){var qr=c,ci=l;return c=l=r,z=Et,v=e.apply(ci,qr),v}function he(Et){return z=Et,_=ks(Ie,i),k?se(Et):v}function we(Et){var qr=Et-O,ci=Et-z,Yh=i-qr;return G?Gt(Yh,d-ci):Yh}function le(Et){var qr=Et-O,ci=Et-z;return O===r||qr>=i||qr<0||G&&ci>=d}function Ie(){var Et=co();if(le(Et))return Oe(Et);_=ks(Ie,we(Et))}function Oe(Et){return _=r,X&&c?se(Et):(c=l=r,v)}function br(){_!==r&&ku(_),z=0,c=O=l=_=r}function tr(){return _===r?v:Oe(co())}function _r(){var Et=co(),qr=le(Et);if(c=arguments,l=this,O=Et,qr){if(_===r)return he(O);if(G)return ku(_),_=ks(Ie,i),se(O)}return _===r&&(_=ks(Ie,i)),v}return _r.cancel=br,_r.flush=tr,_r}var tm=_e(function(e,i){return _u(e,1,i)}),rm=_e(function(e,i,n){return _u(e,Rr(i)||0,n)});function im(e){return ii(e,ce)}function uo(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Pr(p);var n=function(){var c=arguments,l=i?i.apply(this,c):c[0],d=n.cache;if(d.has(l))return d.get(l);var v=e.apply(this,c);return n.cache=d.set(l,v)||d,v};return n.cache=new(uo.Cache||ti),n}uo.Cache=ti;function ho(e){if(typeof e!="function")throw new Pr(p);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function sm(e){return Ch(2,e)}var nm=Vd(function(e,i){i=i.length==1&&ye(i[0])?it(i[0],mr(ue())):it(Vt(i,1),mr(ue()));var n=i.length;return _e(function(c){for(var l=-1,d=Gt(c.length,n);++l<d;)c[l]=i[l].call(this,c[l]);return Mt(e,this,c)})}),Ga=_e(function(e,i){var n=vi(i,ds(Ga));return ii(e,q,r,i,n)}),$h=_e(function(e,i){var n=vi(i,ds($h));return ii(e,I,r,i,n)}),om=si(function(e,i){return ii(e,H,r,r,r,i)});function am(e,i){if(typeof e!="function")throw new Pr(p);return i=i===r?i:me(i),_e(e,i)}function cm(e,i){if(typeof e!="function")throw new Pr(p);return i=i==null?0:jt(me(i),0),_e(function(n){var c=n[i],l=Ii(n,0,i);return c&&mi(l,c),Mt(e,this,l)})}function um(e,i,n){var c=!0,l=!0;if(typeof e!="function")throw new Pr(p);return ct(n)&&(c="leading"in n?!!n.leading:c,l="trailing"in n?!!n.trailing:l),Th(e,i,{leading:c,maxWait:i,trailing:l})}function hm(e){return Oh(e,1)}function lm(e,i){return Ga(Ra(i),e)}function fm(){if(!arguments.length)return[];var e=arguments[0];return ye(e)?e:[e]}function pm(e){return Cr(e,K)}function dm(e,i){return i=typeof i=="function"?i:r,Cr(e,K,i)}function gm(e){return Cr(e,S|K)}function ym(e,i){return i=typeof i=="function"?i:r,Cr(e,S|K,i)}function mm(e,i){return i==null||bu(e,i,Ut(i))}function jr(e,i){return e===i||e!==e&&i!==i}var vm=ro(wa),wm=ro(function(e,i){return e>=i}),Hi=Pu(function(){return arguments}())?Pu:function(e){return mt(e)&&qe.call(e,"callee")&&!fu.call(e,"callee")},ye=R.isArray,bm=Zt?mr(Zt):Cd;function ur(e){return e!=null&&lo(e.length)&&!oi(e)}function _t(e){return mt(e)&&ur(e)}function _m(e){return e===!0||e===!1||mt(e)&&Xt(e)==F}var xi=Dp||sc,Em=Fr?mr(Fr):Ad;function Im(e){return mt(e)&&e.nodeType===1&&!Hs(e)}function xm(e){if(e==null)return!0;if(ur(e)&&(ye(e)||typeof e=="string"||typeof e.splice=="function"||xi(e)||gs(e)||Hi(e)))return!e.length;var i=Wt(e);if(i==ve||i==De)return!e.size;if(zs(e))return!Ea(e).length;for(var n in e)if(qe.call(e,n))return!1;return!0}function Sm(e,i){return qs(e,i)}function Pm(e,i,n){n=typeof n=="function"?n:r;var c=n?n(e,i):r;return c===r?qs(e,i,r,n):!!c}function Wa(e){if(!mt(e))return!1;var i=Xt(e);return i==E||i==u||typeof e.message=="string"&&typeof e.name=="string"&&!Hs(e)}function Om(e){return typeof e=="number"&&du(e)}function oi(e){if(!ct(e))return!1;var i=Xt(e);return i==ie||i==pe||i==L||i==vt}function Fh(e){return typeof e=="number"&&e==me(e)}function lo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ee}function ct(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function mt(e){return e!=null&&typeof e=="object"}var Dh=xr?mr(xr):Rd;function Cm(e,i){return e===i||_a(e,i,qa(i))}function Am(e,i,n){return n=typeof n=="function"?n:r,_a(e,i,qa(i),n)}function Nm(e){return Lh(e)&&e!=+e}function Rm(e){if(dg(e))throw new de(h);return Ou(e)}function Tm(e){return e===null}function $m(e){return e==null}function Lh(e){return typeof e=="number"||mt(e)&&Xt(e)==Re}function Hs(e){if(!mt(e)||Xt(e)!=xe)return!1;var i=qn(e);if(i===null)return!0;var n=qe.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&Fn.call(n)==Ap}var Ja=Kr?mr(Kr):Td;function Fm(e){return Fh(e)&&e>=-ee&&e<=ee}var jh=Cs?mr(Cs):$d;function fo(e){return typeof e=="string"||!ye(e)&&mt(e)&&Xt(e)==Je}function wr(e){return typeof e=="symbol"||mt(e)&&Xt(e)==Qe}var gs=Di?mr(Di):Fd;function Dm(e){return e===r}function Lm(e){return mt(e)&&Wt(e)==Ue}function jm(e){return mt(e)&&Xt(e)==Ye}var qm=ro(Ia),Mm=ro(function(e,i){return e<=i});function qh(e){if(!e)return[];if(ur(e))return fo(e)?Dr(e):cr(e);if(Ns&&e[Ns])return mp(e[Ns]());var i=Wt(e),n=i==ve?ha:i==De?Rn:ys;return n(e)}function ai(e){if(!e)return e===0?e:0;if(e=Rr(e),e===Ne||e===-Ne){var i=e<0?-1:1;return i*Q}return e===e?e:0}function me(e){var i=ai(e),n=i%1;return i===i?n?i-n:i:0}function Mh(e){return e?Mi(me(e),0,Y):0}function Rr(e){if(typeof e=="number")return e;if(wr(e))return W;if(ct(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=ct(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=su(e);var n=Mo.test(e);return n||zo.test(e)?ge(e.slice(2),n?2:8):qo.test(e)?W:+e}function Uh(e){return Br(e,hr(e))}function Um(e){return e?Mi(me(e),-ee,ee):e===0?e:0}function Le(e){return e==null?"":vr(e)}var zm=fs(function(e,i){if(zs(i)||ur(i)){Br(i,Ut(i),e);return}for(var n in i)qe.call(i,n)&&Ds(e,n,i[n])}),zh=fs(function(e,i){Br(i,hr(i),e)}),po=fs(function(e,i,n,c){Br(i,hr(i),e,c)}),km=fs(function(e,i,n,c){Br(i,Ut(i),e,c)}),Hm=si(ya);function Km(e,i){var n=ls(e);return i==null?n:wu(n,i)}var Vm=_e(function(e,i){e=Ge(e);var n=-1,c=i.length,l=c>2?i[2]:r;for(l&&er(i[0],i[1],l)&&(c=1);++n<c;)for(var d=i[n],v=hr(d),_=-1,O=v.length;++_<O;){var z=v[_],k=e[z];(k===r||jr(k,cs[z])&&!qe.call(e,z))&&(e[z]=d[z])}return e}),Bm=_e(function(e){return e.push(r,sh),Mt(kh,r,e)});function Gm(e,i){return eu(e,ue(i,3),Vr)}function Wm(e,i){return eu(e,ue(i,3),va)}function Jm(e,i){return e==null?e:ma(e,ue(i,3),hr)}function Qm(e,i){return e==null?e:xu(e,ue(i,3),hr)}function Ym(e,i){return e&&Vr(e,ue(i,3))}function Zm(e,i){return e&&va(e,ue(i,3))}function Xm(e){return e==null?[]:Wn(e,Ut(e))}function e0(e){return e==null?[]:Wn(e,hr(e))}function Qa(e,i,n){var c=e==null?r:Ui(e,i);return c===r?n:c}function t0(e,i){return e!=null&&ah(e,i,xd)}function Ya(e,i){return e!=null&&ah(e,i,Sd)}var r0=Xu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=Dn.call(i)),e[i]=n},Xa(lr)),i0=Xu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=Dn.call(i)),qe.call(e,i)?e[i].push(n):e[i]=[n]},ue),s0=_e(js);function Ut(e){return ur(e)?mu(e):Ea(e)}function hr(e){return ur(e)?mu(e,!0):Dd(e)}function n0(e,i){var n={};return i=ue(i,3),Vr(e,function(c,l,d){ri(n,i(c,l,d),c)}),n}function o0(e,i){var n={};return i=ue(i,3),Vr(e,function(c,l,d){ri(n,l,i(c,l,d))}),n}var a0=fs(function(e,i,n){Jn(e,i,n)}),kh=fs(function(e,i,n,c){Jn(e,i,n,c)}),c0=si(function(e,i){var n={};if(e==null)return n;var c=!1;i=it(i,function(d){return d=Ei(d,e),c||(c=d.length>1),d}),Br(e,La(e),n),c&&(n=Cr(n,S|N|K,rg));for(var l=i.length;l--;)Ca(n,i[l]);return n});function u0(e,i){return Hh(e,ho(ue(i)))}var h0=si(function(e,i){return e==null?{}:jd(e,i)});function Hh(e,i){if(e==null)return{};var n=it(La(e),function(c){return[c]});return i=ue(i),Fu(e,n,function(c,l){return i(c,l[0])})}function l0(e,i,n){i=Ei(i,e);var c=-1,l=i.length;for(l||(l=1,e=r);++c<l;){var d=e==null?r:e[Gr(i[c])];d===r&&(c=l,d=n),e=oi(d)?d.call(e):d}return e}function f0(e,i,n){return e==null?e:Ms(e,i,n)}function p0(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:Ms(e,i,n,c)}var Kh=rh(Ut),Vh=rh(hr);function d0(e,i,n){var c=ye(e),l=c||xi(e)||gs(e);if(i=ue(i,4),n==null){var d=e&&e.constructor;l?n=c?new d:[]:ct(e)?n=oi(d)?ls(qn(e)):{}:n={}}return(l?Sr:Vr)(e,function(v,_,O){return i(n,v,_,O)}),n}function g0(e,i){return e==null?!0:Ca(e,i)}function y0(e,i,n){return e==null?e:Mu(e,i,Ra(n))}function m0(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:Mu(e,i,Ra(n),c)}function ys(e){return e==null?[]:ua(e,Ut(e))}function v0(e){return e==null?[]:ua(e,hr(e))}function w0(e,i,n){return n===r&&(n=i,i=r),n!==r&&(n=Rr(n),n=n===n?n:0),i!==r&&(i=Rr(i),i=i===i?i:0),Mi(Rr(e),i,n)}function b0(e,i,n){return i=ai(i),n===r?(n=i,i=0):n=ai(n),e=Rr(e),Pd(e,i,n)}function _0(e,i,n){if(n&&typeof n!="boolean"&&er(e,i,n)&&(i=n=r),n===r&&(typeof i=="boolean"?(n=i,i=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ai(e),i===r?(i=e,e=0):i=ai(i)),e>i){var c=e;e=i,i=c}if(n||e%1||i%1){var l=gu();return Gt(e+l*(i-e+Ve("1e-"+((l+"").length-1))),i)}return Sa(e,i)}var E0=ps(function(e,i,n){return i=i.toLowerCase(),e+(n?Bh(i):i)});function Bh(e){return Za(Le(e).toLowerCase())}function Gh(e){return e=Le(e),e&&e.replace(Zr,fp).replace(ea,"")}function I0(e,i,n){e=Le(e),i=vr(i);var c=e.length;n=n===r?c:Mi(me(n),0,c);var l=n;return n-=i.length,n>=0&&e.slice(n,l)==i}function x0(e){return e=Le(e),e&&tt.test(e)?e.replace(Ni,pp):e}function S0(e){return e=Le(e),e&&At.test(e)?e.replace(dt,"\\$&"):e}var P0=ps(function(e,i,n){return e+(n?"-":"")+i.toLowerCase()}),O0=ps(function(e,i,n){return e+(n?" ":"")+i.toLowerCase()}),C0=Qu("toLowerCase");function A0(e,i,n){e=Le(e),i=me(i);var c=i?os(e):0;if(!i||c>=i)return e;var l=(i-c)/2;return to(kn(l),n)+e+to(zn(l),n)}function N0(e,i,n){e=Le(e),i=me(i);var c=i?os(e):0;return i&&c<i?e+to(i-c,n):e}function R0(e,i,n){e=Le(e),i=me(i);var c=i?os(e):0;return i&&c<i?to(i-c,n)+e:e}function T0(e,i,n){return n||i==null?i=0:i&&(i=+i),Mp(Le(e).replace(gt,""),i||0)}function $0(e,i,n){return(n?er(e,i,n):i===r)?i=1:i=me(i),Pa(Le(e),i)}function F0(){var e=arguments,i=Le(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var D0=ps(function(e,i,n){return e+(n?"_":"")+i.toLowerCase()});function L0(e,i,n){return n&&typeof n!="number"&&er(e,i,n)&&(i=n=r),n=n===r?Y:n>>>0,n?(e=Le(e),e&&(typeof i=="string"||i!=null&&!Ja(i))&&(i=vr(i),!i&&ns(e))?Ii(Dr(e),0,n):e.split(i,n)):[]}var j0=ps(function(e,i,n){return e+(n?" ":"")+Za(i)});function q0(e,i,n){return e=Le(e),n=n==null?0:Mi(me(n),0,e.length),i=vr(i),e.slice(n,n+i.length)==i}function M0(e,i,n){var c=f.templateSettings;n&&er(e,i,n)&&(i=r),e=Le(e),i=po({},i,c,ih);var l=po({},i.imports,c.imports,ih),d=Ut(l),v=ua(l,d),_,O,z=0,k=i.interpolate||Yi,G="__p += '",X=la((i.escape||Yi).source+"|"+k.source+"|"+(k===at?jo:Yi).source+"|"+(i.evaluate||Yi).source+"|$","g"),se="//# sourceURL="+(qe.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ta+"]")+`
`;e.replace(X,function(le,Ie,Oe,br,tr,_r){return Oe||(Oe=br),G+=e.slice(z,_r).replace(Ho,dp),Ie&&(_=!0,G+=`' +
__e(`+Ie+`) +
'`),tr&&(O=!0,G+=`';
`+tr+`;
__p += '`),Oe&&(G+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),z=_r+le.length,le}),G+=`';
`;var he=qe.call(i,"variable")&&i.variable;if(!he)G=`with (obj) {
`+G+`
}
`;else if(Do.test(he))throw new de(g);G=(O?G.replace(kr,""):G).replace(Yt,"$1").replace(Yr,"$1;"),G="function("+(he||"obj")+`) {
`+(he?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(O?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+G+`return __p
}`;var we=Jh(function(){return Fe(d,se+"return "+G).apply(r,v)});if(we.source=G,Wa(we))throw we;return we}function U0(e){return Le(e).toLowerCase()}function z0(e){return Le(e).toUpperCase()}function k0(e,i,n){if(e=Le(e),e&&(n||i===r))return su(e);if(!e||!(i=vr(i)))return e;var c=Dr(e),l=Dr(i),d=nu(c,l),v=ou(c,l)+1;return Ii(c,d,v).join("")}function H0(e,i,n){if(e=Le(e),e&&(n||i===r))return e.slice(0,cu(e)+1);if(!e||!(i=vr(i)))return e;var c=Dr(e),l=ou(c,Dr(i))+1;return Ii(c,0,l).join("")}function K0(e,i,n){if(e=Le(e),e&&(n||i===r))return e.replace(gt,"");if(!e||!(i=vr(i)))return e;var c=Dr(e),l=nu(c,Dr(i));return Ii(c,l).join("")}function V0(e,i){var n=ae,c=Ee;if(ct(i)){var l="separator"in i?i.separator:l;n="length"in i?me(i.length):n,c="omission"in i?vr(i.omission):c}e=Le(e);var d=e.length;if(ns(e)){var v=Dr(e);d=v.length}if(n>=d)return e;var _=n-os(c);if(_<1)return c;var O=v?Ii(v,0,_).join(""):e.slice(0,_);if(l===r)return O+c;if(v&&(_+=O.length-_),Ja(l)){if(e.slice(_).search(l)){var z,k=O;for(l.global||(l=la(l.source,Le(Ir.exec(l))+"g")),l.lastIndex=0;z=l.exec(k);)var G=z.index;O=O.slice(0,G===r?_:G)}}else if(e.indexOf(vr(l),_)!=_){var X=O.lastIndexOf(l);X>-1&&(O=O.slice(0,X))}return O+c}function B0(e){return e=Le(e),e&&lt.test(e)?e.replace(di,_p):e}var G0=ps(function(e,i,n){return e+(n?" ":"")+i.toUpperCase()}),Za=Qu("toUpperCase");function Wh(e,i,n){return e=Le(e),i=n?r:i,i===r?yp(e)?xp(e):ap(e):e.match(i)||[]}var Jh=_e(function(e,i){try{return Mt(e,r,i)}catch(n){return Wa(n)?n:new de(n)}}),W0=si(function(e,i){return Sr(i,function(n){n=Gr(n),ri(e,n,Ba(e[n],e))}),e});function J0(e){var i=e==null?0:e.length,n=ue();return e=i?it(e,function(c){if(typeof c[1]!="function")throw new Pr(p);return[n(c[0]),c[1]]}):[],_e(function(c){for(var l=-1;++l<i;){var d=e[l];if(Mt(d[0],this,c))return Mt(d[1],this,c)}})}function Q0(e){return _d(Cr(e,S))}function Xa(e){return function(){return e}}function Y0(e,i){return e==null||e!==e?i:e}var Z0=Zu(),X0=Zu(!0);function lr(e){return e}function ec(e){return Cu(typeof e=="function"?e:Cr(e,S))}function ev(e){return Nu(Cr(e,S))}function tv(e,i){return Ru(e,Cr(i,S))}var rv=_e(function(e,i){return function(n){return js(n,e,i)}}),iv=_e(function(e,i){return function(n){return js(e,n,i)}});function tc(e,i,n){var c=Ut(i),l=Wn(i,c);n==null&&!(ct(i)&&(l.length||!c.length))&&(n=i,i=e,e=this,l=Wn(i,Ut(i)));var d=!(ct(n)&&"chain"in n)||!!n.chain,v=oi(e);return Sr(l,function(_){var O=i[_];e[_]=O,v&&(e.prototype[_]=function(){var z=this.__chain__;if(d||z){var k=e(this.__wrapped__),G=k.__actions__=cr(this.__actions__);return G.push({func:O,args:arguments,thisArg:e}),k.__chain__=z,k}return O.apply(e,mi([this.value()],arguments))})}),e}function sv(){return Pe._===this&&(Pe._=Np),this}function rc(){}function nv(e){return e=me(e),_e(function(i){return Tu(i,e)})}var ov=$a(it),av=$a(Xc),cv=$a(sa);function Qh(e){return Ua(e)?na(Gr(e)):qd(e)}function uv(e){return function(i){return e==null?r:Ui(e,i)}}var hv=eh(),lv=eh(!0);function ic(){return[]}function sc(){return!1}function fv(){return{}}function pv(){return""}function dv(){return!0}function gv(e,i){if(e=me(e),e<1||e>ee)return[];var n=Y,c=Gt(e,Y);i=ue(i),e-=Y;for(var l=ca(c,i);++n<e;)i(n);return l}function yv(e){return ye(e)?it(e,Gr):wr(e)?[e]:cr(yh(Le(e)))}function mv(e){var i=++Cp;return Le(e)+i}var vv=eo(function(e,i){return e+i},0),wv=Fa("ceil"),bv=eo(function(e,i){return e/i},1),_v=Fa("floor");function Ev(e){return e&&e.length?Gn(e,lr,wa):r}function Iv(e,i){return e&&e.length?Gn(e,ue(i,2),wa):r}function xv(e){return ru(e,lr)}function Sv(e,i){return ru(e,ue(i,2))}function Pv(e){return e&&e.length?Gn(e,lr,Ia):r}function Ov(e,i){return e&&e.length?Gn(e,ue(i,2),Ia):r}var Cv=eo(function(e,i){return e*i},1),Av=Fa("round"),Nv=eo(function(e,i){return e-i},0);function Rv(e){return e&&e.length?aa(e,lr):0}function Tv(e,i){return e&&e.length?aa(e,ue(i,2)):0}return f.after=em,f.ary=Oh,f.assign=zm,f.assignIn=zh,f.assignInWith=po,f.assignWith=km,f.at=Hm,f.before=Ch,f.bind=Ba,f.bindAll=W0,f.bindKey=Ah,f.castArray=fm,f.chain=xh,f.chunk=_g,f.compact=Eg,f.concat=Ig,f.cond=J0,f.conforms=Q0,f.constant=Xa,f.countBy=Ry,f.create=Km,f.curry=Nh,f.curryRight=Rh,f.debounce=Th,f.defaults=Vm,f.defaultsDeep=Bm,f.defer=tm,f.delay=rm,f.difference=xg,f.differenceBy=Sg,f.differenceWith=Pg,f.drop=Og,f.dropRight=Cg,f.dropRightWhile=Ag,f.dropWhile=Ng,f.fill=Rg,f.filter=$y,f.flatMap=Ly,f.flatMapDeep=jy,f.flatMapDepth=qy,f.flatten=bh,f.flattenDeep=Tg,f.flattenDepth=$g,f.flip=im,f.flow=Z0,f.flowRight=X0,f.fromPairs=Fg,f.functions=Xm,f.functionsIn=e0,f.groupBy=My,f.initial=Lg,f.intersection=jg,f.intersectionBy=qg,f.intersectionWith=Mg,f.invert=r0,f.invertBy=i0,f.invokeMap=zy,f.iteratee=ec,f.keyBy=ky,f.keys=Ut,f.keysIn=hr,f.map=ao,f.mapKeys=n0,f.mapValues=o0,f.matches=ev,f.matchesProperty=tv,f.memoize=uo,f.merge=a0,f.mergeWith=kh,f.method=rv,f.methodOf=iv,f.mixin=tc,f.negate=ho,f.nthArg=nv,f.omit=c0,f.omitBy=u0,f.once=sm,f.orderBy=Hy,f.over=ov,f.overArgs=nm,f.overEvery=av,f.overSome=cv,f.partial=Ga,f.partialRight=$h,f.partition=Ky,f.pick=h0,f.pickBy=Hh,f.property=Qh,f.propertyOf=uv,f.pull=Hg,f.pullAll=Eh,f.pullAllBy=Kg,f.pullAllWith=Vg,f.pullAt=Bg,f.range=hv,f.rangeRight=lv,f.rearg=om,f.reject=Gy,f.remove=Gg,f.rest=am,f.reverse=Ka,f.sampleSize=Jy,f.set=f0,f.setWith=p0,f.shuffle=Qy,f.slice=Wg,f.sortBy=Xy,f.sortedUniq=ty,f.sortedUniqBy=ry,f.split=L0,f.spread=cm,f.tail=iy,f.take=sy,f.takeRight=ny,f.takeRightWhile=oy,f.takeWhile=ay,f.tap=Ey,f.throttle=um,f.thru=oo,f.toArray=qh,f.toPairs=Kh,f.toPairsIn=Vh,f.toPath=yv,f.toPlainObject=Uh,f.transform=d0,f.unary=hm,f.union=cy,f.unionBy=uy,f.unionWith=hy,f.uniq=ly,f.uniqBy=fy,f.uniqWith=py,f.unset=g0,f.unzip=Va,f.unzipWith=Ih,f.update=y0,f.updateWith=m0,f.values=ys,f.valuesIn=v0,f.without=dy,f.words=Wh,f.wrap=lm,f.xor=gy,f.xorBy=yy,f.xorWith=my,f.zip=vy,f.zipObject=wy,f.zipObjectDeep=by,f.zipWith=_y,f.entries=Kh,f.entriesIn=Vh,f.extend=zh,f.extendWith=po,tc(f,f),f.add=vv,f.attempt=Jh,f.camelCase=E0,f.capitalize=Bh,f.ceil=wv,f.clamp=w0,f.clone=pm,f.cloneDeep=gm,f.cloneDeepWith=ym,f.cloneWith=dm,f.conformsTo=mm,f.deburr=Gh,f.defaultTo=Y0,f.divide=bv,f.endsWith=I0,f.eq=jr,f.escape=x0,f.escapeRegExp=S0,f.every=Ty,f.find=Fy,f.findIndex=vh,f.findKey=Gm,f.findLast=Dy,f.findLastIndex=wh,f.findLastKey=Wm,f.floor=_v,f.forEach=Sh,f.forEachRight=Ph,f.forIn=Jm,f.forInRight=Qm,f.forOwn=Ym,f.forOwnRight=Zm,f.get=Qa,f.gt=vm,f.gte=wm,f.has=t0,f.hasIn=Ya,f.head=_h,f.identity=lr,f.includes=Uy,f.indexOf=Dg,f.inRange=b0,f.invoke=s0,f.isArguments=Hi,f.isArray=ye,f.isArrayBuffer=bm,f.isArrayLike=ur,f.isArrayLikeObject=_t,f.isBoolean=_m,f.isBuffer=xi,f.isDate=Em,f.isElement=Im,f.isEmpty=xm,f.isEqual=Sm,f.isEqualWith=Pm,f.isError=Wa,f.isFinite=Om,f.isFunction=oi,f.isInteger=Fh,f.isLength=lo,f.isMap=Dh,f.isMatch=Cm,f.isMatchWith=Am,f.isNaN=Nm,f.isNative=Rm,f.isNil=$m,f.isNull=Tm,f.isNumber=Lh,f.isObject=ct,f.isObjectLike=mt,f.isPlainObject=Hs,f.isRegExp=Ja,f.isSafeInteger=Fm,f.isSet=jh,f.isString=fo,f.isSymbol=wr,f.isTypedArray=gs,f.isUndefined=Dm,f.isWeakMap=Lm,f.isWeakSet=jm,f.join=Ug,f.kebabCase=P0,f.last=Nr,f.lastIndexOf=zg,f.lowerCase=O0,f.lowerFirst=C0,f.lt=qm,f.lte=Mm,f.max=Ev,f.maxBy=Iv,f.mean=xv,f.meanBy=Sv,f.min=Pv,f.minBy=Ov,f.stubArray=ic,f.stubFalse=sc,f.stubObject=fv,f.stubString=pv,f.stubTrue=dv,f.multiply=Cv,f.nth=kg,f.noConflict=sv,f.noop=rc,f.now=co,f.pad=A0,f.padEnd=N0,f.padStart=R0,f.parseInt=T0,f.random=_0,f.reduce=Vy,f.reduceRight=By,f.repeat=$0,f.replace=F0,f.result=l0,f.round=Av,f.runInContext=P,f.sample=Wy,f.size=Yy,f.snakeCase=D0,f.some=Zy,f.sortedIndex=Jg,f.sortedIndexBy=Qg,f.sortedIndexOf=Yg,f.sortedLastIndex=Zg,f.sortedLastIndexBy=Xg,f.sortedLastIndexOf=ey,f.startCase=j0,f.startsWith=q0,f.subtract=Nv,f.sum=Rv,f.sumBy=Tv,f.template=M0,f.times=gv,f.toFinite=ai,f.toInteger=me,f.toLength=Mh,f.toLower=U0,f.toNumber=Rr,f.toSafeInteger=Um,f.toString=Le,f.toUpper=z0,f.trim=k0,f.trimEnd=H0,f.trimStart=K0,f.truncate=V0,f.unescape=B0,f.uniqueId=mv,f.upperCase=G0,f.upperFirst=Za,f.each=Sh,f.eachRight=Ph,f.first=_h,tc(f,function(){var e={};return Vr(f,function(i,n){qe.call(f.prototype,n)||(e[n]=i)}),e}(),{chain:!1}),f.VERSION=s,Sr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),Sr(["drop","take"],function(e,i){Se.prototype[e]=function(n){n=n===r?1:jt(me(n),0);var c=this.__filtered__&&!i?new Se(this):this.clone();return c.__filtered__?c.__takeCount__=Gt(n,c.__takeCount__):c.__views__.push({size:Gt(n,Y),type:e+(c.__dir__<0?"Right":"")}),c},Se.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),Sr(["filter","map","takeWhile"],function(e,i){var n=i+1,c=n==T||n==Me;Se.prototype[e]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:ue(l,3),type:n}),d.__filtered__=d.__filtered__||c,d}}),Sr(["head","last"],function(e,i){var n="take"+(i?"Right":"");Se.prototype[e]=function(){return this[n](1).value()[0]}}),Sr(["initial","tail"],function(e,i){var n="drop"+(i?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[n](1)}}),Se.prototype.compact=function(){return this.filter(lr)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=_e(function(e,i){return typeof e=="function"?new Se(this):this.map(function(n){return js(n,e,i)})}),Se.prototype.reject=function(e){return this.filter(ho(ue(e)))},Se.prototype.slice=function(e,i){e=me(e);var n=this;return n.__filtered__&&(e>0||i<0)?new Se(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==r&&(i=me(i),n=i<0?n.dropRight(-i):n.take(i-e)),n)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(Y)},Vr(Se.prototype,function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),l=f[c?"take"+(i=="last"?"Right":""):i],d=c||/^find/.test(i);l&&(f.prototype[i]=function(){var v=this.__wrapped__,_=c?[1]:arguments,O=v instanceof Se,z=_[0],k=O||ye(v),G=function(Ie){var Oe=l.apply(f,mi([Ie],_));return c&&X?Oe[0]:Oe};k&&n&&typeof z=="function"&&z.length!=1&&(O=k=!1);var X=this.__chain__,se=!!this.__actions__.length,he=d&&!X,we=O&&!se;if(!d&&k){v=we?v:new Se(this);var le=e.apply(v,_);return le.__actions__.push({func:oo,args:[G],thisArg:r}),new Or(le,X)}return he&&we?e.apply(this,_):(le=this.thru(G),he?c?le.value()[0]:le.value():le)})}),Sr(["pop","push","shift","sort","splice","unshift"],function(e){var i=Tn[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var d=this.value();return i.apply(ye(d)?d:[],l)}return this[n](function(v){return i.apply(ye(v)?v:[],l)})}}),Vr(Se.prototype,function(e,i){var n=f[i];if(n){var c=n.name+"";qe.call(hs,c)||(hs[c]=[]),hs[c].push({name:i,func:n})}}),hs[Xn(r,fe).name]=[{name:"wrapper",func:r}],Se.prototype.clone=Bp,Se.prototype.reverse=Gp,Se.prototype.value=Wp,f.prototype.at=Iy,f.prototype.chain=xy,f.prototype.commit=Sy,f.prototype.next=Py,f.prototype.plant=Cy,f.prototype.reverse=Ay,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=Ny,f.prototype.first=f.prototype.head,Ns&&(f.prototype[Ns]=Oy),f},as=Sp();bt?((bt.exports=as)._=as,Be._=as):Pe._=as}).call(Qs)})(Tc,Tc.exports);var TI=Object.defineProperty,$I=Object.defineProperties,FI=Object.getOwnPropertyDescriptors,ef=Object.getOwnPropertySymbols,DI=Object.prototype.hasOwnProperty,LI=Object.prototype.propertyIsEnumerable,tf=(o,t,r)=>t in o?TI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,bo=(o,t)=>{for(var r in t||(t={}))DI.call(t,r)&&tf(o,r,t[r]);if(ef)for(var r of ef(t))LI.call(t,r)&&tf(o,r,t[r]);return o},jI=(o,t)=>$I(o,FI(t));function Ci(o,t,r){var s;const a=u1(o);return((s=t.rpcMap)==null?void 0:s[a.reference])||`${RI}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function Qi(o){return o.includes(":")?o.split(":")[1]:o}function ep(o){return o.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function qI(o,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(o));if(!r.length)return[];const s=[];return r.forEach(a=>{const h=t.namespaces[a].accounts;s.push(...h)}),s}function MI(o={},t={}){const r=rf(o),s=rf(t);return Tc.exports.merge(r,s)}function rf(o){var t,r,s,a;const h={};if(!bs(o))return h;for(const[p,g]of Object.entries(o)){const w=Vc(p)?[p]:g.chains,y=g.methods||[],b=g.events||[],S=g.rpcMap||{},N=Ys(p);h[N]=jI(bo(bo({},h[N]),g),{chains:oc(w,(t=h[N])==null?void 0:t.chains),methods:oc(y,(r=h[N])==null?void 0:r.methods),events:oc(b,(s=h[N])==null?void 0:s.events),rpcMap:bo(bo({},S),(a=h[N])==null?void 0:a.rpcMap)})}return h}function UI(o){return o.includes(":")?o.split(":")[2]:o}function zI(o){const t={};for(const[r,s]of Object.entries(o)){const a=s.methods||[],h=s.events||[],p=s.accounts||[],g=Vc(r)?[r]:s.chains?s.chains:ep(s.accounts);t[r]={chains:g,methods:a,events:h,accounts:p}}return t}function wc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const tp={},st=o=>tp[o],bc=(o,t)=>{tp[o]=t};class kI{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Qi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ci(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new fi(new Ai(s,st("disableProviderPing")))}}class HI{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Ci(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new fi(new Ai(s,st("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(Qi(r));t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const h=parseInt(a,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class KI{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Qi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ci(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new fi(new Ai(s,st("disableProviderPing")))}}class VI{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Qi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ci(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new fi(new Ai(s,st("disableProviderPing")))}}class BI{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=Qi(r);t[a]=this.createHttpProvider(a,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new fi(new Ai(s,st("disableProviderPing")))}}class GI{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Qi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ci(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new fi(new Ai(s,st("disableProviderPing")))}}class WI{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Qi(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ci(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new fi(new Ai(s,st("disableProviderPing")))}}class JI{constructor(t){this.name="near",this.namespace=t.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Ci(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(pi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Ci(t,this.namespace);return typeof s>"u"?void 0:new fi(new Ai(s,st("disableProviderPing")))}}var QI=Object.defineProperty,YI=Object.defineProperties,ZI=Object.getOwnPropertyDescriptors,sf=Object.getOwnPropertySymbols,XI=Object.prototype.hasOwnProperty,ex=Object.prototype.propertyIsEnumerable,nf=(o,t,r)=>t in o?QI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,_o=(o,t)=>{for(var r in t||(t={}))XI.call(t,r)&&nf(o,r,t[r]);if(sf)for(var r of sf(t))ex.call(t,r)&&nf(o,r,t[r]);return o},_c=(o,t)=>YI(o,ZI(t));class Yc{constructor(t){this.events=new Lc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||Zl})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Yc(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:_o({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){this.request(t,s).then(a=>r(null,a)).catch(a=>r(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:It("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(h=>{this.session=h,this.namespaces||(this.namespaces=zI(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==Zf)throw h;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Jr(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await OI.init({logger:this.providerOpts.logger||Zl,relayUrl:this.providerOpts.relayUrl||CI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Ys(r)))];bc("client",this.client),bc("events",this.events),bc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=qI(r,this.session),a=ep(s),h=MI(this.namespaces,this.optionalNamespaces),p=_c(_o({},h[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new HI({namespace:p});break;case"solana":this.rpcProviders[r]=new KI({namespace:p});break;case"cosmos":this.rpcProviders[r]=new VI({namespace:p});break;case"polkadot":this.rpcProviders[r]=new kI({namespace:p});break;case"cip34":this.rpcProviders[r]=new BI({namespace:p});break;case"elrond":this.rpcProviders[r]=new GI({namespace:p});break;case"multiversx":this.rpcProviders[r]=new WI({namespace:p});break;case"near":this.rpcProviders[r]=new JI({namespace:p});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&Jr(a)&&this.events.emit("accountsChanged",a.map(UI))}else if(s.name==="chainChanged"){const a=r.chainId,h=r.event.data,p=Ys(a),g=wc(a)!==wc(h)?`${p}:${wc(h)}`:a;this.onChainChanged(g)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,h=(s=this.client)==null?void 0:s.session.get(t);this.session=_c(_o({},h),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",_c(_o({},It("USER_DISCONNECTED")),{data:t.topic}))}),this.on(pi.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(p=>Ys(p)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=Ys(Object.keys(this.namespaces)[0]),h=this.rpcProviders[a].getDefaultChain();return[a,h]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,h]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(h),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${Xl}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${Xl}/${t}`)}}const tx=Yc,rx="wc",ix="ethereum_provider",sx=`${rx}@2:${ix}:`,nx="https://rpc.walletconnect.com/v1/",$c=["eth_sendTransaction","personal_sign"],ox=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Fc=["chainChanged","accountsChanged"],ax=["chainChanged","accountsChanged","message","disconnect","connect"];var cx=Object.defineProperty,ux=Object.defineProperties,hx=Object.getOwnPropertyDescriptors,of=Object.getOwnPropertySymbols,lx=Object.prototype.hasOwnProperty,fx=Object.prototype.propertyIsEnumerable,af=(o,t,r)=>t in o?cx(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Xs=(o,t)=>{for(var r in t||(t={}))lx.call(t,r)&&af(o,r,t[r]);if(of)for(var r of of(t))fx.call(t,r)&&af(o,r,t[r]);return o},cf=(o,t)=>ux(o,hx(t));function No(o){return Number(o[0].split(":")[1])}function Ec(o){return`0x${o.toString(16)}`}function px(o){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:h,optionalEvents:p,rpcMap:g}=o;if(!Jr(t))throw new Error("Invalid chains");const w={chains:t,methods:s||$c,events:h||Fc,rpcMap:Xs({},t.length?{[No(t)]:g[No(t)]}:{})},y=h==null?void 0:h.filter(K=>!Fc.includes(K)),b=s==null?void 0:s.filter(K=>!$c.includes(K));if(!r&&!p&&!a&&!(y!=null&&y.length)&&!(b!=null&&b.length))return{required:t.length?w:void 0};const S=(y==null?void 0:y.length)&&(b==null?void 0:b.length)||!r,N={chains:[...new Set(S?w.chains.concat(r||[]):r)],methods:[...new Set(w.methods.concat(a!=null&&a.length?a:ox))],events:[...new Set(w.events.concat(p!=null&&p.length?p:ax))],rpcMap:g};return{required:t.length?w:void 0,optional:r.length?N:void 0}}class Zc{constructor(){this.events=new Qr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=sx,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Zc;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=px(this.rpc);try{const a=await new Promise(async(p,g)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(y=>{!y.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(cf(Xs({namespaces:Xs({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(y=>{p(y)}).catch(y=>{g(new Error(y.message))})});if(!a)return;const h=h1(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:h),this.setAccounts(h),this.events.emit("connect",{chainId:Ec(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Ec(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",cf(Xs({},It("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Ec(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],h=(s=t==null?void 0:t.optionalChains)!=null?s:[],p=a.concat(h);if(!p.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=a.length?(t==null?void 0:t.methods)||$c:[],w=a.length?(t==null?void 0:t.events)||Fc:[],y=(t==null?void 0:t.optionalMethods)||[],b=(t==null?void 0:t.optionalEvents)||[],S=(t==null?void 0:t.rpcMap)||this.buildRpcMap(p,t.projectId),N=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(K=>this.formatChainId(K)),optionalChains:h.map(K=>this.formatChainId(K)),methods:g,events:w,optionalMethods:y,optionalEvents:b,rpcMap:S,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:N,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?No(this.rpc.chains):No(this.rpc.optionalChains),this.signer=await tx.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await t1(()=>import("./index-af7a6ad7.js").then(a=>a.i),["assets/index-af7a6ad7.js","assets/index-de2ecb01.js","assets/index-cfe6cefb.css"]);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Xs({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&Jr(r)&&(this.rpc.chains=r.map(h=>this.formatChainId(h)),r.forEach(h=>{this.rpc.rpcMap[h]=(a==null?void 0:a[h])||this.getRpcUrl(h)})),s&&Jr(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(h=>this.formatChainId(h)),s.forEach(h=>{this.rpc.rpcMap[h]=(a==null?void 0:a[h])||this.getRpcUrl(h)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${nx}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const Nx=Zc;export{Nx as EthereumProvider,ax as OPTIONAL_EVENTS,ox as OPTIONAL_METHODS,Fc as REQUIRED_EVENTS,$c as REQUIRED_METHODS,Zc as default};
